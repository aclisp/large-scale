cscope 15 i:/proj               0000159346
	@radfwk/ConfMap.cpp

1 
	~"¿dut.h
"

3 
	~<Ãw
>

4 
	~<¡ršg
>

5 
	~<™”©Ü
>

6 
	~<®gÜ™hm
>

8 
	~"CÚfM­.h
"

9 
	~"funùÜs.hµ
"

10 
	~"Li¡M­.hµ
"

21 şas 
	cCÚfM­
::
D‘a
 : 
´iv©e
 
boo¡
::
nÚcİyabË


23 
public
:

24 
Li¡M­
<
	t¡d
::
	t¡ršg
, std::¡ršg> 
	tCÚfSeùiÚ
;

25 #ià
CONFMAP_KEEP_CONFSEC_AS_POINTER


26 
	mLi¡M­
<
	t¡d
::
	t¡ršg
, 
	tCÚfSeùiÚ
*> 
	tCÚfSeùiÚM­
;

28 
	mLi¡M­
<
	t¡d
::
	t¡ršg
, 
	tCÚfSeùiÚ
> 
	tCÚfSeùiÚM­
;

30 
	$D‘a
(
CÚfM­
* 
thisCÚfM­
è: 
	`’şosu»
(thisConfMap)

31 , 
	$£cHasName2
(
Œue
)

33 ~
	$D‘a
()

34 { 
’şosu»
->
	`ş—r
(); 
	}
}

36 
CÚfM­
* 
	g’şosu»
;

37 
boŞ
 
	g£cHasName2
;

38 
	g¡d
::
¡ršg
 
£cName
;

39 
CÚfSeùiÚM­
 
	gcÚfSecM­
;

42 
	gCÚfM­
::
	$CÚfM­
(cÚ¡ * 
cÚffe
, cÚ¡ * 
£ùiÚ
)

44 
pIm¶
 = 
Ãw
 
	`D‘a
(
this
);

45 
	`¿d_as£¹
(
pIm¶
 !ğ
NULL
);

46 
	`lßd
(
cÚffe
, 
£ùiÚ
);

47 
	}
}

49 
	gCÚfM­
::
	$CÚfM­
(
CONF_SECTION
* 
cÚf
, cÚ¡ * 
£ùiÚ
)

51 
pIm¶
 = 
Ãw
 
	`D‘a
(
this
);

52 
	`¿d_as£¹
(
pIm¶
 !ğ
NULL
);

53 
	`lßd
(
cÚf
, 
£ùiÚ
);

54 
	}
}

56 
	gCÚfM­
::~
	$CÚfM­
()

58 
d–‘e
 
pIm¶
;

59 
	}
}

61 cÚ¡ * 
	gCÚfM­
::
	$fšdByName
(cÚ¡ * 
Çme
, cÚ¡ * 
key
) const

63 
	`¿d_as£¹
(
Çme
 !ğ
NULL
);

65 
D‘a
::
CÚfSeùiÚM­
::
cÚ¡_™”©Ü
 
™”
 = 
pIm¶
->
cÚfSecM­
.
	`fšd
(
Çme
);

66 if(
™”
 =ğ
pIm¶
->
cÚfSecM­
.
	`’d
())

67  
NULL
;

69 if(
key
 =ğ
NULL
)

70  
Çme
;

72 #ià
CONFMAP_KEEP_CONFSEC_AS_POINTER


73 
D‘a
::
CÚfSeùiÚ
::
cÚ¡_™”©Ü
 
™”2
 = 
™”
->
£cÚd
->
	`fšd
(
key
);

74 if(
™”2
 =ğ
™”
->
£cÚd
->
	`’d
())

76 
D‘a
::
CÚfSeùiÚ
::
cÚ¡_™”©Ü
 
™”2
 = 
™”
->
£cÚd
.
	`fšd
(
key
);

77 if(
™”2
 =ğ
™”
->
£cÚd
.
	`’d
())

79  
NULL
;

81  
™”2
->
£cÚd
.
	`c_¡r
();

82 
	}
}

84 
	gCÚfM­
::
ušt
 
CÚfM­
::
	$tÙ®CouÁ
() const

86  
pIm¶
->
cÚfSecM­
.
	`size
();

87 
	}
}

89 cÚ¡ * 
	gCÚfM­
::
	$fšdByIndex
(
ušt
 
šdex
, cÚ¡ * 
key
) const

91 if(
šdex
 < 0 || index >ğ
	`tÙ®CouÁ
())

92  
NULL
;

94 
D‘a
::
CÚfSeùiÚM­
::
cÚ¡_™”©Ü
 
™”
 = 
pIm¶
->
cÚfSecM­
.
	`begš
();

95 
¡d
::
	`advªû
(
™”
, 
šdex
);

97 if(
key
 =ğ
NULL
)

98  
™”
->
fœ¡
.
	`c_¡r
();

100 #ià
CONFMAP_KEEP_CONFSEC_AS_POINTER


101 
D‘a
::
CÚfSeùiÚ
::
cÚ¡_™”©Ü
 
™”2
 = 
™”
->
£cÚd
->
	`fšd
(
key
);

102 if(
™”2
 =ğ
™”
->
£cÚd
->
	`’d
())

104 
D‘a
::
CÚfSeùiÚ
::
cÚ¡_™”©Ü
 
™”2
 = 
™”
->
£cÚd
.
	`fšd
(
key
);

105 if(
™”2
 =ğ
™”
->
£cÚd
.
	`’d
())

107  
NULL
;

109  
™”2
->
£cÚd
.
	`c_¡r
();

110 
	}
}

112 
	gCÚfM­
::
	$addOrUpd©e
(cÚ¡ * 
Çme
, cÚ¡ * 
key
, cÚ¡ * 
v®ue
)

115 if(
	`fšdByName
(
Çme
, 
NULL
) == NULL) {

116 #ià
CONFMAP_KEEP_CONFSEC_AS_POINTER


117 
D‘a
::
CÚfSeùiÚ
* 
cÚfSec
 = 
Ãw
 Detail::ConfSection;

118 
	`¿d_as£¹
(
cÚfSec
 !ğ
NULL
);

119 if(
key
 && 
v®ue
)

120 
cÚfSec
->
	`š£¹
(
D‘a
::
CÚfSeùiÚ
::
	`v®ue_ty³
(
key
, 
v®ue
));

122 
D‘a
::
CÚfSeùiÚ
 
cÚfSec
;

123 if(
key
 && 
v®ue
)

124 
cÚfSec
.
	`š£¹
(
D‘a
::
CÚfSeùiÚ
::
	`v®ue_ty³
(
key
, 
v®ue
));

126 
pIm¶
->
cÚfSecM­
.
	`š£¹
(
D‘a
::
CÚfSeùiÚM­
::
	`v®ue_ty³
(
Çme
, 
cÚfSec
));

130 if(
key
 =ğ
NULL
 || 
v®ue
 == NULL) {

131 
	`¿dlog
(
L_WARN
|
L_CONS
, "[ConfMap::addOrUpdate]‚ame '%s'‡lreadyƒxists, "

132 "buˆkey o¸v®ui NULL. O³¿tiÚ ha nØefãù.", 
Çme
);

136 
D‘a
::
CÚfSeùiÚM­
::
™”©Ü
 
™”
 = 
pIm¶
->
cÚfSecM­
.
	`fšd
(
Çme
);

139 if(
	`fšdByName
(
Çme
, 
key
è=ğ
NULL
) {

140 #ià
CONFMAP_KEEP_CONFSEC_AS_POINTER


141 
™”
->
£cÚd
->
	`š£¹
(
D‘a
::
CÚfSeùiÚ
::
	`v®ue_ty³
(
key
, 
v®ue
));

143 
™”
->
£cÚd
.
	`š£¹
(
D‘a
::
CÚfSeùiÚ
::
	`v®ue_ty³
(
key
, 
v®ue
));

149 #ià
CONFMAP_KEEP_CONFSEC_AS_POINTER


150 
D‘a
::
CÚfSeùiÚ
::
™”©Ü
 
™”2
 = 
™”
->
£cÚd
->
	`fšd
(
key
);

152 
D‘a
::
CÚfSeùiÚ
::
™”©Ü
 
™”2
 = 
™”
->
£cÚd
.
	`fšd
(
key
);

154 
™”2
->
£cÚd
 = 
v®ue
;

156 
	}
}

158 
	gCÚfM­
::
	$»move
(cÚ¡ * 
Çme
, cÚ¡ * 
key
)

160 if(
	`fšdByName
(
Çme
, 
key
è=ğ
NULL
) {

161 
	`¿dlog
(
L_WARN
|
L_CONS
, "[ConfMap::remove]‚ame '%s' or key '%s' can‚ot be found. "

162 "O³¿tiÚ ha nØefãù.", 
Çme
, 
key
?key:"<NULL>");

166 
D‘a
::
CÚfSeùiÚM­
::
™”©Ü
 
™”
 = 
pIm¶
->
cÚfSecM­
.
	`fšd
(
Çme
);

168 if(
key
 =ğ
NULL
) {

169 #ià
CONFMAP_KEEP_CONFSEC_AS_POINTER


170 
d–‘e
 
™”
->
£cÚd
;

174 
pIm¶
->
cÚfSecM­
.
	`”a£
(
™”
);

177 #ià
CONFMAP_KEEP_CONFSEC_AS_POINTER


178 
™”
->
£cÚd
->
	`”a£
(
key
);

180 
™”
->
£cÚd
.
	`”a£
(
key
);

185 
	}
}

187 
	gCÚfM­
::
	$§ve
(cÚ¡ * 
f’ame
) const

189 
FILE
* 
fe
 = 
	`fİ’
(
f’ame
, "w");

190 if(
fe
 =ğ
NULL
) {

191 
	`¿dlog
(
L_CONS
|
L_ERROR
, "[CÚfM­::§ve] cª‚Ù o³Àf'%s' fÜ wr™e", 
f’ame
);

195 
»t
 = 
	`§ve
(
fe
);

196 
	`fşo£
(
fe
);

198  
»t
;

199 
	}
}

201 
	gCÚfM­
::
	$§ve
(
FILE
* 
fe
) const

203 
	`årštf
(
fe
, "\n");

204 
	`årštf
(
fe
, "######################################################################\n");

205 
	`årštf
(
fe
, "# Configuration group '%s' generated by [ConfMap::save]\n\n",

206 
pIm¶
->
£cName
.
	`c_¡r
());

208 
D‘a
::
CÚfSeùiÚM­
::
cÚ¡_™”©Ü
 
i
 = 
pIm¶
->
cÚfSecM­
.
	`begš
();

209 
i
 !ğ
pIm¶
->
cÚfSecM­
.
	`’d
(); ++i) {

210 
	`årštf
(
fe
, "% ", 
pIm¶
->
£cName
.
	`c_¡r
());

211 if(
pIm¶
->
£cHasName2
)

212 
	`årštf
(
fe
, "% ", 
i
->
fœ¡
.
	`c_¡r
());

213 
	`årštf
(
fe
, "{\n");

215 #ià
CONFMAP_KEEP_CONFSEC_AS_POINTER


216 
D‘a
::
CÚfSeùiÚ
::
cÚ¡_™”©Ü
 
j
 = 
i
->
£cÚd
->
	`begš
();

217 
j
 !ğ
i
->
£cÚd
->
	`’d
(); ++j)

219 
D‘a
::
CÚfSeùiÚ
::
cÚ¡_™”©Ü
 
j
 = 
i
->
£cÚd
.
	`begš
();

220 
j
 !ğ
i
->
£cÚd
.
	`’d
(); ++j)

222 
	`årštf
(
fe
, " % ğ%s\n", 
j
->
fœ¡
.
	`c_¡r
(), j->
£cÚd
.c_str());

224 
	`årštf
(
fe
, "}\n\n");

228 
	}
}

230 
	gCÚfM­
::
	$lßd
(cÚ¡ * 
cÚffe
, cÚ¡ * 
£ùiÚ
)

232 
pIm¶
->
£cName
 = 
£ùiÚ
;

234 
CONF_SECTION
 *
cÚf
 = 
	`cÚf_»ad
(
__FILE__
, 
__LINE__
, 
cÚffe
, 
NULL
);

235 if(
cÚf
 =ğ
NULL
) {

236 
	`¿dlog
(
L_CONS
|
L_ERROR
, "[CÚfM­::lßd] cª‚Ù„—d '%s'", 
cÚffe
);

240 
»t
 = 
	`lßd
(
cÚf
, 
£ùiÚ
);

243 
	`cf_£ùiÚ_ä“
(&
cÚf
);

245  
»t
;

246 
	}
}

248 
	gCÚfM­
::
	$lßd
(
CONF_SECTION
* 
cÚf
, cÚ¡ * 
£ùiÚ
)

250 
pIm¶
->
cÚfSecM­
.
	`ş—r
();

251 
pIm¶
->
£cName
 = 
£ùiÚ
;

253 
CONF_SECTION
* 
subcÚf
 = 
NULL
;

256 
subcÚf
 = 
	`cf_sub£ùiÚ_fšd_Ãxt
(
cÚf
, 
NULL
, 
£ùiÚ
);

257 if(
subcÚf
 =ğ
NULL
) {

260 
pIm¶
->
£cHasName2
 = (
	`cf_£ùiÚ_Çme2
(
subcÚf
è!ğ
NULL
);

263 
subcÚf
 = 
NULL
;

264 (
subcÚf
 = 
	`cf_sub£ùiÚ_fšd_Ãxt
(
cÚf
, subcÚf, 
£ùiÚ
))) {

265 cÚ¡ * 
Çme
 = 
	`cf_£ùiÚ_Çme2
(
subcÚf
);

266 
CONF_PAIR
* 
·œ
 = 
NULL
;

267 if(!
pIm¶
->
£cHasName2
) {

268 
·œ
 = 
	`cf_·œ_fšd_Ãxt
(
subcÚf
, 
NULL
, NULL);

269 if(
·œ
 =ğ
NULL
) {

270 
	`¿dlog
(
L_CONS
|
L_WARN
, "[ConfMap::load] section '%s'‡t†ine %d "

272 
£ùiÚ
, 
	`cf_£ùiÚ_lš’o
(
subcÚf
));

276 
Çme
 = 
	`cf_·œ_v®ue
(
·œ
);

277 } ià(
Çme
 =ğ
NULL
) {

278 
	`¿dlog
(
L_CONS
|
L_WARN
, "[ConfMap::load] section '%s'‡t†ine %d "

279 "w™houˆÇme2 would bignÜed!!!", 
£ùiÚ
, 
	`cf_£ùiÚ_lš’o
(
subcÚf
));

283 
·œ
 = 
NULL
;

284 (
·œ
 = 
	`cf_·œ_fšd_Ãxt
(
subcÚf
,…aœ, 
NULL
))) {

285 cÚ¡ * 
key
 = 
	`cf_·œ_©Œ
(
·œ
);

286 cÚ¡ * 
v®ue
 = 
	`cf_·œ_v®ue
(
·œ
);

287 
	`addOrUpd©e
(
Çme
, 
key
, 
v®ue
);

290  
	`tÙ®CouÁ
();

291 
	}
}

293 cÚ¡ * 
	gCÚfM­
::
	$fšd
(cÚ¡ * 
Çme
, cÚ¡ * 
key
, cÚ¡ * 
def
)

295 cÚ¡ * 
v®
 = 
	`fšdByName
(
Çme
, 
key
);

296 if(
v®
 =ğ
NULL
) {

297 
	`addOrUpd©e
(
Çme
, 
key
, 
def
);

298  
def
;

300  
v®
;

302 
	}
}

304 cÚ¡ * 
	gCÚfM­
::
	$fšd
(cÚ¡ * 
Çme
, cÚ¡ * 
key
, cÚ¡ * 
def
) const

306 cÚ¡ * 
v®
 = 
	`fšdByName
(
Çme
, 
key
);

307 if(
v®
 =ğ
NULL
) {

308  
def
;

310  
v®
;

312 
	}
}

314 cÚ¡ * 
	gCÚfM­
::
	$Çme
() const

316  
pIm¶
->
£cName
.
	`c_¡r
();

317 
	}
}

319 
	gCÚfM­
::
	$ş—r
()

321 #ià
CONFMAP_KEEP_CONFSEC_AS_POINTER


322 
¡d
::
	`fÜ_—ch
(
pIm¶
->
cÚfSecM­
.
	`begš
(),…Im¶->cÚfSecM­.
	`’d
(),

323 
d–‘e_poš‹r
<
D‘a
::
CÚfSeùiÚM­
::
v®ue_ty³
>());

327 
pIm¶
->
cÚfSecM­
.
	`ş—r
();

328 
	}
}

	@radfwk/ConfMap.h

1 #iâdeà
RADFWK_CONFMAP_H


2 
	#RADFWK_CONFMAP_H


	)

4 
	~<¿dfwk/nÚcİyabË.hµ
>

5 
	~<¿dut/¿dcÚffe.h
>

6 
	~<¡dio.h
>

34 şas 
	cCÚfM­
 : 
´iv©e
 
boo¡
::
nÚcİyabË


36 
şass
 
D‘a
;

37 
	tušt
;

39 
	mpublic
:

43 
CÚfM­
(cÚ¡ * 
cÚffe
, cÚ¡ * 
£ùiÚ
);

44 
CÚfM­
(
CONF_SECTION
* 
cÚf
, cÚ¡ * 
£ùiÚ
);

45 ~
CÚfM­
();

48 cÚ¡ * 
	$Çme
() const;

53 cÚ¡ * 
	$fšdByName
(cÚ¡ * 
Çme
, cÚ¡ * 
key
) const;

58 cÚ¡ * 
	`fšd
(cÚ¡ * 
Çme
, cÚ¡ * 
key
, cÚ¡ * 
def
);

62 cÚ¡ * 
	$fšd
(cÚ¡ * 
Çme
, cÚ¡ * 
key
, cÚ¡ * 
def
) const;

64 
ušt
 
	$tÙ®CouÁ
() const;

65 
	`ş—r
();

71 cÚ¡ * 
	$fšdByIndex
(
ušt
 
šdex
, cÚ¡ * 
key
) const;

76 
	`addOrUpd©e
(cÚ¡ * 
Çme
, cÚ¡ * 
key
, cÚ¡ * 
v®ue
);

81 
	`»move
(cÚ¡ * 
Çme
, cÚ¡ * 
key
);

86 
	$§ve
(cÚ¡ * 
f’ame
) const;

87 
	$§ve
(
FILE
* 
fe
) const;

92 
	`lßd
(cÚ¡ * 
cÚffe
, cÚ¡ * 
£ùiÚ
);

93 
	`lßd
(
CONF_SECTION
* 
cÚf
, cÚ¡ * 
£ùiÚ
);

95 
´iv©e
:

96 
D‘a
* 
pIm¶
;

	@radfwk/Config.cpp

1 
	~"¿dut.h
"

3 
	~<Ãw
>

4 
	~<¡ršg
>

5 
	~<™”©Ü
>

6 
	~<®gÜ™hm
>

8 
	~"CÚfig.h
"

9 
	~"CÚfM­.h
"

10 
	~"funùÜs.hµ
"

11 
	~"Li¡M­.hµ
"

14 "C" 
CONF_PARSER
 
£ùiÚ_cÚfig
[];

15 "C" 
lßd_cÚfig_hook
(
CÚfig
* , 
CONF_SECTION
*);

16 "C" 
maš_cÚfig_t
* 
ü—‹_mašcÚfig
();

17 "C" 
de¡roy_mašcÚfig
(
maš_cÚfig_t
** 
mcf
);

19 
	$´št_cÚfh—d
(
FILE
* 
fe
)

21 
	`årštf
(
fe
, "######################################################################\n");

22 
	`årštf
(
fe
, "# Define some global constant„eferenced by following sections\n");

23 
	`årštf
(
fe
, "######################################################################\n");

24 
	`årštf
(
fe
, "define {\n");

25 
	`årštf
(
fe
, "†og_level {\n");

26 
	`årštf
(
fe
, " ALL = 0 /* 0x00000000 */\n");

27 
	`årštf
(
fe
, " TRACE = 512 /* 0x00000200 */\n");

28 
	`årštf
(
fe
, " DEBUG = 1024 /* 0x00000400 */\n");

29 
	`årštf
(
fe
, " INFO = 2048 /* 0x00000800 */\n");

30 
	`årštf
(
fe
, " WARN = 4096 /* 0x00001000 */\n");

31 
	`årštf
(
fe
, " ERROR = 8192 /* 0x00002000 */\n");

32 
	`årštf
(
fe
, " FATAL = 16384 /* 0x00004000 */\n");

33 
	`årštf
(
fe
, " }\n");

34 
	`årštf
(
fe
, "†og_dest {\n");

35 
	`årštf
(
fe
, " FILES = 0\n");

36 
	`årštf
(
fe
, " SYSLOG = 1\n");

37 
	`årštf
(
fe
, " STDOUT = 2\n");

38 
	`årštf
(
fe
, " STDERR = 3\n");

39 
	`årštf
(
fe
, " NULL = 4\n");

40 
	`årštf
(
fe
, " }\n");

41 
	`årštf
(
fe
, "}\n");

42 
	`årštf
(
fe
, "\n");

43 
	}
}

45 şas 
	cCÚfig
::
D‘a
 : 
´iv©e
 
boo¡
::
nÚcİyabË


47 
public
:

48 
Li¡M­
<
	t¡d
::
	t¡ršg
, 
	tCÚfM­
*> 
	tCÚfM­EÁry
;

49 
	$D‘a
()

51 
mašcÚfig
 = 
	`ü—‹_mašcÚfig
();

52 
	`¿d_as£¹
(
mašcÚfig
 !ğ
NULL
);

54 ~
	$D‘a
()

56 
	`de¡roy_mašcÚfig
(&
mašcÚfig
);

57 
	}
}

59 
maš_cÚfig_t
* 
	gmašcÚfig
;

60 
CÚfM­EÁry
 
	gcÚfM­EÁry
;

63 
	gCÚfig
::
	$CÚfig
()

65 
pIm¶
 = 
Ãw
 
D‘a
;

66 
	`¿d_as£¹
(
pIm¶
 !ğ
NULL
);

67 
	}
}

69 
	gCÚfig
::
	$CÚfig
(cÚ¡ * 
cÚffe
)

71 
pIm¶
 = 
Ãw
 
D‘a
;

72 
	`¿d_as£¹
(
pIm¶
 !ğ
NULL
);

73 
	`lßd
(
cÚffe
);

74 
	}
}

76 
	gCÚfig
::~
	$CÚfig
()

78 
	`d–AÎCÚfM­
();

80 
CONF_PARSER
* 
£ùiÚs
 = 
£ùiÚ_cÚfig
;

81 
i
=0; 
£ùiÚs
[i].
Çme
 !ğ
NULL
; ++i) {

82 
	`¿d_as£¹
(
£ùiÚs
[
i
].
ty³
 =ğ
PW_TYPE_SUBSECTION
);

83 
CONF_PARSER
* 
£c
 = (CONF_PARSER*)
£ùiÚs
[
i
].
d©a
;

84 
j
=0; 
£c
[j].
Çme
 !ğ
NULL
; ++j) {

85 * 
d©a
;

86 ià(
£c
[
j
].
d©a
)

87 
d©a
 = 
£c
[
j
].data;

89 
d©a
 = ((*)
pIm¶
->
mašcÚfig
è+ 
£c
[
j
].
off£t
;

90 
£c
[
j
].
ty³
) {

91 
PW_TYPE_STRING_PTR
:

92 
	`¿d_ä“
(*(**)
d©a
);

93 *(**)
d©a
 = 
NULL
;

101 
d–‘e
 
pIm¶
;

102 
	}
}

104 
	gCÚfig
::
	$lßd
(cÚ¡ * 
cÚffe
)

106 
FILE
* 
fe
 = 
	`fİ’
(
cÚffe
, "r");

107 if(
fe
 =ğ
NULL
) {

108 
fe
 = 
	`fİ’
(
cÚffe
, "w");

109 if(
fe
 =ğ
NULL
) {

110 
	`¿dlog
(
L_CONS
|
L_ERROR
, "[Config::load] Can‚ot create configuration file '%s'. "

111 "PËa£ c»©™ mªu®ly fœ¡!", 
cÚffe
);

112 
	`ex™
(1);

116 
	`fşo£
(
fe
);

118 
CONF_SECTION
 *
cÚf
 = 
	`cÚf_»ad
(
__FILE__
, 
__LINE__
, 
cÚffe
, 
NULL
);

119 if(
cÚf
 =ğ
NULL
) {

120 
	`¿dlog
(
L_CONS
|
L_ERROR
, "[CÚfig::lßd] cª‚Ù„—d '%s'", 
cÚffe
);

124 if(
	`cf_£ùiÚ_·r£
(
cÚf
, 
pIm¶
->
mašcÚfig
, 
£ùiÚ_cÚfig
) != 0) {

125 
	`¿dlog
(
L_CONS
|
L_ERROR
, "[CÚfig::lßd] cª‚Ù…¬£ seùiÚ š '%s'", 
cÚffe
);

126 
	`cf_£ùiÚ_ä“
(&
cÚf
);

131 
»t
 = 
	`lßd_cÚfig_hook
(
this
, 
cÚf
);

134 
	`cf_£ùiÚ_ä“
(&
cÚf
);

135  
»t
;

136 
	}
}

138 
	gCÚfig
::
	$§ve
(cÚ¡ * 
f’ame
, 
boŞ
 
£·¿‹dCÚfM­
) const

140 
FILE
* 
fe
 = 
	`fİ’
(
f’ame
, "w");

141 if(
fe
 =ğ
NULL
) {

142 
	`¿dlog
(
L_CONS
|
L_ERROR
, "[CÚfig::§ve] cª‚Ù o³Àf'%s' fÜ wr™e", 
f’ame
);

146 
	`´št_cÚfh—d
(
fe
);

148 
	`årštf
(
fe
, "######################################################################\n");

149 
	`årštf
(
fe
, "# Generated by [Config::save]\n\n");

151 
buf
[256];

152 cÚ¡ 
CONF_PARSER
* 
£ùiÚs
 = 
£ùiÚ_cÚfig
;

153 
i
=0; 
£ùiÚs
[i].
Çme
 !ğ
NULL
; ++i) {

154 
	`¿d_as£¹
(
£ùiÚs
[
i
].
ty³
 =ğ
PW_TYPE_SUBSECTION
);

155 cÚ¡ 
CONF_PARSER
* 
£c
 = (cÚ¡ CONF_PARSER*)
£ùiÚs
[
i
].
d©a
;

156 
	`årštf
(
fe
, "% {\n", 
£ùiÚs
[
i
].
Çme
);

158 
j
=0; 
£c
[j].
Çme
 !ğ
NULL
; ++j) {

159 * 
d©a
;

160 ià(
£c
[
j
].
d©a
)

161 
d©a
 = 
£c
[
j
].data;

163 
d©a
 = ((*)
pIm¶
->
mašcÚfig
è+ 
£c
[
j
].
off£t
;

165 
£c
[
j
].
ty³
) {

166 
PW_TYPE_STRING_PTR
:

167 
	`årštf
(
fe
, " % ğ\"%s\"\n", 
£c
[
j
].
Çme
, *(**)
d©a
);

169 
PW_TYPE_BOOLEAN
:

170 
	`årštf
(
fe
, " % ğ%s\n", 
£c
[
j
].
Çme
, *(*)
d©a
?"yes":"no");

172 
PW_TYPE_INTEGER
:

173 
	`årštf
(
fe
, " % ğ%d\n", 
£c
[
j
].
Çme
, *(*)
d©a
);

175 
PW_TYPE_IPADDR
:

176 
	`årštf
(
fe
, " % ğ%s\n", 
£c
[
j
].
Çme
,

177 
	`_ho¡Çme
(
buf
, (buf), *(
ušt32_t
*)
d©a
));

179 
PW_TYPE_SUBSECTION
:

181 
	`¿d_as£¹
(!"Unsupported PW_TYPE(_SUBSECTION)");

184 
	`årštf
(
fe
, "}\n\n");

188 
»t
 = 0;

189 
D‘a
::
CÚfM­EÁry
::
™”©Ü
 
i
 = 
pIm¶
->
cÚfM­EÁry
.
	`begš
();

190 
i
 !ğ
pIm¶
->
cÚfM­EÁry
.
	`’d
(); ++i) {

191 if(
£·¿‹dCÚfM­
) {

192 
	`sN´štf
(
buf
, (buf), "%s.cÚf", 
i
->
fœ¡
.
	`c_¡r
());

193 
	`årštf
(
fe
, "$INCLUDE \"%s\"\n\n", 
buf
);

194 
»t
 = 
i
->
£cÚd
->
	`§ve
(
buf
);

196 
»t
 = 
i
->
£cÚd
->
	`§ve
(
fe
);

200 
	`fşo£
(
fe
);

201  
»t
;

202 
	}
}

204 
CÚfM­
* 
	gCÚfig
::
	$fšdCÚfM­
(cÚ¡ * 
£ùiÚ
)

206 
D‘a
::
CÚfM­EÁry
::
™”©Ü
 
™”
 = 
pIm¶
->
cÚfM­EÁry
.
	`fšd
(
£ùiÚ
);

207 if(
™”
 =ğ
pIm¶
->
cÚfM­EÁry
.
	`’d
())

208  
NULL
;

210  
™”
->
£cÚd
;

211 
	}
}

213 
CÚfM­
* 
	gCÚfig
::
	$addCÚfM­
(
CÚfM­
* 
cÚfM­
)

215 if(
cÚfM­
 =ğ
NULL
)

216  
NULL
;

218 if(
	`fšdCÚfM­
(
cÚfM­
->
	`Çme
())) {

219 
	`¿dlog
(
L_CONS
|
L_WARN
, "[Config::addConfMap] section '%s'‡lreadyƒxists in "

221 "·s£d iÀa ¬gum’ts", 
cÚfM­
->
	`Çme
());

222 
d–‘e
 
cÚfM­
;

223  
NULL
;

226 
pIm¶
->
cÚfM­EÁry
.
	`š£¹
(
D‘a
::
CÚfM­EÁry
::
	`v®ue_ty³
(
cÚfM­
->
	`Çme
(), confMap));

227  
cÚfM­
;

228 
	}
}

230 
	gCÚfig
::
	$d–CÚfM­
(cÚ¡ * 
£ùiÚ
)

232 
D‘a
::
CÚfM­EÁry
::
™”©Ü
 
™”
 = 
pIm¶
->
cÚfM­EÁry
.
	`fšd
(
£ùiÚ
);

233 if(
™”
 !ğ
pIm¶
->
cÚfM­EÁry
.
	`’d
()) {

234 
d–‘e
 
™”
->
£cÚd
;

235 
pIm¶
->
cÚfM­EÁry
.
	`”a£
(
™”
);

237 
	}
}

239 
	gCÚfig
::
	$d–AÎCÚfM­
()

241 
¡d
::
	`fÜ_—ch
(
pIm¶
->
cÚfM­EÁry
.
	`begš
(),…Im¶->cÚfM­EÁry.
	`’d
(),

242 
d–‘e_poš‹r
<
D‘a
::
CÚfM­EÁry
::
v®ue_ty³
>());

243 
pIm¶
->
cÚfM­EÁry
.
	`ş—r
();

244 
	}
}

246 
CÚfM­
* 
	gCÚfig
::
	$fšdCÚfM­
(
ušt
 
šdex
)

248 if(
šdex
 < 0 || index >ğ
	`tÙ®CÚfM­
())

249  
NULL
;

251 
D‘a
::
CÚfM­EÁry
::
™”©Ü
 
™”
 = 
pIm¶
->
cÚfM­EÁry
.
	`begš
();

252 
¡d
::
	`advªû
(
™”
, 
šdex
);

253  
™”
->
£cÚd
;

254 
	}
}

256 
	gCÚfig
::
ušt
 
CÚfig
::
	$tÙ®CÚfM­
()

258  
pIm¶
->
cÚfM­EÁry
.
	`size
();

259 
	}
}

261 
maš_cÚfig_t
* 
	gCÚfig
::
	$mašcÚfig
()

263  
pIm¶
->
mašcÚfig
;

264 
	}
}

	@radfwk/Config.h

1 #iâdeà
RADFWK_CONFIG_H


2 
	#RADFWK_CONFIG_H


	)

4 
	~<¿dfwk/nÚcİyabË.hµ
>

5 
	~<¿dut/¿dcÚffe.h
>

7 
şass
 
	gCÚfM­
;

8 
şass
 
	gCÚfig
;

9 
maš_cÚfig_t
 
	tmaš_cÚfig_t
;

11 şas 
	cCÚfig
 : 
´iv©e
 
boo¡
::
nÚcİyabË


13 
şass
 
D‘a
;

14 
	tušt
;

16 
	mpublic
:

17 
CÚfig
();

18 
CÚfig
(cÚ¡ * 
cÚffe
);

19 ~
CÚfig
();

24 
lßd
(cÚ¡ * 
cÚffe
);

29 
	$§ve
(cÚ¡ * 
f’ame
, 
boŞ
 
£·¿‹dCÚfM­
 = 
çl£
) const;

32 
CÚfM­
* 
	`fšdCÚfM­
(cÚ¡ * 
£ùiÚ
);

33 
CÚfM­
* 
	`fšdCÚfM­
(
ušt
 
šdex
);

35 
ušt
 
	`tÙ®CÚfM­
();

40 
CÚfM­
* 
	`addCÚfM­
(CÚfM­* 
cÚfM­
);

42 
	`d–CÚfM­
(cÚ¡ * 
£ùiÚ
);

43 
	`d–AÎCÚfM­
();

45 
maš_cÚfig_t
* 
	`mašcÚfig
();

47 
´iv©e
:

48 
D‘a
* 
pIm¶
;

51 
	`¡rıydup
(** 
d¡
, cÚ¡ * 
¤c
);

	@radfwk/ListMap.hpp

1 #iâdeà
RADFWK_LISTMAP_HPP


2 
	#RADFWK_LISTMAP_HPP


	)

4 
	~<ut™y
>

5 
	~<li¡
>

7 
	g‹m¶©e
 <
şass
 
	gKey
, cÏs 
	gT
>

8 şas 
	cLi¡M­


10 
	mpublic
:

11 
¡d
::
	t·œ
<cÚ¡ 
	tKey
, 
	tT
> 
	tv®ue_ty³
;

12 
	m´iv©e
:

13 
¡d
::
	tli¡
<
	tv®ue_ty³
> 
	t»p_ty³
;

14 
	mpublic
:

15 
ty³Çme
 
	t»p_ty³
::
	t™”©Ü
 iterator;

16 
ty³Çme
 
	t»p_ty³
::
	tcÚ¡_™”©Ü
 const_iterator;

17 
ty³Çme
 
	t»p_ty³
::
	tsize_ty³
 size_type;

19 
™”©Ü
 
	$begš
(è{  
t
.
	`begš
(); }

20 
cÚ¡_™”©Ü
 
	$begš
(ècÚ¡ {  
t
.
	`begš
(); 
	}
}

21 
™”©Ü
 
	$’d
(è{  
t
.
	`’d
(); 
	}
}

22 
cÚ¡_™”©Ü
 
	$’d
(ècÚ¡ { 
t
.
	`’d
(); 
	}
}

23 
size_ty³
 
	$size
(ècÚ¡ {  
t
.
	`size
(); 
	}
}

24 
	$ş—r
(è{ 
t
.
	`ş—r
(); 
	}
}

26 
™”©Ü
 
	$fšd
(cÚ¡ 
Key
& 
keyv®
) {

27 
™”©Ü
 
b
=
	`begš
(), 
e
=
	`’d
();

28 
™”©Ü
 
i
=
b
; i!=
e
; ++ièif(i->
fœ¡
 =ğ
keyv®
)  i;

29  
e
;

30 
	}
}

31 
cÚ¡_™”©Ü
 
	$fšd
(cÚ¡ 
Key
& 
keyv®
) const {

32 
cÚ¡_™”©Ü
 
b
=
	`begš
(), 
e
=
	`’d
();

33 
cÚ¡_™”©Ü
 
i
=
b
; i!=
e
; ++ièif(i->
fœ¡
 =ğ
keyv®
)  i;

34  
e
;

35 
	}
}

37 
	$š£¹
(cÚ¡ 
v®ue_ty³
& 
v®
è{ 
t
.
	`push_back
(v®); 
	}
}

38 
™”©Ü
 
	$”a£
(
™”©Ü
 
wh”e
è{  
t
.
	`”a£
(wh”e); 
	}
}

39 
	$”a£
(cÚ¡ 
Key
& 
keyv®
) {

40 
™”©Ü
 
b
=
	`begš
(), 
e
=
	`’d
();

41 
™”©Ü
 
i
=
b
; i!=
e
; ) i->
fœ¡
 =ğ
keyv®
 ? i = 
	`”a£
(i) : ++i;

42 
	}
}

44 
	g´iv©e
:

45 
»p_ty³
 
t
;

	@radfwk/functors.hpp

1 #iâdeà
RADFWK_FUNCTORS_HPP


2 
	#RADFWK_FUNCTORS_HPP


	)

6 
	g‹m¶©e
 <
şass
 
	gT
>

7 
	sd–‘e_poš‹r
 {

15 
İ”©Ü
()(
T
* 
	mpoš‹r
) const {

16 
d–‘e
 
	mpoš‹r
;

25 
İ”©Ü
()(
	mT
& 
	m·œ
) const {

26 
d–‘e
 
	m·œ
.
	m£cÚd
;

	@radfwk/noncopyable.hpp

9 #iâdeà
BOOST_NONCOPYABLE_HPP_INCLUDED


10 
	#BOOST_NONCOPYABLE_HPP_INCLUDED


	)

12 
Çme¥aû
 
	gboo¡
 {

19 
Çme¥aû
 
	gnÚcİyabË_


21 şas 
	cnÚcİyabË


23 
	g´Ùeùed
:

24 
nÚcİyabË
() {}

25 ~
nÚcİyabË
() {}

26 
´iv©e
:

27 
nÚcİyabË
( const‚oncopyable& );

28 cÚ¡ 
	gnÚcİyabË
& 
	gİ”©Ü
=ĞcÚ¡ 
nÚcİyabË
& );

32 
	gnÚcİyabË_
::
	tnÚcİyabË
‚oncopyable;

	@radsock/log_error.c

1 
	~"¿dut.h
"

2 
	~"¿dsock.h
"

4 
	~<¡ršg.h
>

6 #ià
defšed
(
RAD_OS_WIN32
)

7 
	~<wšsock2.h
>

9 
	~<”ºo.h
>

10 
	~<Ãtdb.h
>

11 
	~<sys/sock‘.h
>

12 
	~<Ãtš‘/š.h
>

13 
	~<¬·/š‘.h
>

15 
	#WSAG‘La¡E¼Ü
(è(
”ºo
)

	)

18 
	$log_sock‘_”rÜ
(
Ëv–
, cÚ¡ * 
fmt
, ...)

20 
buf
[512];

21 
size_t
 
Ën
;

23 
”ºum
 = 
	`WSAG‘La¡E¼Ü
();

25 
va_li¡
 
­
;

26 
	`va_¡¬t
(
­
, 
fmt
);

27 
	`vsN´štf
(
buf
, (buf), 
fmt
, 
­
);

28 
	`va_’d
(
­
);

30 
Ën
 = 
	`¡¾’
(
buf
);

31 
	`sN´štf
(
buf
+
Ën
, (buf)-Ën, ": %d ", 
”ºum
);

33 
Ën
 = 
	`¡¾’
(
buf
);

34 
	`¡»¼Ü_r
(
”ºum
, 
buf
+
Ën
, (buf)-len);

36 
	`¿dlog
(
Ëv–
, 
buf
);

37 
	}
}

	@radsock/radsock.h

10 #iâdeà
__RAD_SOCK_H__


11 
	#__RAD_SOCK_H__


	)

13 #ifdeà
__ılu¥lus


17 
sock‘_š™
();

18 
sock‘_ş—n
();

19 
log_sock‘_”rÜ
(
Ëv–
, cÚ¡ * 
fmt
, ...);

21 
tı_cÚÃù
(cÚ¡ *
ho¡
, 
pÜt
);

22 
tı_li¡’
(cÚ¡ *
ho¡
, 
pÜt
, 
backlog
);

24 
sockaddr_š
;

25 
udp_cÚÃù
(cÚ¡ *
ho¡
, 
pÜt
,

26 
sockaddr_š
* 
£rvaddr
 );

27 
udp_bšd
(cÚ¡ *
ho¡
, 
pÜt
);

29 * 
sock_³”_Çme
(
fd
, * 
addrbuf
, * 
pÜt
);

31 
»cvn
(
fd
, *
v±r
, 
size_t
 
n
);

32 
£ndn
(
fd
, cÚ¡ *
v±r
, 
size_t
 
n
);

33 
»adlše
(
fd
, * 
±r
, 
size_t
 
maxËn
, 
d–im
);

35 
£nd_ema
(cÚ¡ *
sm_£rv”
, cÚ¡ *
sm_h–o
, cÚ¡ *
sm_ema
,

36 cÚ¡ *
mato
, cÚ¡ *
masubjeù
, cÚ¡ *
mabody
);

38 #ifdeà
__ılu¥lus


	@radsock/readline.c

1 
	~"¿dut.h
"

2 
	~"¿dsock.h
"

4 #ià
defšed
(
RAD_OS_WIN32
)

5 
	~<wšsock2.h
>

7 
	~<”ºo.h
>

8 
	~<Ãtdb.h
>

9 
	~<sys/sock‘.h
>

10 
	~<Ãtš‘/š.h
>

11 
	~<¬·/š‘.h
>

13 
	#WSAG‘La¡E¼Ü
(è(
”ºo
)

	)

14 
	#WSAEINTR
 
EINTR


	)

22 
	$»adlše
(
fd
, * 
±r
, 
size_t
 
maxËn
, 
d–im
)

24 
size_t
 
n
;

25 
rc
;

26 
c
;

27 
”r
;

29  
n
 = 1;‚ < 
maxËn
;‚++ ) {

31 iàĞ(
rc
 = 
	`»cv
(
fd
, &
c
, 1, 0)) == 1 ) {

32 *
±r
++ = 
c
;

33 iàĞ
c
 =ğ
d–im
 )

36 iàĞ
rc
 == 0 ) {

37 iàĞ
n
 == 1 )

43 
”r
 = 
	`WSAG‘La¡E¼Ü
();

44 iàĞ
”r
 =ğ
WSAEINTR
 )

47 
	`log_sock‘_”rÜ
(
L_ERROR
|
L_CONS
, "[readline] "

48 "»cv faed oÀfd(%d)", 
fd
);

53 *
±r
 = 0;

54  
n
;

55 
	}
}

	@radsock/recvn.c

1 
	~"¿dut.h
"

2 
	~"¿dsock.h
"

4 #ià
defšed
(
RAD_OS_WIN32
)

5 
	~<wšsock2.h
>

7 
	~<”ºo.h
>

8 
	~<Ãtdb.h
>

9 
	~<sys/sock‘.h
>

10 
	~<Ãtš‘/š.h
>

11 
	~<¬·/š‘.h
>

13 
	#WSAG‘La¡E¼Ü
(è(
”ºo
)

	)

14 
	#WSAEINTR
 
EINTR


	)

15 
	#SOCKET_ERROR
 -1

	)

18 
	$»cvn
(
fd
, *
v±r
, 
size_t
 
n
)

20 
”r
;

21 
size_t
 
Æeá
;

22 
Ä—d
;

23 *
±r
;

25 
±r
 = (*)
v±r
;

26 
Æeá
 = 
n
;

27 
Æeá
 > 0) {

28 iàĞ(
Ä—d
 = 
	`»cv
(
fd
, 
±r
, 
Æeá
, 0)è=ğ
SOCKET_ERROR
) {

29 
”r
 = 
	`WSAG‘La¡E¼Ü
();

30 ià(
”r
 =ğ
WSAEINTR
) {

31 
Ä—d
 = 0;

34 
	`log_sock‘_”rÜ
(
L_ERROR
|
L_CONS
, "[recvn] "

35 "»cv faed oÀfd(%d)", 
fd
);

38 } ià(
Ä—d
 == 0)

41 
Æeá
 -ğ
Ä—d
;

42 
±r
 +ğ
Ä—d
;

44  (
n
 - 
Æeá
);

45 
	}
}

	@radsock/send_email.c

1 
	~"¿dut.h
"

2 
	~"¿dsock.h
"

4 
	~<¡ršg.h
>

5 
	~<¡dlib.h
>

6 
	~<¡dio.h
>

7 
	~<time.h
>

9 #ià
defšed
(
RAD_OS_WIN32
)

10 
	~<wšsock2.h
>

12 
	~<”ºo.h
>

13 
	~<Ãtdb.h
>

14 
	~<uni¡d.h
>

15 
	~<sys/sock‘.h
>

16 
	~<Ãtš‘/š.h
>

17 
	~<¬·/š‘.h
>

19 
	#WSAG‘La¡E¼Ü
(è(
”ºo
)

	)

20 
	#WSAEINTR
 
EINTR


	)

21 
	#SOCKET_ERROR
 -1

	)

22 
	#şo£sock‘
(
s
è
	`şo£
(s)

	)

23 
	tSOCKET
;

26 cÚ¡ *
	gOK_220
="220";

27 cÚ¡ *
	gOK_250
="250";

28 cÚ¡ *
	gOK_251
="251";

29 cÚ¡ *
	gOK_354
="354";

31 
	$£nd_msg
(
SOCKET
 
s
, cÚ¡ * 
fmt
, ...)

33 
»tv®
;

34 
buf
[4096];

36 
va_li¡
 
­
;

37 
	`va_¡¬t
(
­
, 
fmt
);

38 
	`vsN´štf
(
buf
, (buf), 
fmt
, 
­
);

39 
	`va_’d
(
­
);

41 
	`DEBUG
("[£nd_ema] %s", 
buf
);

43 
»tv®
 = 
	`£nd
(
s
, 
buf
, 
	`¡¾’
(buf), 0);

44 if(
»tv®
 =ğ
SOCKET_ERROR
) {

45 
	`log_sock‘_”rÜ
(
L_ERROR
|
L_CONS
, "[£nd_ema] %s", 
buf
);

50 
	}
}

52 
	$»cv_msg
(
SOCKET
 
s
, cÚ¡ * 
hšt
, cÚ¡ * 
code
, ...)

54 
»tv®
;

55 
buf
[256];

56 cÚ¡ * 
c
 = 
NULL
;

58 
va_li¡
 
­
;

60 
	`DEBUG
("[£nd_ema] %s", 
hšt
);

62 
»tv®
 = 
	`»cv
(
s
, 
buf
, (buf), 0);

63 if(
»tv®
 =ğ
SOCKET_ERROR
) {

64 
	`log_sock‘_”rÜ
(
L_ERROR
|
L_CONS
, "[£nd_ema] %s", 
hšt
);

67 if(
»tv®
 == 0) {

68 
	`¿dlog
(
L_ERROR
|
L_CONS
, "[£nd_ema] %s: CÚÃùiÚ i şo£d by„emÙe", 
hšt
);

72 
	`DEBUG
("[£nd_ema] %s", 
buf
);

74 if(
code
) {

75 
	`va_¡¬t
(
­
, 
code
);

78 if(
	`¡ºcmp
(
code
, 
buf
, 
	`¡¾’
(code)) != 0) {

79 
c
 = 
code
;

81 
c
 = 
NULL
;

85 } (
code
 = 
	`va_¬g
(
­
, const *)));

86 
	`va_’d
(
­
);

89 if(
c
) {

90 
	`¿dlog
(
L_ERROR
|
L_CONS
, "[£nd_ema] %s: UÃx³ùed„esuÉ: %s", 
hšt
, 
buf
);

95 
	}
}

97 
	#SEND_MSG0
(
s
, 
x
èif(
	`£nd_msg
(s, x)è
”rÜ


	)

98 
	#SEND_MSG1
(
s
, 
x
, 
x1
èif(
	`£nd_msg
(s, x, x1)è
”rÜ


	)

99 
	#SEND_MSG2
(
s
, 
x
, 
x1
, 
x2
èif(
	`£nd_msg
(s, x, x1, x2)è
”rÜ


	)

100 
	#SEND_MSG3
(
s
, 
x
, 
x1
, 
x2
, 
x3
èif(
	`£nd_msg
(s, x, x1, x2, x3)è
”rÜ


	)

101 
	#SEND_MSG4
(
s
, 
x
, 
x1
, 
x2
, 
x3
, 
x4
èif(
	`£nd_msg
(s, x, x1, x2, x3, x4)è
”rÜ


	)

102 
	#SEND_MSG5
(
s
, 
x
, 
x1
, 
x2
, 
x3
, 
x4
, 
x5
èif(
	`£nd_msg
(s, x, x1, x2, x3, x4, x5)è
”rÜ


	)

103 
	#SEND_MSG6
(
s
, 
x
, 
x1
, 
x2
, 
x3
, 
x4
, 
x5
, 
x6
èif(
	`£nd_msg
(s, x, x1, x2, x3, x4, x5, x6)è
”rÜ


	)

104 
	#SEND_MSG7
(
s
, 
x
, 
x1
, 
x2
, 
x3
, 
x4
, 
x5
, 
x6
, 
x7
èif(
	`£nd_msg
(s, x, x1, x2, x3, x4, x5, x6, x7)è
”rÜ


	)

105 
	#SEND_MSG8
(
s
, 
x
, 
x1
, 
x2
, 
x3
, 
x4
, 
x5
, 
x6
, 
x7
, 
x8
èif(
	`£nd_msg
(s, x, x1, x2, x3, x4, x5, x6, x7, x8)è
”rÜ


	)

106 
	#SEND_MSG9
(
s
, 
x
, 
x1
, 
x2
, 
x3
, 
x4
, 
x5
, 
x6
, 
x7
, 
x8
, 
x9
èif(
	`£nd_msg
(s, x, x1, x2, x3, x4, x5, x6, x7, x8), x9è
”rÜ


	)

108 
	#RECV_MSG0
(
s
, 
h
, 
x
èif(
	`»cv_msg
(s, h, x)è
”rÜ


	)

109 
	#RECV_MSG1
(
s
, 
h
, 
x
, 
x1
èif(
	`»cv_msg
(s, h, x, x1)è
”rÜ


	)

110 
	#RECV_MSG2
(
s
, 
h
, 
x
, 
x1
, 
x2
èif(
	`»cv_msg
(s, h, x, x1, x2)è
”rÜ


	)

111 
	#RECV_MSG3
(
s
, 
h
, 
x
, 
x1
, 
x2
, 
x3
èif(
	`»cv_msg
(s, h, x, x1, x2, x3)è
”rÜ


	)

112 
	#RECV_MSG4
(
s
, 
h
, 
x
, 
x1
, 
x2
, 
x3
, 
x4
èif(
	`»cv_msg
(s, h, x, x1, x2, x3, x4)è
”rÜ


	)

113 
	#RECV_MSG5
(
s
, 
h
, 
x
, 
x1
, 
x2
, 
x3
, 
x4
, 
x5
èif(
	`»cv_msg
(s, h, x, x1, x2, x3, x4, x5)è
”rÜ


	)

114 
	#RECV_MSG6
(
s
, 
h
, 
x
, 
x1
, 
x2
, 
x3
, 
x4
, 
x5
, 
x6
èif(
	`»cv_msg
(s, h, x, x1, x2, x3, x4, x5, x6)è
”rÜ


	)

115 
	#RECV_MSG7
(
s
, 
h
, 
x
, 
x1
, 
x2
, 
x3
, 
x4
, 
x5
, 
x6
, 
x7
èif(
	`»cv_msg
(s, h, x, x1, x2, x3, x4, x5, x6, x7)è
”rÜ


	)

116 
	#RECV_MSG8
(
s
, 
h
, 
x
, 
x1
, 
x2
, 
x3
, 
x4
, 
x5
, 
x6
, 
x7
, 
x8
èif(
	`»cv_msg
(s, h, x, x1, x2, x3, x4, x5, x6, x7, x8)è
”rÜ


	)

117 
	#RECV_MSG9
(
s
, 
h
, 
x
, 
x1
, 
x2
, 
x3
, 
x4
, 
x5
, 
x6
, 
x7
, 
x8
, 
x9
èif(
	`»cv_msg
(s, h, x, x1, x2, x3, x4, x5, x6, x7, x8), x9è
”rÜ


	)

119 
	$£nd_ema
(cÚ¡ *
sm_£rv”
, cÚ¡ *
sm_h–o
, cÚ¡ *
sm_ema
,

120 cÚ¡ *
mato
, cÚ¡ *
masubjeù
, cÚ¡ *
mabody
)

122 * 
p
;

123 
ma£rv
[256];

124 
sm_pÜt
;

125 
time_t
 
ema_time
;

126 
tm
 
loÿl_time
;

127 
¡r_time
[64];

128 
SOCKET
 
s
;

131 
	`¡rNıy
(
ma£rv
, 
sm_£rv”
, (mailserv));

132 
p
 = 
	`¡¼chr
(
ma£rv
, ':');

133 if(
p
) {

134 *
p
 = '\0';

135 
sm_pÜt
 = 
	`©oi
(
p
+1);

136 
sm_£rv”
 = 
ma£rv
;

138 
sm_pÜt
 = 25;

139 
sm_£rv”
 = 
ma£rv
;

142 
	`DEBUG
("[£nd_ema] cÚÃùšgØsm s”v” %s:%d", 
sm_£rv”
, 
sm_pÜt
);

143 if((
s
 = 
	`tı_cÚÃù
(
sm_£rv”
, 
sm_pÜt
)) == -1)

146 
	`RECV_MSG1
(
s
, "»cv w–come", 
OK_220
, 
NULL
);

148 if(
sm_h–o
 && smtp_helo[0]) {

149 
	`SEND_MSG1
(
s
, "HELO %s\r\n", 
sm_h–o
);

150 
	`RECV_MSG1
(
s
, "»cv h–o", 
OK_250
, 
NULL
);

153 
	`SEND_MSG1
(
s
, "MAIL FROM: <%s>\r\n", 
sm_ema
);

154 
	`RECV_MSG1
(
s
, "»cv ma from", 
OK_250
, 
NULL
);

156 
	`SEND_MSG1
(
s
, "RCPT TO: <%s>\r\n", 
mato
);

158 
	`RECV_MSG2
(
s
, "»cv„ıˆto", 
OK_250
, 
OK_251
, 
NULL
);

160 
	`SEND_MSG0
(
s
, "DATA\r\n");

161 
	`RECV_MSG1
(
s
, "»cv d©a", 
OK_354
, 
NULL
);

163 
	`time
(&
ema_time
);

164 
	`loÿÉime_r
(&
ema_time
, &
loÿl_time
);

165 
	`¡ráime
(
¡r_time
, (¡r_time), "%a, %d %b %Y %H:%M:%S %z", &
loÿl_time
);

167 
	`SEND_MSG5
(
s
, "From: <%s>\r\nTo: <%s>\r\nDate: %s\r\nSubject: %s\r\n\r\n%s",

168 
sm_ema
, 
mato
, 
¡r_time
, 
masubjeù
, 
mabody
);

169 
	`SEND_MSG0
(
s
, "\r\n.\r\n");

170 
	`RECV_MSG1
(
s
, "»cv cÚ‹Á", 
OK_250
, 
NULL
);

172 
	`SEND_MSG0
(
s
, "QUIT\r\n");

173 
	`DEBUG
("[send_email] ok");

176 
”rÜ
:

177 
	`şo£sock‘
(
s
);

179 
	}
}

	@radsock/sendn.c

1 
	~"¿dut.h
"

2 
	~"¿dsock.h
"

4 #ià
defšed
(
RAD_OS_WIN32
)

5 
	~<wšsock2.h
>

7 
	~<”ºo.h
>

8 
	~<Ãtdb.h
>

9 
	~<sys/sock‘.h
>

10 
	~<Ãtš‘/š.h
>

11 
	~<¬·/š‘.h
>

13 
	#WSAG‘La¡E¼Ü
(è(
”ºo
)

	)

14 
	#WSAEINTR
 
EINTR


	)

15 
	#SOCKET_ERROR
 -1

	)

18 
	$£ndn
(
fd
, cÚ¡ *
v±r
, 
size_t
 
n
)

20 
”r
;

21 
size_t
 
Æeá
;

22 
nwr™‹n
;

23 cÚ¡ *
±r
;

25 
±r
 = (cÚ¡ *)
v±r
;

26 
Æeá
 = 
n
;

27 
Æeá
 > 0) {

28 iàĞ(
nwr™‹n
 = 
	`£nd
(
fd
, 
±r
, 
Æeá
, 0)è=ğ
SOCKET_ERROR
) {

29 
”r
 = 
	`WSAG‘La¡E¼Ü
();

30 ià(
”r
 =ğ
WSAEINTR
) {

31 
nwr™‹n
 = 0;

34 
	`log_sock‘_”rÜ
(
L_ERROR
|
L_CONS
, "[sendn] "

35 "£nd faed oÀfd(%d)", 
fd
);

40 
Æeá
 -ğ
nwr™‹n
;

41 
±r
 +ğ
nwr™‹n
;

43  
n
;

44 
	}
}

	@radsock/sock_peer_name.c

1 
	~"¿dut.h
"

2 
	~"¿dsock.h
"

4 
	~<¡ršg.h
>

6 #ià
defšed
(
RAD_OS_WIN32
)

7 
	~<wšsock2.h
>

9 
	~<”ºo.h
>

10 
	~<Ãtdb.h
>

11 
	~<sys/sock‘.h
>

12 
	~<Ãtš‘/š.h
>

13 
	~<¬·/š‘.h
>

16 * 
	$sock_³”_Çme
(
fd
, * 
addrbuf
, * 
pÜt
)

18 
sockaddr_š
 
sockšfo
;

19 
š_addr
 
add»ss
;

20 
sockšfosize
 = (
sockšfo
);

23 
	`g‘³”Çme
(
fd
, (
sockaddr
 *)&
sockšfo
, &
sockšfosize
);

24 
	`memıy
(&
add»ss
, &
sockšfo
.
sš_addr
, (address));

25 if(
pÜt
è*pÜˆğ
sockšfo
.
sš_pÜt
;

27  
	`_Áß
(
addrbuf
, 
add»ss
.
s_addr
);

28 
	}
}

	@radsock/socket_init.c

1 
	~"¿dut.h
"

2 
	~"¿dsock.h
"

3 #ià
defšed
(
RAD_OS_WIN32
)

5 
	~<wšsock2.h
>

7 
	$sock‘_š™
()

13 
WORD
 
wV”siÚReque¡ed
;

14 
WSADATA
 
w§D©a
;

15 
”r
;

17 
wV”siÚReque¡ed
 = 
	`MAKEWORD
(2, 2);

18 ià((
”r
 = 
	`WSAS¹up
(
wV”siÚReque¡ed
, &
w§D©a
)) != 0)

20 
	`¿dlog
(
L_FATAL
|
L_CONS
, "WSAS¹u°occur ”rÜ(%d)", 
”r
);

29 iàĞ
	`LOBYTE
Ğ
w§D©a
.
wV”siÚ
 ) != 2 ||

30 
	`HIBYTE
Ğ
w§D©a
.
wV”siÚ
 ) != 2 ) {

33 
	`WSACËªup
();

34 
	`¿dlog
(
L_FATAL
|
L_CONS
, "Can‚ot‡cquire winsock 2.2");

38 
	}
}

40 
	$sock‘_ş—n
()

42 if(
	`WSACËªup
(è=ğ
SOCKET_ERROR
) {

43 
	`¿dlog
(
L_WARN
|
L_CONS
, "WSACËªu°occur ”rÜ(%d)", 
	`WSAG‘La¡E¼Ü
());

45 
	}
}

49 
	$sock‘_š™
()

51 
	}
}

53 
	$sock‘_ş—n
()

55 
	}
}

	@radsock/tcp_connect.c

1 
	~"¿dut.h
"

2 
	~"¿dsock.h
"

4 
	~<¡ršg.h
>

6 #ià
defšed
(
RAD_OS_WIN32
)

7 
	~<wšsock2.h
>

9 
	~<uni¡d.h
>

10 
	~<”ºo.h
>

11 
	~<Ãtdb.h
>

12 
	~<sys/sock‘.h
>

13 
	~<Ãtš‘/š.h
>

14 
	~<¬·/š‘.h
>

16 
	#WSAG‘La¡E¼Ü
(è(
”ºo
)

	)

17 
	#şo£sock‘
(
s
è
	`şo£
(s)

	)

18 
	#SOCKET_ERROR
 -1

	)

19 
	#INVALID_SOCKET
 -1

	)

20 #iâdeà
INADDR_NONE


21 
	#INADDR_NONE
 0xffffffff

	)

23 
	tSOCKET
;

26 
	$tı_cÚÃù
(cÚ¡ *
ho¡
, 
pÜt
)

28 
SOCKET
 
sockfd
;

29 
sockaddr_š
 
£rvaddr
;

30 
buf
[16];

32 if((
sockfd
 = 
	`sock‘
(
AF_INET
, 
SOCK_STREAM
, 0)è=ğ
INVALID_SOCKET
) {

33 
	`log_sock‘_”rÜ
(
L_ERROR
|
L_CONS
, "[tcp_connect] "

35 
ho¡
, 
pÜt
);

39 
	`mem£t
(&
£rvaddr
, 0, (servaddr));

41 
£rvaddr
.
sš_çmy
 = 
AF_INET
;

42 
£rvaddr
.
sš_pÜt
 = 
	`htÚs
(
pÜt
);

43 
£rvaddr
.
sš_addr
.
s_addr
 = 
	`_g‘addr
(
ho¡
);

45 if(
£rvaddr
.
sš_addr
.
s_addr
 =ğ
	`htÚl
(
INADDR_NONE
)) {

46 
	`¿dlog
(
L_ERROR
|
L_CONS
, "[tcp_connect] "

47 "šv®id ho¡ %s", 
ho¡
);

48 
	`şo£sock‘
(
sockfd
);

52 ià(
	`cÚÃù
(
sockfd
, (
sockaddr
 *è&
£rvaddr
, (£rvaddr)è=ğ
SOCKET_ERROR
) {

53 
	`log_sock‘_”rÜ
(
L_ERROR
|
L_CONS
, "[tcp_connect] "

55 
ho¡
, 
	`_Áß
(
buf
, 
£rvaddr
.
sš_addr
.
s_addr
), 
pÜt
);

56 
	`şo£sock‘
(
sockfd
);

60 
	`DEBUG
("[tı_cÚÃù] % (%s:%d), gÙ sockfd(%d)", 
ho¡
,

61 
	`_Áß
(
buf
, 
£rvaddr
.
sš_addr
.
s_addr
), 
pÜt
, 
sockfd
);

63  
sockfd
;

64 
	}
}

	@radsock/tcp_listen.c

1 
	~"¿dut.h
"

2 
	~"¿dsock.h
"

4 
	~<¡ršg.h
>

6 #ià
defšed
(
RAD_OS_WIN32
)

7 
	~<wšsock2.h
>

9 
	~<uni¡d.h
>

10 
	~<”ºo.h
>

11 
	~<Ãtdb.h
>

12 
	~<sys/sock‘.h
>

13 
	~<Ãtš‘/š.h
>

14 
	~<¬·/š‘.h
>

16 
	#WSAG‘La¡E¼Ü
(è(
”ºo
)

	)

17 
	#şo£sock‘
(
s
è
	`şo£
(s)

	)

18 
	#SOCKET_ERROR
 -1

	)

19 
	#INVALID_SOCKET
 -1

	)

20 #iâdeà
INADDR_NONE


21 
	#INADDR_NONE
 0xffffffff

	)

23 
	tSOCKET
;

26 
	$tı_li¡’
(cÚ¡ *
ho¡
, 
pÜt
, 
backlog
)

28 
SOCKET
 
li¡’fd
;

29 
sockaddr_š
 
£rvaddr
;

30 
buf
[16];

32 if((
li¡’fd
 = 
	`sock‘
(
AF_INET
, 
SOCK_STREAM
, 0)è=ğ
INVALID_SOCKET
) {

33 
	`log_sock‘_”rÜ
(
L_ERROR
|
L_CONS
, "[tcp_listen] "

35 
ho¡
, 
pÜt
);

39 
	`mem£t
(&
£rvaddr
, 0, (servaddr));

41 
£rvaddr
.
sš_çmy
 = 
AF_INET
;

42 
£rvaddr
.
sš_pÜt
 = 
	`htÚs
(
pÜt
);

43 if(
	`¡rcmp
(
ho¡
, "*") == 0)

44 
£rvaddr
.
sš_addr
.
s_addr
 = 
	`htÚl
(
INADDR_ANY
);

46 
£rvaddr
.
sš_addr
.
s_addr
 = 
	`_g‘addr
(
ho¡
);

48 if(
£rvaddr
.
sš_addr
.
s_addr
 =ğ
	`htÚl
(
INADDR_NONE
)) {

49 
	`¿dlog
(
L_ERROR
|
L_CONS
, "[tcp_listen] "

50 "šv®id ho¡ %s", 
ho¡
);

51 
	`şo£sock‘
(
li¡’fd
);

55 ià(
	`bšd
(
li¡’fd
, (
sockaddr
 *è&
£rvaddr
, (£rvaddr)è=ğ
SOCKET_ERROR
) {

56 
	`log_sock‘_”rÜ
(
L_ERROR
|
L_CONS
, "[tcp_listen] "

58 
ho¡
, 
	`_Áß
(
buf
, 
£rvaddr
.
sš_addr
.
s_addr
), 
pÜt
);

59 
	`şo£sock‘
(
li¡’fd
);

63 ià(
	`li¡’
(
li¡’fd
, 
backlog
è=ğ
SOCKET_ERROR
) {

64 
	`log_sock‘_”rÜ
(
L_ERROR
|
L_CONS
, "[tcp_listen] "

66 
ho¡
, 
	`_Áß
(
buf
, 
£rvaddr
.
sš_addr
.
s_addr
), 
pÜt
);

67 
	`şo£sock‘
(
li¡’fd
);

71 
	`DEBUG
("[tı_li¡’] % (%s:%dè[%d], gÙ†i¡’fd(%d)", 
ho¡
,

72 
	`_Áß
(
buf
, 
£rvaddr
.
sš_addr
.
s_addr
), 
pÜt
, 
backlog
, 
li¡’fd
);

74  
li¡’fd
;

75 
	}
}

	@radsock/udp_bind.c

1 
	~"¿dut.h
"

2 
	~"¿dsock.h
"

4 
	~<¡ršg.h
>

6 #ià
defšed
(
RAD_OS_WIN32
)

7 
	~<wšsock2.h
>

9 
	~<uni¡d.h
>

10 
	~<”ºo.h
>

11 
	~<Ãtdb.h
>

12 
	~<sys/sock‘.h
>

13 
	~<Ãtš‘/š.h
>

14 
	~<¬·/š‘.h
>

16 
	#WSAG‘La¡E¼Ü
(è(
”ºo
)

	)

17 
	#şo£sock‘
(
s
è
	`şo£
(s)

	)

18 
	#SOCKET_ERROR
 -1

	)

19 
	#INVALID_SOCKET
 -1

	)

20 #iâdeà
INADDR_NONE


21 
	#INADDR_NONE
 0xffffffff

	)

23 
	tSOCKET
;

26 
	$udp_bšd
(cÚ¡ *
ho¡
, 
pÜt
)

28 
SOCKET
 
bšdfd
;

29 
sockaddr_š
 
£rvaddr
;

30 
buf
[16];

32 if((
bšdfd
 = 
	`sock‘
(
AF_INET
, 
SOCK_DGRAM
, 0)è=ğ
INVALID_SOCKET
) {

33 
	`log_sock‘_”rÜ
(
L_ERROR
|
L_CONS
, "[udp_bind] "

35 
ho¡
, 
pÜt
);

39 
	`mem£t
(&
£rvaddr
, 0, (servaddr));

41 
£rvaddr
.
sš_çmy
 = 
AF_INET
;

42 
£rvaddr
.
sš_pÜt
 = 
	`htÚs
(
pÜt
);

43 if(
	`¡rcmp
(
ho¡
, "*") == 0)

44 
£rvaddr
.
sš_addr
.
s_addr
 = 
	`htÚl
(
INADDR_ANY
);

46 
£rvaddr
.
sš_addr
.
s_addr
 = 
	`_g‘addr
(
ho¡
);

48 if(
£rvaddr
.
sš_addr
.
s_addr
 =ğ
	`htÚl
(
INADDR_NONE
)) {

49 
	`¿dlog
(
L_ERROR
|
L_CONS
, "[udp_bind] "

50 "šv®id ho¡ %s", 
ho¡
);

51 
	`şo£sock‘
(
bšdfd
);

55 ià(
	`bšd
(
bšdfd
, (
sockaddr
 *è&
£rvaddr
, (£rvaddr)è=ğ
SOCKET_ERROR
) {

56 
	`log_sock‘_”rÜ
(
L_ERROR
|
L_CONS
, "[udp_bind] "

58 
ho¡
, 
	`_Áß
(
buf
, 
£rvaddr
.
sš_addr
.
s_addr
), 
pÜt
);

59 
	`şo£sock‘
(
bšdfd
);

63 
	`DEBUG
("[udp_bšd] % (%s:%d), gÙ bšdfd(%d)", 
ho¡
,

64 
	`_Áß
(
buf
, 
£rvaddr
.
sš_addr
.
s_addr
), 
pÜt
, 
bšdfd
);

66  
bšdfd
;

67 
	}
}

	@radsock/udp_connect.c

1 
	~"¿dut.h
"

2 
	~"¿dsock.h
"

4 
	~<¡ršg.h
>

6 #ià
defšed
(
RAD_OS_WIN32
)

7 
	~<wšsock2.h
>

9 
	~<uni¡d.h
>

10 
	~<”ºo.h
>

11 
	~<Ãtdb.h
>

12 
	~<sys/sock‘.h
>

13 
	~<Ãtš‘/š.h
>

14 
	~<¬·/š‘.h
>

16 
	#WSAG‘La¡E¼Ü
(è(
”ºo
)

	)

17 
	#şo£sock‘
(
s
è
	`şo£
(s)

	)

18 
	#SOCKET_ERROR
 -1

	)

19 
	#INVALID_SOCKET
 -1

	)

20 #iâdeà
INADDR_NONE


21 
	#INADDR_NONE
 0xffffffff

	)

23 
	tSOCKET
;

26 
	$udp_cÚÃù
(cÚ¡ *
ho¡
, 
pÜt
,

27 
sockaddr_š
* 
£rvaddr
 )

29 
SOCKET
 
sockfd
;

30 
buf
[16];

32 if((
sockfd
 = 
	`sock‘
(
AF_INET
, 
SOCK_DGRAM
, 0)è=ğ
INVALID_SOCKET
) {

33 
	`log_sock‘_”rÜ
(
L_ERROR
|
L_CONS
, "[udp_connect] "

35 
ho¡
, 
pÜt
);

39 
	`mem£t
(
£rvaddr
, 0, (
sockaddr_š
));

41 
£rvaddr
->
sš_çmy
 = 
AF_INET
;

42 
£rvaddr
->
sš_pÜt
 = 
	`htÚs
(
pÜt
);

43 
£rvaddr
->
sš_addr
.
s_addr
 = 
	`_g‘addr
(
ho¡
);

45 if(
£rvaddr
->
sš_addr
.
s_addr
 =ğ
	`htÚl
(
INADDR_NONE
)) {

46 
	`¿dlog
(
L_ERROR
|
L_CONS
, "[udp_connect] "

47 "šv®id ho¡ %s", 
ho¡
);

48 
	`şo£sock‘
(
sockfd
);

52 ià(
	`cÚÃù
(
sockfd
, (
sockaddr
 *è
£rvaddr
, (
sockaddr_š
))

53 =ğ
SOCKET_ERROR
) {

54 
	`log_sock‘_”rÜ
(
L_WARN
|
L_CONS
, "[udp_connect] "

56 
ho¡
, 
	`_Áß
(
buf
, 
£rvaddr
->
sš_addr
.
s_addr
), 
pÜt
);

59 
	`DEBUG
("[udp_cÚÃù] % (%s:%d), gÙ sockfd(%d)", 
ho¡
,

60 
	`_Áß
(
buf
, 
£rvaddr
->
sš_addr
.
s_addr
), 
pÜt
, 
sockfd
);

62  
sockfd
;

63 
	}
}

	@radsql/dbutil.cpp

1 
	~"¿dut.h
"

2 
	~"¿dsql.h
"

3 
	~"dbut.hµ
"

5 
	gDBUt
::
	$In™
(cÚ¡ * 
cÚffe
, cÚ¡ * 
db£ùiÚ
, cÚ¡ * 
log£ùiÚ
)

7 
SQL_INST
* 
sqlš¡
 = 
NULL
;

10 
	`F»e
();

13 
	`¾m_sql_š™
();

16 
CONF_SECTION
 *
cÚf
;

17 
cÚf
 = 
	`cÚf_»ad
(
__FILE__
, 
__LINE__
, 
cÚffe
, 
NULL
);

18 if(!
cÚf
) {

19 
	`¿dlog
(
L_CONS
|
L_ERROR
, "[DBUt::DBUt] cª‚Ù„—d '%s'", 
cÚffe
);

20 
	`¾m_sql_de¡roy
();

25 
CONF_SECTION
* 
sqlcÚf
 = 
	`cf_£ùiÚ_sub_fšd
(
cÚf
, 
db£ùiÚ
);

26 if(!
sqlcÚf
) {

27 
	`¿dlog
(
L_CONS
|
L_ERROR
, "[DBUt::DBUt] cª‚Ù fšd sub seùiÚ '%s'", 
db£ùiÚ
);

28 
	`cf_£ùiÚ_ä“
(&
cÚf
);

29 
	`¾m_sql_de¡roy
();

34 
CONF_SECTION
* 
logcÚf
 = 
NULL
;

35 if(
log£ùiÚ
) {

36 
logcÚf
 = 
	`cf_£ùiÚ_sub_fšd
(
cÚf
, 
log£ùiÚ
);

37 if(!
logcÚf
) {

38 
	`¿dlog
(
L_CONS
|
L_WARN
, "[DBUtil::DBUtil] can‚ot find sub section '%s', "

41 
log£ùiÚ
);

46 if(
	`¾m_sql_š¡ªtŸ‹
(
sqlcÚf
, &
sqlš¡
, 
logcÚf
) != 0) {

47 
	`¿dlog
(
L_CONS
|
L_ERROR
, "[DBUtil::DBUtil] can‚ot instantiate sql instance");

48 
	`cf_£ùiÚ_ä“
(&
cÚf
);

49 
	`¾m_sql_de¡roy
();

54 
	`cf_£ùiÚ_ä“
(&
cÚf
);

56 
dbHªdË_
 = 
sqlš¡
;

59 
	}
}

61 
	gDBUt
::
	$F»e
()

63 
SQL_INST
* 
sqlš¡
 = (SQL_INST*)
dbHªdË_
;

64 if(
sqlš¡
) {

66 
	`¾m_sql_d‘ach
(
sqlš¡
);

69 
	`¾m_sql_de¡roy
();

72 
dbHªdË_
 = 0;

74 
	}
}

76 
boŞ
 
	gDBUt
::
	$V®id
() const

78  (
dbHªdË_
 != 0);

79 
	}
}

81 
	gDBUt
::
	$DBUt
(cÚ¡ * 
cÚffe
, cÚ¡ * 
db£ùiÚ
, cÚ¡ * 
log£ùiÚ
)

82 : 
	`dbHªdË_
(0)

84 
	`In™
(
cÚffe
, 
db£ùiÚ
, 
log£ùiÚ
);

85 
	}
}

87 
	gDBUt
::~
	$DBUt
()

89 
	`F»e
();

90 
	}
}

93 
S–eùFœ¡RowIÁ”Çl
(
SQL_INST
* 
sqlš¡
, cÚ¡ * 
sqlbuf
, 
DBUt
::
Row
& 
row
)

95 
SQLSOCK
* 
sqlsock
 = 
sql_g‘_sock‘
(
sqlš¡
);

96 if(
	gsqlsock
 =ğ
NULL
) {

100 if(
¾m_sql_£Ëù_qu”y
(
sqlsock
, 
sqlš¡
, 
sqlbuf
) != 0) {

101 
sql_»Ëa£_sock‘
(
sqlš¡
, 
sqlsock
);

105 if(
¾m_sql_ãtch_row
(
sqlsock
, 
sqlš¡
) != 0) {

106 
¾m_sql_fšish_£Ëù_qu”y
(
sqlsock
, 
sqlš¡
);

107 
sql_»Ëa£_sock‘
(
sqlš¡
, 
sqlsock
);

111 if(
	gsqlsock
->
	grow
 =ğ
NULL
) {

112 
¾m_sql_fšish_£Ëù_qu”y
(
sqlsock
, 
sqlš¡
);

113 
sql_»Ëa£_sock‘
(
sqlš¡
, 
sqlsock
);

117 
	gcŞút
 = 
¾m_sql_num_f›lds
(
sqlsock
, 
sqlš¡
);

118 
	grow
.
ş—r
();

119 
	gi
=0; i<
	gcŞút
; ++i)

120 
	grow
.
push_back
(
sqlsock
->
row
[
i
]);

121 
¾m_sql_fšish_£Ëù_qu”y
(
sqlsock
, 
sqlš¡
);

122 
sql_»Ëa£_sock‘
(
sqlš¡
, 
sqlsock
);

127 
S–eùLa¡RowIÁ”Çl
(
SQL_INST
* 
sqlš¡
, cÚ¡ * 
sqlbuf
, 
DBUt
::
Row
& 
row
)

129 
SQLSOCK
* 
sqlsock
 = 
sql_g‘_sock‘
(
sqlš¡
);

130 if(
	gsqlsock
 =ğ
NULL
) {

134 if(
¾m_sql_£Ëù_qu”y
(
sqlsock
, 
sqlš¡
, 
sqlbuf
) != 0) {

135 
sql_»Ëa£_sock‘
(
sqlš¡
, 
sqlsock
);

139 
	gcŞút
 = 
¾m_sql_num_f›lds
(
sqlsock
, 
sqlš¡
);

140 
	grownum
 = 0;

141 
	grow
.
ş—r
();

143 if(
¾m_sql_ãtch_row
(
sqlsock
, 
sqlš¡
) != 0) {

144 
rownum
 = -1;

148 if(
	gsqlsock
->
	grow
 =ğ
NULL
) {

152 ++
	grownum
;

153 
	grow
.
ş—r
();

154 
	gi
=0; i<
	gcŞút
; ++i)

155 
	grow
.
push_back
(
sqlsock
->
row
[
i
]);

158 
¾m_sql_fšish_£Ëù_qu”y
(
sqlsock
, 
sqlš¡
);

159 
sql_»Ëa£_sock‘
(
sqlš¡
, 
sqlsock
);

160  
	grownum
;

163 
	gDBUt
::
	$S–eùFœ¡Row
(
Row
& 
row
, cÚ¡ * 
sql
, ...)

165 
SQL_INST
* 
sqlš¡
 = (SQL_INST*)
dbHªdË_
;

166 if(
sqlš¡
 == 0) {

167 
	`¿dlog
(
L_CONS
|
L_ERROR
, "[DBUtil::SelectFirstRow] invalid instance");

171 
sqlbuf
[4096];

172 
va_li¡
 
¬gs
;

173 
	`va_¡¬t
(
¬gs
, 
sql
);

174 
	`vsN´štf
(
sqlbuf
, (sqlbuf), 
sql
, 
¬gs
);

175 
	`va_’d
(
¬gs
);

177  
	`S–eùFœ¡RowIÁ”Çl
(
sqlš¡
, 
sqlbuf
, 
row
);

178 
	}
}

180 
	gDBUt
::
	$S–eùLa¡Row
 (
Row
& 
row
, cÚ¡ * 
sql
, ...)

182 
SQL_INST
* 
sqlš¡
 = (SQL_INST*)
dbHªdË_
;

183 if(
sqlš¡
 == 0) {

184 
	`¿dlog
(
L_CONS
|
L_ERROR
, "[DBUtil::SelectLastRow] invalid instance");

188 
sqlbuf
[4096];

189 
va_li¡
 
¬gs
;

190 
	`va_¡¬t
(
¬gs
, 
sql
);

191 
	`vsN´štf
(
sqlbuf
, (sqlbuf), 
sql
, 
¬gs
);

192 
	`va_’d
(
¬gs
);

194  
	`S–eùLa¡RowIÁ”Çl
(
sqlš¡
, 
sqlbuf
, 
row
);

195 
	}
}

197 
	gDBUt
::
	$Qu”yFÜIÁ
(cÚ¡ * 
sql
, ...)

199 
SQL_INST
* 
sqlš¡
 = (SQL_INST*)
dbHªdË_
;

200 if(
sqlš¡
 == 0) {

201 
	`¿dlog
(
L_CONS
|
L_ERROR
, "[DBUtil::QueryForInt] invalid instance");

205 
sqlbuf
[4096];

206 
va_li¡
 
¬gs
;

207 
	`va_¡¬t
(
¬gs
, 
sql
);

208 
	`vsN´štf
(
sqlbuf
, (sqlbuf), 
sql
, 
¬gs
);

209 
	`va_’d
(
¬gs
);

211 
Row
 
row
;

212 
»suÉ
 = 
	`S–eùFœ¡RowIÁ”Çl
(
sqlš¡
, 
sqlbuf
, 
row
);

213 if(
»suÉ
 <= 0)

216  
	`©oi
(
row
[0].
	`c_¡r
());

217 
	}
}

219 
	gDBUt
::
	$Qu”yFÜSŒšg
(* 
buf
, 
size_t
 
buæ’
, cÚ¡ * 
sql
, ...)

221 
SQL_INST
* 
sqlš¡
 = (SQL_INST*)
dbHªdË_
;

222 if(
sqlš¡
 == 0) {

223 
	`¿dlog
(
L_CONS
|
L_ERROR
, "[DBUtil::QueryForString] invalid instance");

227 
sqlbuf
[4096];

228 
va_li¡
 
¬gs
;

229 
	`va_¡¬t
(
¬gs
, 
sql
);

230 
	`vsN´štf
(
sqlbuf
, (sqlbuf), 
sql
, 
¬gs
);

231 
	`va_’d
(
¬gs
);

233 
Row
 
row
;

234 
»suÉ
 = 
	`S–eùFœ¡RowIÁ”Çl
(
sqlš¡
, 
sqlbuf
, 
row
);

235 if(
»suÉ
 < 0)

236 
	`¡rNıy
(
buf
, "<DBERROR>", 
buæ’
);

237 if(
»suÉ
 == 0)

238 
	`¡rNıy
(
buf
, "<NORESULT>", 
buæ’
);

240 
	`¡rNıy
(
buf
, 
row
[0].
	`c_¡r
(), 
buæ’
);

242  
»suÉ
;

243 
	}
}

245 
	gDBUt
::
	$Qu”y
(
RowS‘
& 
r£t
, cÚ¡ * 
sql
, ...)

247 
SQL_INST
* 
sqlš¡
 = (SQL_INST*)
dbHªdË_
;

248 if(
sqlš¡
 == 0) {

249 
	`¿dlog
(
L_CONS
|
L_ERROR
, "[DBUtil::Query] invalid instance");

253 
sqlbuf
[4096];

254 
va_li¡
 
¬gs
;

255 
	`va_¡¬t
(
¬gs
, 
sql
);

256 
	`vsN´štf
(
sqlbuf
, (sqlbuf), 
sql
, 
¬gs
);

257 
	`va_’d
(
¬gs
);

259 
SQLSOCK
* 
sqlsock
 = 
	`sql_g‘_sock‘
(
sqlš¡
);

260 if(
sqlsock
 =ğ
NULL
) {

264 if(
	`¾m_sql_£Ëù_qu”y
(
sqlsock
, 
sqlš¡
, 
sqlbuf
) != 0) {

265 
	`sql_»Ëa£_sock‘
(
sqlš¡
, 
sqlsock
);

269 
cŞút
 = 
	`¾m_sql_num_f›lds
(
sqlsock
, 
sqlš¡
);

270 
rownum
 = 0;

271 
r£t
.
	`ş—r
();

273 if(
	`¾m_sql_ãtch_row
(
sqlsock
, 
sqlš¡
) != 0) {

274 
rownum
 = -1;

278 if(
sqlsock
->
row
 =ğ
NULL
) {

282 ++
rownum
;

283 
Row
 
row
;

284 
i
=0; i<
cŞút
; ++i)

285 
row
.
	`push_back
(
sqlsock
->row[
i
]);

286 
r£t
.
	`push_back
(
row
);

289 
	`¾m_sql_fšish_£Ëù_qu”y
(
sqlsock
, 
sqlš¡
);

290 
	`sql_»Ëa£_sock‘
(
sqlš¡
, 
sqlsock
);

291  
rownum
;

292 
	}
}

294 
	gDBUt
::
	$Execu‹
(cÚ¡ * 
sql
, ...)

296 
SQL_INST
* 
sqlš¡
 = (SQL_INST*)
dbHªdË_
;

297 if(
sqlš¡
 == 0) {

298 
	`¿dlog
(
L_CONS
|
L_ERROR
, "[DBUtil::Execute] invalid instance");

302 
sqlbuf
[4096];

303 
va_li¡
 
¬gs
;

304 
	`va_¡¬t
(
¬gs
, 
sql
);

305 
	`vsN´štf
(
sqlbuf
, (sqlbuf), 
sql
, 
¬gs
);

306 
	`va_’d
(
¬gs
);

308 
SQLSOCK
* 
sqlsock
 = 
	`sql_g‘_sock‘
(
sqlš¡
);

309 if(
sqlsock
 =ğ
NULL
) {

313 if(
	`¾m_sql_qu”y
(
sqlsock
, 
sqlš¡
, 
sqlbuf
) != 0) {

314 
	`sql_»Ëa£_sock‘
(
sqlš¡
, 
sqlsock
);

318 
»suÉ
 = 
	`¾m_sql_afãùed_rows
(
sqlsock
, 
sqlš¡
);

320 
	`¾m_sql_fšish_qu”y
(
sqlsock
, 
sqlš¡
);

321 
	`sql_»Ëa£_sock‘
(
sqlš¡
, 
sqlsock
);

322  
»suÉ
;

323 
	}
}

325 
	gDBUt
::
»pÜt
(
¡d
::
o¡»am
& 
os
, cÚ¡ * 
´efix
)

327 
SQL_INST
* 
	gsqlš¡
 = (SQL_INST*)
dbHªdË_
;

328 if(
	gsqlš¡
 == 0) {

329 
¿dlog
(
L_CONS
|
L_ERROR
, "[DBUtil::report] invalid instance");

333 
SQLSOCK
* 
	gsqÍoŞ
 = 
sqlš¡
->
sqÍoŞ
;

334 
SQLSOCK
* 
	gÏ¡_u£d
 = 
sqlš¡
->
Ï¡_u£d
;

336 
SQLSOCK
* 
	gsqlsock
 = 
sqÍoŞ
; sqlsock; sqlsock = 
sqlsock
->
Ãxt
) {

337 
os
 << 
´efix
 << ".SqlSock‘.["<<
sqlsock
->
id
<<"].InU£=" << sqlsock->
šu£
 << "\n";

338 
	gos
 << 
	g´efix
 << ".SqlSock‘.["<<
	gsqlsock
->
	gid
<<"].S‹=" << sqlsock->
	g¡©e
 << "\n";

341 if(
	gÏ¡_u£d
)

342 
	gos
 << 
	g´efix
 << ".SqlSock‘.La¡U£d=" << 
	gÏ¡_u£d
->
	gid
 << "\n";

	@radsql/dbutil.hpp

1 #iâdeà
RAD_DBUTIL_HPP


2 
	#RAD_DBUTIL_HPP


	)

4 
	~<¡ršg
>

5 
	~<veùÜ
>

6 
	~<deque
>

7 
	~<io¡»am
>

9 şas 
	cDBUt


11 
	mpublic
:

12 
¡d
::
	tveùÜ
<
	t¡d
::
	t¡ršg
> 
	tRow
;

13 
	m¡d
::
	tdeque
<
	tRow
> 
	tRowS‘
;

14 
	mpublic
:

15 
DBUt
& 
In¡ªû
();

16 
DBUt
(cÚ¡ * 
cÚffe
, cÚ¡ * 
db£ùiÚ
 = "sql",

17 cÚ¡ * 
log£ùiÚ
 = 0);

18 ~
DBUt
();

19 
In™
(cÚ¡ * 
cÚffe
, cÚ¡ * 
db£ùiÚ
 = "sql",

20 cÚ¡ * 
log£ùiÚ
 = 0);

21 
boŞ
 
	$V®id
() const;

23 
	`S–eùFœ¡Row
(
Row
& 
row
, cÚ¡ * 
sql
, ...);

24 
	`S–eùLa¡Row
 (
Row
& 
row
, cÚ¡ * 
sql
, ...);

26 
	`Qu”yFÜIÁ
(cÚ¡ * 
sql
, ...);

27 
	`Qu”yFÜSŒšg
(* 
buf
, 
size_t
 
buæ’
, cÚ¡ * 
sql
, ...);

29 
	`Qu”y
(
RowS‘
& 
r£t
, cÚ¡ * 
sql
, ...);

30 
	`Execu‹
(cÚ¡ * 
sql
, ...);

31 
	`»pÜt
(
¡d
::
o¡»am
& 
os
, cÚ¡ * 
´efix
);

32 
´iv©e
:

33 
	`F»e
();

34 
	`DBUt
(cÚ¡ 
DBUt
&);

35 
DBUt
& 
İ”©Ü
=(const DBUtil&);

36 
´iv©e
:

37 * 
dbHªdË_
;

	@radsql/radsql.c

1 
	~"¿dut.h
"

2 
	~"¿dsql.h
"

3 
	~<¡ršg.h
>

4 
	~<¡dio.h
>

5 
	~<¡ddef.h
>

6 
	~<time.h
>

8 #ià
defšed
(
RAD_OS_UNIX
è|| defšed(
RAD_OS_LINUX
)

9 
	~<dlfú.h
>

10 
	~<lšk.h
>

13 cÚ¡ *
	g®lowed_ch¬s
 = 
NULL
;

15 
CONF_PARSER
 
	gmoduË_cÚfig
[] = {

16 {"driv”",
PW_TYPE_STRING_PTR
,

17 
off£tof
(
SQL_CONFIG
,
sql_driv”
), 
NULL
, "mysql"},

18 {"£rv”",
PW_TYPE_STRING_PTR
,

19 
off£tof
(
SQL_CONFIG
,
sql_£rv”
), 
NULL
, "localhost"},

20 {"pÜt",
PW_TYPE_STRING_PTR
,

21 
off£tof
(
SQL_CONFIG
,
sql_pÜt
), 
NULL
, ""},

22 {"logš", 
PW_TYPE_STRING_PTR
,

23 
off£tof
(
SQL_CONFIG
,
sql_logš
), 
NULL
, ""},

24 {"·sswÜd", 
PW_TYPE_STRING_PTR
,

25 
off£tof
(
SQL_CONFIG
,
sql_·sswÜd
), 
NULL
, ""},

26 {"dbÇme", 
PW_TYPE_STRING_PTR
,

27 
off£tof
(
SQL_CONFIG
,
sql_db
), 
NULL
, "radius"},

28 {"sqÉ¿û", 
PW_TYPE_BOOLEAN
,

29 
off£tof
(
SQL_CONFIG
,
sqÉ¿û
), 
NULL
, "no"},

30 {"sqÉ¿ûËv–", 
PW_TYPE_INTEGER
,

31 
off£tof
(
SQL_CONFIG
,
sqÉ¿ûËv–
), 
NULL
, 
SŒšgify
(
SQLTRACELEVEL
)},

32 {"num_sql_socks", 
PW_TYPE_INTEGER
,

33 
off£tof
(
SQL_CONFIG
,
num_sql_socks
), 
NULL
, "5"},

34 {"cÚÃù_çu»_»Œy_d–ay", 
PW_TYPE_INTEGER
,

35 
off£tof
(
SQL_CONFIG
,
cÚÃù_çu»_»Œy_d–ay
), 
NULL
, "60"},

36 {"§ã-ch¬aù”s", 
PW_TYPE_STRING_PTR
,

37 
off£tof
(
SQL_CONFIG
,
®lowed_ch¬s
), 
NULL
,

40 {
NULL
, -1, 0, NULL, NULL}

43 
CONF_PARSER
 
	glog_cÚfig
[] = {

45 {"debug_æag", 
PW_TYPE_INTEGER
, 
off£tof
(
LOG_CONFIG
, 
log_debug_æag
), 
NULL
, "99"},

46 {"Ëv–", 
PW_TYPE_INTEGER
, 
off£tof
(
LOG_CONFIG
, 
log_Ëv–
), 
NULL
, "0"},

47 {"de¡", 
PW_TYPE_INTEGER
, 
off£tof
(
LOG_CONFIG
, 
log_de¡
), 
NULL
, "0"},

48 {"fe", 
PW_TYPE_STRING_PTR
, 
off£tof
(
LOG_CONFIG
, 
log_fe
), 
NULL
, "log/sql.log"},

49 {"mli£c", 
PW_TYPE_BOOLEAN
, 
off£tof
(
LOG_CONFIG
, 
log_mli£c
), 
NULL
, "yes"},

51 {
NULL
, -1, 0, NULL, NULL}

54 
sql_š™_sock‘poŞ
(
SQL_INST
 * 
š¡
);

55 
sql_poŞä“
(
SQL_INST
 * 
š¡
);

61 
	$¾m_sql_š™
()

71 
	}
}

76 
	$sql_esÿ³_func
(*
out
, 
size_t
 
ou’
, cÚ¡ *
š
)

78 
Ën
 = 0;

80 
	`¿d_as£¹
(
®lowed_ch¬s
 !ğ
NULL
);

82 
š
[0]) {

86 ià(
ou’
 <= 1) {

94 ià((
š
[0] < 32) ||

95 
	`¡rchr
(
®lowed_ch¬s
, *
š
è=ğ
NULL
) {

96 
	`¢´štf
(
out
, 
ou’
, "=%02X", (è
š
[0]);

97 
š
++;

98 
out
 += 3;

99 
ou’
 -= 3;

100 
Ën
 += 3;

107 *
out
 = *
š
;

108 
out
++;

109 
š
++;

110 
ou’
--;

111 
Ën
++;

113 *
out
 = '\0';

114  
Ën
;

115 
	}
}

117 
	$¾m_sql_d‘ach
(
SQL_INST
 *
š¡ªû
)

119 
SQL_INST
 *
š¡
 = 
š¡ªû
;

121 
	`¿d_as£¹
(
š¡ªû
 !ğ
NULL
);

123 ià(
š¡
->
sqÍoŞ
) {

124 
	`sql_poŞä“
(
š¡
);

127 
	`¾m_sql_£t_loggšg_·¿m‘”
(
NULL
, 
š¡
);

130 if(
š¡
->
hªdË
) {

135 if(
	`dlşo£
(
š¡
->
hªdË
))

136 
	`¿dlog
(
L_WARN
, "[rlm_sql] detach: Can‚ot unload driver \"%s\": %s",

137 
š¡
->
cÚfig
->
sql_driv”
, 
	`dË¼Ü
());

140 ià(
š¡
->
cÚfig
) {

141 
i
;

146 
i
 = 0; 
moduË_cÚfig
[i].
Çme
 !ğ
NULL
; i++) {

147 **
p
;

148 ià(
moduË_cÚfig
[
i
].
ty³
 !ğ
PW_TYPE_STRING_PTR
) {

158 
p
 = (**è(((*)
š¡
->
cÚfig
è+ 
moduË_cÚfig
[
i
].
off£t
);

159 ià(!*
p
) {

162 
	`¿d_ä“
(*
p
);

163 *
p
 = 
NULL
;

165 
	`¿d_ä“
(
š¡
->
cÚfig
);

166 
š¡
->
cÚfig
 = 
NULL
;

172 if(
š¡
->
logcÚfig
) {

173 
i
;

174 
i
 = 0; 
log_cÚfig
[i].
Çme
 !ğ
NULL
; i++) {

175 **
p
;

176 ià(
log_cÚfig
[
i
].
ty³
 !ğ
PW_TYPE_STRING_PTR
) {

179 
p
 = (**è(((*)
š¡
->
logcÚfig
è+ 
log_cÚfig
[
i
].
off£t
);

180 ià(!*
p
) {

183 
	`¿d_ä“
(*
p
);

184 *
p
 = 
NULL
;

186 
	`¿d_ä“
(
š¡
->
logcÚfig
);

187 
š¡
->
logcÚfig
 = 
NULL
;

190 
	`¿d_ä“
(
š¡
);

193 
	}
}

195 
	$¾m_sql_š¡ªtŸ‹
(
CONF_SECTION
 * 
cÚf
, 
SQL_INST
 **
š¡ªû
, CONF_SECTION * 
loggšg
)

197 
SQL_INST
 *
š¡
;

199 
š¡
 = 
	`¿d_m®loc
((
SQL_INST
));

200 
	`mem£t
(
š¡
, 0, (
SQL_INST
));

202 
š¡
->
cÚfig
 = 
	`¿d_m®loc
((
SQL_CONFIG
));

203 
	`mem£t
(
š¡
->
cÚfig
, 0, (
SQL_CONFIG
));

205 
š¡
->
logcÚfig
 = 
	`¿d_m®loc
((
LOG_CONFIG
));

206 
	`mem£t
(
š¡
->
logcÚfig
, 0, (
LOG_CONFIG
));

212 ià(
	`cf_£ùiÚ_·r£
(
cÚf
, 
š¡
->
cÚfig
, 
moduË_cÚfig
) < 0) {

213 
	`¾m_sql_d‘ach
(
š¡
);

217 ià(
š¡
->
cÚfig
->
num_sql_socks
 > 
MAX_SQL_SOCKS
) {

218 
	`¿dlog
(
L_ERROR
|
L_CONS
, "[rlm_sql] instantiate: "

220 
š¡
->
cÚfig
->
num_sql_socks
, 
MAX_SQL_SOCKS
);

221 
	`¾m_sql_d‘ach
(
š¡
);

228 ià(
	`¡ºÿ£cmp
(
š¡
->
cÚfig
->
sql_driv”
, "rlm_sql_", 8) != 0) {

229 
	`¿dlog
(
L_ERROR
|
L_CONS
, "[rlm_sql] instantiate: "

231 
š¡
->
cÚfig
->
sql_driv”
);

232 
	`¾m_sql_d‘ach
(
š¡
);

235 if(
š¡
->
cÚfig
->
sqÉ¿ûËv–
 < 0) {

236 
š¡
->
cÚfig
->
sqÉ¿ûËv–
 = 0;

237 } if(
š¡
->
cÚfig
->
sqÉ¿ûËv–
 > 65535) {

238 
š¡
->
cÚfig
->
sqÉ¿ûËv–
 = 65535;

245 
š¡
->
hªdË
 = 
	`dlİ’
(š¡->
cÚfig
->
sql_driv”
, 
RTLD_NOW
|
RTLD_GLOBAL
);

246 if(
š¡
->
hªdË
 =ğ
NULL
) {

247 
	`¿dlog
(
L_ERROR
|
L_CONS
, "[rlm_sql] instantiate: Can‚ot†ink driver \"%s\": %s",

248 
š¡
->
cÚfig
->
sql_driv”
, 
	`dË¼Ü
());

249 
	`¿dlog
(
L_ERROR
|
L_CONS
, "[rlm_sql] instantiate: Make sure it (and‡ll its "

251 
	`¾m_sql_d‘ach
(
š¡
);

255 
š¡
->
moduË
 = (
¾m_sql_moduË_t
 *è
	`dlsym
(š¡->
hªdË
, in¡->
cÚfig
->
sql_driv”
);

256 if(
š¡
->
moduË
 =ğ
NULL
) {

257 
	`¿dlog
(
L_ERROR
|
L_CONS
, "[rlm_sql] instantiate: Can‚ot†ink symbol \"%s\": %s",

258 
š¡
->
cÚfig
->
sql_driv”
, 
	`dË¼Ü
());

259 
	`¾m_sql_d‘ach
(
š¡
);

263 
	`¿dlog
(
L_INFO
, "[rlm_sql] instantiate: Driver \"%s\" (module \"%s\")†oaded‡nd†inked",

264 
š¡
->
cÚfig
->
sql_driv”
, in¡->
moduË
->
Çme
);

265 
	`¿dlog
(
L_INFO
, "[rlm_sql] instantiate: Attemptingo connecto %s@%s:%s/%s",

266 
š¡
->
cÚfig
->
sql_logš
, in¡->cÚfig->
sql_£rv”
,

267 
š¡
->
cÚfig
->
sql_pÜt
, in¡->cÚfig->
sql_db
);

269 if(
loggšg
 !ğ
NULL
 &&

270 
	`cf_£ùiÚ_·r£
(
loggšg
, 
š¡
->
logcÚfig
, 
log_cÚfig
) != 0) {

271 
	`¾m_sql_d‘ach
(
š¡
);

276 
	`¾m_sql_£t_loggšg_·¿m‘”
(
š¡
->
logcÚfig
, inst);

278 ià(
	`sql_š™_sock‘poŞ
(
š¡
) < 0) {

279 
	`¾m_sql_d‘ach
(
š¡
);

283 
®lowed_ch¬s
 = 
š¡
->
cÚfig
->allowed_chars;

285 *
š¡ªû
 = 
š¡
;

288 
	}
}

290 
	$¾m_sql_de¡roy
()

293 
	}
}

303 
	$cÚÃù_sšgË_sock‘
(
SQLSOCK
 *
sqlsock‘
, 
SQL_INST
 *
š¡
)

305 
rcode
;

306 
	`¿dlog
(
L_DEBUG
, "[rlm_sql] connect_single_socket: Attemptingo connect %s #%d",

307 
š¡
->
moduË
->
Çme
, 
sqlsock‘
->
id
);

309 
rcode
 = (
š¡
->
moduË
->
sql_š™_sock‘
)(
sqlsock‘
, in¡->
cÚfig
);

310 ià(
rcode
 == 0) {

311 
	`¿dlog
(
L_DEBUG
, "[rlm_sql] connect_single_socket: Connected‚ew DB handle, #%d",

312 
sqlsock‘
->
id
);

313 
sqlsock‘
->
¡©e
 = 
sockcÚÃùed
;

320 
	`¿dlog
(
L_WARN
|
L_CONS
, "[rlm_sql] connect_single_socket: Failedo connect DB handle #%d",

321 
sqlsock‘
->
id
);

322 
š¡
->
cÚÃù_aá”
 = 
	`time
(
NULL
è+ in¡->
cÚfig
->
cÚÃù_çu»_»Œy_d–ay
;

323 
sqlsock‘
->
¡©e
 = 
sockuncÚÃùed
;

325 
	}
}

334 
	$sql_š™_sock‘poŞ
(
SQL_INST
 * 
š¡
)

336 
i
, 
rcode
;

337 
sucûss
 = 0;

338 
SQLSOCK
 *
sqlsock‘
;

340 
š¡
->
cÚÃù_aá”
 = 0;

341 
š¡
->
sqÍoŞ
 = 
NULL
;

343 
i
 = 0; i < 
š¡
->
cÚfig
->
num_sql_socks
; i++) {

344 
	`¿dlog
(
L_DEBUG
, "[¾m_sql] in™_sock‘poŞ: s¹šg %d", 
i
);

346 
sqlsock‘
 = 
	`¿d_m®loc
((
SQLSOCK
));

347 
sqlsock‘
->
cÚn
 = 
NULL
;

348 
sqlsock‘
->
id
 = 
i
;

349 
sqlsock‘
->
¡©e
 = 
sockuncÚÃùed
;

351 
rcode
 = 0;

352 #ià
	`defšed
(
HAVE_PTHREAD_H
)

353 
rcode
 = 
	`±h»ad_mu‹x_š™
(&
sqlsock‘
->
mu‹x
, 
NULL
);

354 #–ià
	`defšed
(
HAVE_WIN32THREAD_H
)

355 
	`In™ŸlizeCr™iÿlSeùiÚ
(&
sqlsock‘
->
ü™
);

357 
sqlsock‘
->
šu£
 = 0;

358 ià(
rcode
 != 0) {

359 
	`¿dlog
(
L_ERROR
|
L_CONS
, "[rlm_sql] init_socketpool: "

360 "FaedØš™†ock:„‘uº (%d)", 
rcode
);

361 
	`¿d_ä“
(
sqlsock‘
);

365 ià(
	`time
(
NULL
è> 
š¡
->
cÚÃù_aá”
) {

370 ià(
	`cÚÃù_sšgË_sock‘
(
sqlsock‘
, 
š¡
) == 0) {

371 
sucûss
 = 1;

376 
sqlsock‘
->
Ãxt
 = 
š¡
->
sqÍoŞ
;

377 
š¡
->
sqÍoŞ
 = 
sqlsock‘
;

379 
š¡
->
Ï¡_u£d
 = 
NULL
;

381 ià(!
sucûss
) {

382 
	`¿dlog
(
L_WARN
, "[rlm_sql] init_socketpool: Failedo connecto‡ny SQL server.");

386 
	}
}

395 
	$sql_şo£_sock‘
(
SQL_INST
 *
š¡
, 
SQLSOCK
 * 
sqlsock‘
)

397 
rcode
;

398 
	`¿dlog
(
L_DEBUG
, "[rlm_sql] close_socket: Closing sqlsocket %d",

399 
sqlsock‘
->
id
);

400 ià(
sqlsock‘
->
¡©e
 =ğ
sockcÚÃùed
) {

401 (
š¡
->
moduË
->
sql_şo£
)(
sqlsock‘
, in¡->
cÚfig
);

403 ià(
š¡
->
moduË
->
sql_de¡roy_sock‘
) {

404 (
š¡
->
moduË
->
sql_de¡roy_sock‘
)(
sqlsock‘
, in¡->
cÚfig
);

406 
	`¿d_as£¹
(
sqlsock‘
->
šu£
 == 0);

407 
sqlsock‘
->
šu£
 = 0;

408 
rcode
 = 0;

409 #ià
	`defšed
(
HAVE_PTHREAD_H
)

410 
rcode
 = 
	`±h»ad_mu‹x_de¡roy
(&
sqlsock‘
->
mu‹x
);

411 #–ià
	`defšed
(
HAVE_WIN32THREAD_H
)

412 
	`D–‘eCr™iÿlSeùiÚ
(&
sqlsock‘
->
ü™
);

414 if(
rcode
 != 0) {

415 
	`¿dlog
(
L_WARN
, "[rlm_sql] close_socket: "

416 "FaedØde¡roy†ock:„‘uº (%d)", 
rcode
);

418 
	`¿d_ä“
(
sqlsock‘
);

420 
	}
}

429 
	$sql_poŞä“
(
SQL_INST
 * 
š¡
)

431 
SQLSOCK
 *
cur
;

432 
SQLSOCK
 *
Ãxt
;

434 
cur
 = 
š¡
->
sqÍoŞ
; cur; cu¸ğ
Ãxt
) {

435 
Ãxt
 = 
cur
->next;

436 
	`sql_şo£_sock‘
(
š¡
, 
cur
);

439 
š¡
->
sqÍoŞ
 = 
NULL
;

440 
	}
}

449 
SQLSOCK
 * 
	$sql_g‘_sock‘
(
SQL_INST
 * 
š¡
)

451 
SQLSOCK
 *
cur
, *
¡¬t
;

452 
Œ›d_to_cÚÃù
 = 0;

453 
uncÚÃùed
 = 0;

454 
rcode
, 
locked
;

459 
¡¬t
 = 
š¡
->
Ï¡_u£d
;

460 ià(!
¡¬t
è¡¬ˆğ
š¡
->
sqÍoŞ
;

462 
cur
 = 
¡¬t
;

464 
rcode
 = 0;

465 
locked
 = 0;

466 
cur
) {

467 #ià
	`defšed
(
HAVE_PTHREAD_H
)

474 ià((
rcode
 = 
	`±h»ad_mu‹x_Œylock
(&
cur
->
mu‹x
)) != 0) {

475 
Ãxt
;

478 
locked
 = 1;

479 
	`TRACE
("[¾m_sql] g‘_sock‘: Obšed†ock w™h hªdË %d", 
cur
->
id
);

481 #–ià
	`defšed
(
HAVE_WIN32THREAD_H
)

482 ià(!
	`TryEÁ”Cr™iÿlSeùiÚ
(&
cur
->
ü™
)) {

483 
Ãxt
;

486 
locked
 = 1;

487 
	`TRACE
("[¾m_sql] g‘_sock‘: Obšed†ock w™h hªdË %d", 
cur
->
id
);

491 ià(
locked
) {

492 
	`¿d_as£¹
(
cur
->
šu£
 == 0);

495 if(
cur
->
šu£
 == 1) {

496 
Ãxt
;

499 
	`¿d_as£¹
(
cur
->
šu£
 == 0);

500 
cur
->
šu£
 = 1;

509 ià((
cur
->
¡©e
 =ğ
sockuncÚÃùed
è&& (
	`time
(
NULL
è> 
š¡
->
cÚÃù_aá”
)) {

510 
	`¿dlog
(
L_INFO
, "[rlm_sql] get_socket: "

512 
cur
->
id
);

513 
Œ›d_to_cÚÃù
++;

514 
	`cÚÃù_sšgË_sock‘
(
cur
, 
š¡
);

518 ià(
cur
->
¡©e
 =ğ
sockuncÚÃùed
) {

519 
	`¿dlog
(
L_DEBUG
, "[rlm_sql] get_socket: "

521 
cur
->
id
);

522 
uncÚÃùed
++;

524 
	`¿d_as£¹
(
cur
->
šu£
 == 1);

525 
cur
->
šu£
 = 0;

527 #ià
	`defšed
(
HAVE_PTHREAD_H
)

528 if((
rcode
 = 
	`±h»ad_mu‹x_uÆock
(&
cur
->
mu‹x
)) != 0) {

529 
	`¿dlog
(
L_FATAL
|
L_CONS
, "[rlm_sql] get_socket: "

531 
cur
->
id
, 
rcode
);

533 
	`TRACE
("[¾m_sql] g‘_sock‘: R–—£d†ock w™h hªdË %d", 
cur
->
id
);

535 #–ià
	`defšed
(
HAVE_WIN32THREAD_H
)

536 
	`L—veCr™iÿlSeùiÚ
(&
cur
->
ü™
);

537 
	`TRACE
("[¾m_sql] g‘_sock‘: R–—£d†ock w™h hªdË %d", 
cur
->
id
);

540 
Ãxt
;

544 
	`¿dlog
(
L_DEBUG
, "[rlm_sql] get_socket: Obtained sql socket id: %d",

545 
cur
->
id
);

547 ià(
uncÚÃùed
 !ğ0 || 
Œ›d_to_cÚÃù
 != 0) {

548 
	`¿dlog
(
L_INFO
, "[rlm_sql] get_socket: "

551 
cur
->
id
, 
uncÚÃùed
, 
Œ›d_to_cÚÃù
);

566 
š¡
->
Ï¡_u£d
 = 
cur
->
Ãxt
;

567  
cur
;

570 
Ãxt
:

571 
cur
 = cur->
Ãxt
;

579 ià(!
cur
) {

580 
cur
 = 
š¡
->
sqÍoŞ
;

586 ià(
cur
 =ğ
¡¬t
) {

593 
	`¿dlog
(
L_WARN
, "[rlm_sql] get_socket: "

595 
uncÚÃùed
, 
Œ›d_to_cÚÃù
);

596  
NULL
;

597 
	}
}

606 
	$sql_»Ëa£_sock‘
(
SQL_INST
 * 
š¡
, 
SQLSOCK
 * 
sqlsock‘
)

608 
rcode
;

610 
	`¿d_as£¹
(
sqlsock‘
->
šu£
 == 1);

611 
sqlsock‘
->
šu£
 = 0;

613 
rcode
 = 0;

614 #ià
	`defšed
(
HAVE_PTHREAD_H
)

615 if((
rcode
 = 
	`±h»ad_mu‹x_uÆock
(&
sqlsock‘
->
mu‹x
)) != 0) {

616 
	`¿dlog
(
L_FATAL
|
L_CONS
, "[rlm_sql]„elease_socket: "

618 
sqlsock‘
->
id
, 
rcode
);

620 
	`TRACE
("[¾m_sql]„–—£_sock‘: R–—£d†ock w™h hªdË %d", 
sqlsock‘
->
id
);

622 #–ià
	`defšed
(
HAVE_WIN32THREAD_H
)

623 
	`L—veCr™iÿlSeùiÚ
(&
sqlsock‘
->
ü™
);

624 
	`TRACE
("[¾m_sql]„–—£_sock‘: R–—£d†ock w™h hªdË %d", 
sqlsock‘
->
id
);

627 
	`¿dlog
(
L_DEBUG
, "[¾m_sql]„–—£_sock‘: R–—£d sqÈsock‘ id: %d", 
sqlsock‘
->
id
);

630 
	}
}

639 
	$¾m_sql_ãtch_row
(
SQLSOCK
 *
sqlsock‘
, 
SQL_INST
 *
š¡
)

641 
»t
;

643 ià(
sqlsock‘
->
cÚn
) {

644 
»t
 = (
š¡
->
moduË
->
sql_ãtch_row
)(
sqlsock‘
, in¡->
cÚfig
);

646 
»t
 = 
SQL_DOWN
;

649 ià(
»t
 =ğ
SQL_DOWN
) {

651 ià(
sqlsock‘
->
cÚn
) {

652 (
š¡
->
moduË
->
sql_şo£
)(
sqlsock‘
, in¡->
cÚfig
);

656 ià(
	`cÚÃù_sšgË_sock‘
(
sqlsock‘
, 
š¡
) < 0) {

657 
	`¿dlog
(
L_ERROR
|
L_CONS
, "[rlm_sql] fetch_row: Reconnect failed, database down?");

662 
»t
 = (
š¡
->
moduË
->
sql_ãtch_row
)(
sqlsock‘
, in¡->
cÚfig
);

664 ià(
»t
) {

665 
	`¿dlog
(
L_ERROR
, "[rlm_sql] fetch_row: Failed‡fter„econnect");

670  
»t
;

671 
	}
}

680 
	$¾m_sql_qu”y
(
SQLSOCK
 *
sqlsock‘
, 
SQL_INST
 *
š¡
, cÚ¡ *
qu”y
)

682 
»t
;

687 ià(!
qu”y
 || !*query) {

691 
»t
 = (
š¡
->
moduË
->
sql_qu”y
)(
sqlsock‘
, in¡->
cÚfig
, 
qu”y
);

693 ià(
»t
 =ğ
SQL_DOWN
) {

695 (
š¡
->
moduË
->
sql_şo£
)(
sqlsock‘
, in¡->
cÚfig
);

698 ià(
	`cÚÃù_sšgË_sock‘
(
sqlsock‘
, 
š¡
) < 0) {

699 
	`¿dlog
(
L_ERROR
|
L_CONS
, "[rlm_sql] query: Reconnect failed, database down?");

704 
»t
 = (
š¡
->
moduË
->
sql_qu”y
)(
sqlsock‘
, in¡->
cÚfig
, 
qu”y
);

706 ià(
»t
) {

707 
	`¿dlog
(
L_ERROR
, "[rlm_sql] query: Failed‡fter„econnect");

712  
»t
;

713 
	}
}

722 
	$¾m_sql_£Ëù_qu”y
(
SQLSOCK
 *
sqlsock‘
, 
SQL_INST
 *
š¡
, cÚ¡ *
qu”y
)

724 
»t
;

729 ià(!
qu”y
 || !*query) {

733 
»t
 = (
š¡
->
moduË
->
sql_£Ëù_qu”y
)(
sqlsock‘
, in¡->
cÚfig
, 
qu”y
);

735 ià(
»t
 =ğ
SQL_DOWN
) {

737 (
š¡
->
moduË
->
sql_şo£
)(
sqlsock‘
, in¡->
cÚfig
);

740 ià(
	`cÚÃù_sšgË_sock‘
(
sqlsock‘
, 
š¡
) < 0) {

741 
	`¿dlog
(
L_ERROR
|
L_CONS
, "[rlm_sql] select_query: Reconnect failed, database down?");

746 
»t
 = (
š¡
->
moduË
->
sql_£Ëù_qu”y
)(
sqlsock‘
, in¡->
cÚfig
, 
qu”y
);

748 ià(
»t
) {

749 
	`¿dlog
(
L_ERROR
, "[rlm_sql] select_query: Failed‡fter„econnect");

754  
»t
;

755 
	}
}

	@radsql/radsql.h

10 #iâdeà
__RAD_SQL_H__


11 
	#__RAD_SQL_H__


	)

13 
	~<¿dut/¿d¶©fÜm.h
>

14 
	~<¿dut/¿dcÚffe.h
>

16 #ià
defšed
(
RAD_OS_WIN32
)

17 
	#_WIN32_WINNT
 0x0400

	)

18 
	~<wšdows.h
>

19 
	#HAVE_WIN32THREAD_H


	)

22 #ifdeà
HAVE_PTHREAD_H


23 
	~<±h»ad.h
>

26 #ifdeà
__ılu¥lus


31 
	#MAX_QUERY_LEN
 4096

	)

32 
	#SQLTRACELEVEL
 1000

	)

35 
	#SQL_DOWN
 1

	)

38 
	#MAX_SQL_SOCKS
 256

	)

55 
	slog_cÚfig
 {

56 
log_debug_æag
;

57 
log_Ëv–
;

58 
log_de¡
;

59 * 
log_fe
;

60 
log_mli£c
;

61 } 
	tLOG_CONFIG
;

63 
	ssql_cÚfig
 {

64 *
sql_driv”
;

65 *
sql_£rv”
;

66 *
sql_pÜt
;

67 *
sql_logš
;

68 *
sql_·sswÜd
;

69 *
sql_db
;

70 
sqÉ¿û
;

71 
sqÉ¿ûËv–
;

72 
num_sql_socks
;

73 
cÚÃù_çu»_»Œy_d–ay
;

74 *
®lowed_ch¬s
;

77 *
loÿlcfg
;

79 } 
	tSQL_CONFIG
;

81 ** 
	tSQL_ROW
;

83 
	ssql_sock‘
 {

84 
id
;

85 #ià
defšed
(
HAVE_PTHREAD_H
)

86 
±h»ad_mu‹x_t
 
mu‹x
;

87 #–ià
defšed
(
HAVE_WIN32THREAD_H
)

88 
CRITICAL_SECTION
 
ü™
;

90 
šu£
;

91 
sql_sock‘
 *
Ãxt
;

92 ’um { 
sockcÚÃùed
, 
sockuncÚÃùed
 } 
¡©e
;

94 *
cÚn
;

95 
SQL_ROW
 
row
;

96 } 
	tSQLSOCK
;

98 
	s¾m_sql_moduË_t
 {

99 cÚ¡ *
Çme
;

100 (*
sql_š™_sock‘
è(
SQLSOCK
 *
sqlsock‘
, 
SQL_CONFIG
 *
cÚfig
);

101 (*
sql_de¡roy_sock‘
)(
SQLSOCK
 *
sqlsock‘
, 
SQL_CONFIG
 *
cÚfig
);

102 (*
sql_qu”y
è(
SQLSOCK
 *
sqlsock‘
, 
SQL_CONFIG
 *
cÚfig
, cÚ¡ *
qu”y
);

103 (*
sql_£Ëù_qu”y
è(
SQLSOCK
 *
sqlsock‘
, 
SQL_CONFIG
 *
cÚfig
, cÚ¡ *
qu”y
);

104 (*
sql_¡Üe_»suÉ
è(
SQLSOCK
 *
sqlsock‘
, 
SQL_CONFIG
 *
cÚfig
);

105 (*
sql_num_f›lds
è(
SQLSOCK
 *
sqlsock‘
, 
SQL_CONFIG
 *
cÚfig
);

106 (*
sql_num_rows
è(
SQLSOCK
 *
sqlsock‘
, 
SQL_CONFIG
 *
cÚfig
);

107 (*
sql_ãtch_row
è(
SQLSOCK
 *
sqlsock‘
, 
SQL_CONFIG
 *
cÚfig
);

108 (*
sql_ä“_»suÉ
è(
SQLSOCK
 *
sqlsock‘
, 
SQL_CONFIG
 *
cÚfig
);

109 *(*
sql_”rÜ
è(
SQLSOCK
 *
sqlsock‘
, 
SQL_CONFIG
 *
cÚfig
);

110 (*
sql_şo£
è(
SQLSOCK
 *
sqlsock‘
, 
SQL_CONFIG
 *
cÚfig
);

111 (*
sql_fšish_qu”y
è(
SQLSOCK
 *
sqlsock‘
, 
SQL_CONFIG
 *
cÚfig
);

112 (*
sql_fšish_£Ëù_qu”y
)(
SQLSOCK
 *
sqlsock‘
, 
SQL_CONFIG
 *
cÚfig
);

113 (*
sql_afãùed_rows
è(
SQLSOCK
 *
sqlsock‘
, 
SQL_CONFIG
 *
cÚfig
);

114 (*
£t_loggšg_·¿m‘”
)(
LOG_CONFIG
 *
logcÚfig
);

115 } 
	t¾m_sql_moduË_t
;

117 
	ssql_š¡
 {

118 
time_t
 
cÚÃù_aá”
;

119 
SQLSOCK
 *
sqÍoŞ
;

120 
SQLSOCK
 *
Ï¡_u£d
;

121 
SQL_CONFIG
 *
cÚfig
;

122 
LOG_CONFIG
 *
logcÚfig
;

124 * 
hªdË
;

125 
¾m_sql_moduË_t
 *
moduË
;

126 } 
	tSQL_INST
;

128 
¾m_sql_š™
();

129 
¾m_sql_š¡ªtŸ‹
(
CONF_SECTION
 * 
cÚf
, 
SQL_INST
 **
š¡ªû
, CONF_SECTION * 
loggšg
);

130 
¾m_sql_d‘ach
(
SQL_INST
 *
š¡ªû
);

131 
¾m_sql_de¡roy
();

132 
sql_esÿ³_func
(*
out
, 
size_t
 
ou’
, cÚ¡ *
š
);

134 
SQLSOCK
 *
sql_g‘_sock‘
(
SQL_INST
 * 
š¡
);

135 
sql_»Ëa£_sock‘
(
SQL_INST
 * 
š¡
, 
SQLSOCK
 * 
sqlsock‘
);

137 
	#¾m_sql_num_f›lds
(
sqlsock‘
, 
š¡
) \

138 (
š¡
->
moduË
->
sql_num_f›lds
)(
sqlsock‘
, in¡->
cÚfig
)

	)

139 
	#¾m_sql_fšish_£Ëù_qu”y
(
sqlsock‘
, 
š¡
) \

140 (
š¡
->
moduË
->
sql_fšish_£Ëù_qu”y
)(
sqlsock‘
, in¡->
cÚfig
)

	)

141 
	#¾m_sql_fšish_qu”y
(
sqlsock‘
, 
š¡
) \

142 (
š¡
->
moduË
->
sql_fšish_qu”y
)(
sqlsock‘
, in¡->
cÚfig
)

	)

143 
	#¾m_sql_afãùed_rows
(
sqlsock‘
, 
š¡
) \

144 (
š¡
->
moduË
->
sql_afãùed_rows
)(
sqlsock‘
, in¡->
cÚfig
)

	)

145 
	#¾m_sql_£t_loggšg_·¿m‘”
(
logcÚfig
, 
š¡
) \

146 (
š¡
->
moduË
->
£t_loggšg_·¿m‘”
)(
logcÚfig
)

	)

148 
¾m_sql_ãtch_row
(
SQLSOCK
 *
sqlsock‘
, 
SQL_INST
 *
š¡
);

149 
¾m_sql_qu”y
(
SQLSOCK
 *
sqlsock‘
, 
SQL_INST
 *
š¡
, cÚ¡ *
qu”y
);

150 
¾m_sql_£Ëù_qu”y
(
SQLSOCK
 *
sqlsock‘
, 
SQL_INST
 *
š¡
, cÚ¡ *
qu”y
);

152 #ifdeà
__ılu¥lus


	@radutil/radarray.c

1 
	~"¿dut.h
"

3 
	$Ìad_shiá_g‘_push_back_šdex
(

4 *
pä
, *
±o
, 
size_t
 
maxút
)

6 
šdex
;

7 
size_t
 
Ëngth
 = 
	`LRAD_SHIFT_LENGTH
(*
pä
, *
±o
, 
maxút
);

9 if(
Ëngth
 =ğ
maxút
) {

10 
šdex
 = *
pä
;

11 
	`LRAD_SHIFT_INCIDX
(*
pä
, 
maxút
);

13 
šdex
 = *
±o
;

14 
Ëngth
 =ğ
maxút
-1 ? *
±o
 = 
LRAD_SHIFT_TOINFI
 :

15 
	`LRAD_SHIFT_INCIDX
(*
±o
, 
maxút
);

18  
šdex
;

19 
	}
}

21 
	$Ìad_shiá_g‘_push_äÚt_šdex
(

22 *
pä
, *
±o
, 
size_t
 
maxút
)

24 
šdex
;

25 
size_t
 
Ëngth
 = 
	`LRAD_SHIFT_LENGTH
(*
pä
, *
±o
, 
maxút
);

27 if(
Ëngth
 =ğ
maxút
) {

28 
šdex
 = 
	`LRAD_SHIFT_DECIDX
(*
pä
, 
maxút
);

30 if(
Ëngth
 =ğ
maxút
-1)

31 *
±o
 = 
LRAD_SHIFT_TOINFI
;

32 
šdex
 = 
	`LRAD_SHIFT_DECIDX
(*
pä
, 
maxút
);

35  
šdex
;

36 
	}
}

38 
	$Ìad_shiá_g‘_pİ_back_šdex
(

39 *
pä
, *
±o
, 
size_t
 
maxút
)

41 
šdex
;

42 
size_t
 
Ëngth
 = 
	`LRAD_SHIFT_LENGTH
(*
pä
, *
±o
, 
maxút
);

44 if(
Ëngth
 =ğ
maxút
) {

45 *
±o
 = *
pä
;

46 
šdex
 = 
	`LRAD_SHIFT_DECIDX
(*
±o
, 
maxút
);

47 } if(
Ëngth
 == 0) {

48 
šdex
 = 
LRAD_SHIFT_TOINFI
;

50 
šdex
 = 
	`LRAD_SHIFT_DECIDX
(*
±o
, 
maxút
);

53  
šdex
;

54 
	}
}

56 
	$Ìad_shiá_g‘_pİ_äÚt_šdex
(

57 *
pä
, *
±o
, 
size_t
 
maxút
)

59 
šdex
;

60 
size_t
 
Ëngth
 = 
	`LRAD_SHIFT_LENGTH
(*
pä
, *
±o
, 
maxút
);

62 if(
Ëngth
 =ğ
maxút
) {

63 
šdex
 = *
pä
;

64 *
±o
 = *
pä
;

65 
	`LRAD_SHIFT_INCIDX
(*
pä
, 
maxút
);

66 } if(
Ëngth
 == 0) {

67 
šdex
 = 
LRAD_SHIFT_TOINFI
;

69 
šdex
 = *
pä
;

70 
	`LRAD_SHIFT_INCIDX
(*
pä
, 
maxút
);

73  
šdex
;

74 
	}
}

	@radutil/radarray.h

10 #iâdeà
__RAD_ARRAY_H__


11 
	#__RAD_ARRAY_H__


	)

13 #ifdeà
__ılu¥lus


18 
_Ìad_shiá_’Œy
 
	tÌad_shiá_’Œy
;

20 
	s_Ìad_shiá_’Œy
 {

21 
ä
;

22 
to
;

25 
	#LRAD_SHIFT_TOINFI
 0xffffffff

	)

26 
	#LRAD_SHIFT_INCIDX
(
i
, 
m
èĞ(iè=ğ(m)-1 ? (i)=0 : ++(iè)

	)

27 
	#LRAD_SHIFT_DECIDX
(
i
, 
m
èĞ(iè=ğ0 ? (i)=(m)-1 : --(iè)

	)

28 
	#LRAD_SHIFT_LENGTH
(
f
, 
t
, 
m
èĞÑè=ğ
LRAD_SHIFT_TOINFI
 ? (m) : \

29 (
t
è=ğ(
f
) ? (0) : \

30 (
t
è> (
f
) ? ((t)-(f)) : \

31 ((
t
)+(
m
)-(
f
)è)

	)

33 
Ìad_shiá_g‘_push_back_šdex
(

34 *
pä
, *
±o
, 
size_t
 
maxút
);

35 
Ìad_shiá_g‘_push_äÚt_šdex
(

36 *
pä
, *
±o
, 
size_t
 
maxút
);

37 
Ìad_shiá_g‘_pİ_back_šdex
(

38 *
pä
, *
±o
, 
size_t
 
maxút
);

39 
Ìad_shiá_g‘_pİ_äÚt_šdex
(

40 *
pä
, *
±o
, 
size_t
 
maxút
);

42 #ifdeà
__ılu¥lus


	@radutil/radcommon.c

1 
	~"¿dut.h
"

2 
	~<¡ršg.h
>

4 
	$Ìad_¡r2št
 (

5 cÚ¡ 
LRAD_NAME_NUMBER
 *
bË
,

6 cÚ¡ *
Çme
,

7 
def


10 cÚ¡ 
LRAD_NAME_NUMBER
 *
this
;

12 
this
 = 
bË
;his->
Çme
 !ğ
NULL
;his++) {

13 ià(
	`¡rÿ£cmp
(
this
->
Çme
,‚ame) == 0) {

14  
this
->
numb”
;

18  
def
;

19 
	}
}

21 cÚ¡ * 
	$Ìad_št2¡r
 (

22 cÚ¡ 
LRAD_NAME_NUMBER
 *
bË
,

23 
numb”
,

24 cÚ¡ *
def


27 cÚ¡ 
LRAD_NAME_NUMBER
 *
this
;

29 
this
 = 
bË
;his->
Çme
 !ğ
NULL
;his++) {

30 ià(
this
->
numb”
 ==‚umber) {

31  
this
->
Çme
;

35  
def
;

36 
	}
}

38 cÚ¡ * 
	$Ìad_¡¿2b
 (

39 cÚ¡ 
LRAD_NAME_MAP
 *
bË
,

40 cÚ¡ *
Çme1
,

41 cÚ¡ *
def


44 cÚ¡ 
LRAD_NAME_MAP
 *
this
;

46 
this
 = 
bË
;his->
Çme1
 !ğ
NULL
;his++) {

47 ià(
	`¡rÿ£cmp
(
this
->
Çme1
,‚ame1) == 0) {

48  
this
->
Çme2
;

52  
def
;

53 
	}
}

55 cÚ¡ * 
	$Ìad_¡rb2a
 (

56 cÚ¡ 
LRAD_NAME_MAP
 *
bË
,

57 cÚ¡ *
Çme2
,

58 cÚ¡ *
def


61 cÚ¡ 
LRAD_NAME_MAP
 *
this
;

63 
this
 = 
bË
;his->
Çme1
 !ğ
NULL
;his++) {

64 ià(
	`¡rÿ£cmp
(
this
->
Çme2
,‚ame2) == 0) {

65  
this
->
Çme1
;

69  
def
;

70 
	}
}

	@radutil/radcommon.h

10 #iâdeà
__RAD_COMMON_H__


11 
	#__RAD_COMMON_H__


	)

13 #ifdeà
__ılu¥lus


17 
	s_LRAD_NAME_NUMBER
 {

18 cÚ¡ *
Çme
;

19 
numb”
;

20 } 
	tLRAD_NAME_NUMBER
;

22 
Ìad_¡r2št
 (

23 cÚ¡ 
LRAD_NAME_NUMBER
 *
bË
,

24 cÚ¡ *
Çme
,

25 
def


27 cÚ¡ * 
Ìad_št2¡r
 (

28 cÚ¡ 
LRAD_NAME_NUMBER
 *
bË
,

29 
numb”
,

30 cÚ¡ *
def


33 
	s_LRAD_NAME_MAP
 {

34 cÚ¡ * 
Çme1
;

35 cÚ¡ * 
Çme2
;

36 } 
	tLRAD_NAME_MAP
;

38 cÚ¡ * 
Ìad_¡¿2b
 (

39 cÚ¡ 
LRAD_NAME_MAP
 *
bË
,

40 cÚ¡ *
Çme1
,

41 cÚ¡ *
def


43 cÚ¡ * 
Ìad_¡rb2a
 (

44 cÚ¡ 
LRAD_NAME_MAP
 *
bË
,

45 cÚ¡ *
Çme2
,

46 cÚ¡ *
def


49 #ifdeà
__ılu¥lus


	@radutil/radconffile.c

1 
	~"¿dut.h
"

2 
	~<¡ršg.h
>

3 
	~<¡dlib.h
>

4 
	~<¡dio.h
>

5 
	~<”ºo.h
>

7 
	ecÚf_ty³
 {

8 
	mCONF_ITEM_PAIR
,

9 
	mCONF_ITEM_SECTION


10 } 
	tCONF_ITEM_TYPE
;

12 
	scÚf_™em
 {

13 
cÚf_™em
 *
	mÃxt
;

14 
cÚf_·¹
 *
	m·»Á
;

15 
	mlš’o
;

16 
CONF_ITEM_TYPE
 
	mty³
;

18 
	scÚf_·œ
 {

19 
CONF_ITEM
 
	m™em
;

20 *
	m©Œ
;

21 *
	mv®ue
;

22 
LRAD_TOKEN
 
	mİ”©Ü
;

24 
	scÚf_·¹
 {

25 
CONF_ITEM
 
	m™em
;

26 *
	mÇme1
;

27 *
	mÇme2
;

28 
cÚf_™em
 *
	mchd»n
;

34 
CONF_PAIR
 *
	$cf_™emtİaœ
(
CONF_ITEM
 *
ci
)

36 ià(
ci
 =ğ
NULL
)

37  
NULL
;

38 
	`¿d_as£¹
(
ci
->
ty³
 =ğ
CONF_ITEM_PAIR
);

39  (
CONF_PAIR
 *)
ci
;

40 
	}
}

41 
CONF_SECTION
 *
	$cf_™emto£ùiÚ
(
CONF_ITEM
 *
ci
)

43 ià(
ci
 =ğ
NULL
)

44  
NULL
;

45 
	`¿d_as£¹
(
ci
->
ty³
 =ğ
CONF_ITEM_SECTION
);

46  (
CONF_SECTION
 *)
ci
;

47 
	}
}

48 
CONF_ITEM
 *
	$cf_·œto™em
(
CONF_PAIR
 *
ı
)

50 ià(
ı
 =ğ
NULL
)

51  
NULL
;

52  (
CONF_ITEM
 *)
ı
;

53 
	}
}

54 
CONF_ITEM
 *
	$cf_£ùiÚto™em
(
CONF_SECTION
 *
cs
)

56 ià(
cs
 =ğ
NULL
)

57  
NULL
;

58  (
CONF_ITEM
 *)
cs
;

59 
	}
}

64 
CONF_PAIR
 *
	$cf_·œ_®loc
(cÚ¡ *
©Œ
, cÚ¡ *
v®ue
,

65 
LRAD_TOKEN
 
İ”©Ü
, 
CONF_SECTION
 *
·»Á
)

67 
CONF_PAIR
 *
ı
;

69 
ı
 = (
CONF_PAIR
 *)
	`¿d_m®loc
((CONF_PAIR));

70 
	`mem£t
(
ı
, 0, (
CONF_PAIR
));

71 
ı
->
™em
.
ty³
 = 
CONF_ITEM_PAIR
;

72 
ı
->
™em
.
·»Á
 =…arent;

73 
ı
->
©Œ
 = 
	`¿d_¡rdup
(attr);

74 
ı
->
v®ue
 = 
	`¿d_¡rdup
(value);

75 
ı
->
İ”©Ü
 = operator;

77  
ı
;

78 
	}
}

83 
	$cf_·œ_ä“
(
CONF_PAIR
 **
ı
)

85 ià(!
ı
 || !*cp) ;

87 ià((*
ı
)->
©Œ
)

88 
	`¿d_ä“
((*
ı
)->
©Œ
);

89 ià((*
ı
)->
v®ue
)

90 
	`¿d_ä“
((*
ı
)->
v®ue
);

92 #iâdeà
NDEBUG


93 
	`mem£t
(*
ı
, 0, (*cp));

95 
	`¿d_ä“
(*
ı
);

97 *
ı
 = 
NULL
;

98 
	}
}

103 
CONF_SECTION
 *
	$cf_£ùiÚ_®loc
(cÚ¡ *
Çme1
, cÚ¡ *
Çme2
,

104 
CONF_SECTION
 *
·»Á
)

106 
CONF_SECTION
 *
cs
;

108 ià(
Çme1
 =ğ
NULL
 || !name1[0])

109 
Çme1
 = "main";

111 
cs
 = (
CONF_SECTION
 *)
	`¿d_m®loc
((CONF_SECTION));

112 
	`mem£t
(
cs
, 0, (
CONF_SECTION
));

113 
cs
->
™em
.
ty³
 = 
CONF_ITEM_SECTION
;

114 
cs
->
™em
.
·»Á
 =…arent;

115 
cs
->
Çme1
 = 
	`¿d_¡rdup
(name1);

116 
cs
->
Çme2
 = (Çme2 && *Çme2è? 
	`¿d_¡rdup
Òame2è: 
NULL
;

118  
cs
;

119 
	}
}

124 
	$cf_£ùiÚ_ä“
(
CONF_SECTION
 **
cs
)

126 
CONF_ITEM
 *
ci
, *
Ãxt
;

128 ià(!
cs
 || !*cs) ;

130 
ci
 = (*
cs
)->
chd»n
; ci; c˜ğ
Ãxt
) {

131 
Ãxt
 = 
ci
->next;

132 ià(
ci
->
ty³
==
CONF_ITEM_PAIR
) {

133 
CONF_PAIR
 *
·œ
 = 
	`cf_™emtİaœ
(
ci
);

134 
	`cf_·œ_ä“
(&
·œ
);

136 
CONF_SECTION
 *
£ùiÚ
 = 
	`cf_™emto£ùiÚ
(
ci
);

137 
	`cf_£ùiÚ_ä“
(&
£ùiÚ
);

141 ià((*
cs
)->
Çme1
)

142 
	`¿d_ä“
((*
cs
)->
Çme1
);

143 ià((*
cs
)->
Çme2
)

144 
	`¿d_ä“
((*
cs
)->
Çme2
);

149 #iâdeà
NDEBUG


150 
	`mem£t
(*
cs
, 0, (*cs));

152 
	`¿d_ä“
(*
cs
);

154 *
cs
 = 
NULL
;

155 
	}
}

160 
	$cf_™em_add
(
CONF_SECTION
 *
cs
, 
CONF_ITEM
 *
ci_Ãw
)

162 
CONF_ITEM
 *
ci
;

164 
ci
 = 
cs
->
chd»n
; c˜&& ci->
Ãxt
; ci = ci->next)

167 ià(
ci
 =ğ
NULL
)

168 
cs
->
chd»n
 = 
ci_Ãw
;

170 
ci
->
Ãxt
 = 
ci_Ãw
;

171 
	}
}

176 cÚ¡ *
	$cf_ex·nd_v¬ŸbËs
(cÚ¡ *
cf
, *
lš’o
,

177 
CONF_SECTION
 *
ou‹rcs
,

178 *
ouut
, cÚ¡ *
šput
)

180 *
p
;

181 cÚ¡ *
’d
, *
±r
;

182 
Çme
[8192];

183 
CONF_SECTION
 *
·»Ács
;

190 
·»Ács
 = 
ou‹rcs
;

191 
·»Ács
->
™em
.
·»Á
 !ğ
NULL
;

192 
·»Ács
 =…¬’tcs->
™em
.
·»Á
) {

196 
p
 = 
ouut
;

197 
±r
 = 
šput
;

198 *
±r
) {

202 ià((*
±r
 == '$') && (ptr[1] == '{')) {

203 
up
;

204 
CONF_PAIR
 *
ı
;

205 
CONF_SECTION
 *
cs
;

212 
’d
 = 
	`¡rchr
(
±r
, '}');

213 ià(
’d
 =ğ
NULL
) {

214 *
p
 = '\0';

215 
	`¿dlog
(
L_ERROR
, "[config] %s(%d): Variableƒxpansion missing '}'",

216 
cf
, *
lš’o
);

217  
NULL
;

220 
±r
 += 2;

222 
ı
 = 
NULL
;

223 
up
 = 0;

228 ià(*
±r
 == '.') {

229 
up
 = 1;

230 
cs
 = 
ou‹rcs
;

231 
±r
++;

237 *
±r
 == '.') {

238 ià(
cs
->
™em
.
·»Á
)

239 
cs
 = cs->
™em
.
·»Á
;

240 
±r
++;

244 cÚ¡ *
q
;

249 
cs
 = 
ou‹rcs
;

255 
q
 = 
±r
; *q && q !ğ
’d
; q++) {

256 ià(*
q
 == '.') {

257 
cs
 = 
·»Ács
;

258 
up
 = 1;

264 
ı
 =ğ
NULL
) {

265 *
q
;

269 
q
 = 
Çme
;

270 (*
±r
 != 0) && (*ptr != '.') &&

271 (
±r
 !ğ
’d
);

272 
q
++, 
±r
++) {

273 *
q
 = *
±r
;

275 *
q
 = '\0';

282 ià(*
±r
 == '.') {

283 
CONF_SECTION
 *
Ãxt
;

285 
±r
++;

290 
Ãxt
 = 
	`cf_£ùiÚ_sub_fšd
(
cs
, 
Çme
);

291 ià(
Ãxt
 =ğ
NULL
) {

292 
	`¿dlog
(
L_ERROR
, "[config] %s(%d): No such section %s in variable %s",

293 
cf
, *
lš’o
, 
Çme
, 
šput
);

294  
NULL
;

296 
cs
 = 
Ãxt
;

303 
ı
 = 
	`cf_·œ_fšd
(
cs
, 
Çme
);

304 ià(
ı
 =ğ
NULL
) {

310 ià(!
up
è
ı
 = 
	`cf_·œ_fšd
(
·»Ács
, 
Çme
);

312 ià(
ı
 =ğ
NULL
) {

313 
	`¿dlog
(
L_ERROR
, "[config] %s(%d): No suchƒntry %s for string %s",

314 
cf
, *
lš’o
, 
Çme
, 
šput
);

315  
NULL
;

323 
	`¡rıy
(
p
, 
ı
->
v®ue
);

324 
p
 +ğ
	`¡¾’
(p);

325 
±r
 = 
’d
 + 1;

327 } ià(
	`memcmp
(
±r
, "$ENV{", 5) == 0) {

328 *
’v
;

330 
±r
 += 5;

337 
’d
 = 
	`¡rchr
(
±r
, '}');

338 ià(
’d
 =ğ
NULL
) {

339 *
p
 = '\0';

340 
	`¿dlog
(
L_ERROR
, "[config] %s(%d): Environment variableƒxpansion missing '}'",

341 
cf
, *
lš’o
);

342  
NULL
;

345 
	`memıy
(
Çme
, 
±r
, 
’d
 -…tr);

346 
Çme
[
’d
 - 
±r
] = '\0';

352 
’v
 = 
	`g‘’v
(
Çme
);

353 ià(
’v
 =ğ
NULL
) {

354 *
Çme
 = '\0';

355 
’v
 = 
Çme
;

358 
	`¡rıy
(
p
, 
’v
);

359 
p
 +ğ
	`¡¾’
(p);

360 
±r
 = 
’d
 + 1;

366 *(
p
++èğ*(
±r
++);

370 *
p
 = '\0';

372  
ouut
;

373 
	}
}

378 
	$cf_£ùiÚ_·r£
(
CONF_SECTION
 *
cs
, *
ba£
,

379 cÚ¡ 
CONF_PARSER
 *
v¬ŸbËs
)

381 
i
;

382 
rcode
;

383 **
q
;

384 
CONF_PAIR
 *
ı
;

385 
CONF_SECTION
 *
sub£ùiÚ
;

386 
ušt32_t
 
addr
;

387 
bufãr
[8192];

388 cÚ¡ *
v®ue
;

389 *
d©a
;

394 
i
 = 0; 
v¬ŸbËs
[i].
Çme
 !ğ
NULL
; i++) {

395 
v®ue
 = 
v¬ŸbËs
[
i
].
dæt
;

396 ià(
v¬ŸbËs
[
i
].
d©a
) {

397 
d©a
 = 
v¬ŸbËs
[
i
].data;

398 } ià(
ba£
) {

399 
d©a
 = ((*)
ba£
è+ 
v¬ŸbËs
[
i
].
off£t
;

401 
d©a
 = 
v¬ŸbËs
[
i
].data;

404 
ı
 = 
	`cf_·œ_fšd
(
cs
, 
v¬ŸbËs
[
i
].
Çme
);

405 ià(
ı
) {

406 
v®ue
 = 
ı
->value;

409 
v¬ŸbËs
[
i
].
ty³
)

411 
PW_TYPE_SUBSECTION
:

412 
sub£ùiÚ
 = 
	`cf_£ùiÚ_sub_fšd
(
cs
, 
v¬ŸbËs
[
i
].
Çme
);

428 
rcode
 = 
	`cf_£ùiÚ_·r£
(
sub£ùiÚ
, 
ba£
,

429 (
CONF_PARSER
 *è
d©a
);

430 ià(
rcode
 < 0) {

435 
PW_TYPE_BOOLEAN
:

439 ià((
	`¡rÿ£cmp
(
v®ue
, "yes") == 0) ||

440 (
	`¡rÿ£cmp
(
v®ue
, "on") == 0)) {

441 *(*)
d©a
 = 1;

442 } ià((
	`¡rÿ£cmp
(
v®ue
, "no") == 0) ||

443 (
	`¡rÿ£cmp
(
v®ue
, "off") == 0)) {

444 *(*)
d©a
 = 0;

446 *(*)
d©a
 = 0;

447 
	`¿dlog
(
L_ERROR
, "[config…arser] Bad value \"%s\" for boolean variable %s",

448 
v®ue
, 
v¬ŸbËs
[
i
].
Çme
);

451 
	`DEBUG2
("[config…arser] %s: %s = %s",

452 
cs
 ? cs->
Çme1
 : "unknown",

453 
v¬ŸbËs
[
i
].
Çme
,

454 
v®ue
);

457 
PW_TYPE_INTEGER
:

458 *(*)
d©a
 = 
	`¡¹Ş
(
v®ue
, 0, 0);

459 
	`DEBUG2
("[config…arser] %s: %s = %d",

460 
cs
 ? cs->
Çme1
 : "unknown",

461 
v¬ŸbËs
[
i
].
Çme
,

462 *(*)
d©a
);

465 
PW_TYPE_STRING_PTR
:

466 
q
 = (**è
d©a
;

467 ià(*
q
 !ğ
NULL
) {

468 
	`¿d_ä“
(*
q
);

476 ià(
cs
 && 
v®ue
 && (v®u=ğ
v¬ŸbËs
[
i
].
dæt
)) {

477 
v®ue
 = 
	`cf_ex·nd_v¬ŸbËs
("?",

478 &
cs
->
™em
.
lš’o
,

479 
cs
, 
bufãr
, 
v®ue
);

480 ià(!
v®ue
) {

485 
	`DEBUG2
("[config…arser] %s: %s = \"%s\"",

486 
cs
 ? cs->
Çme1
 : "unknown",

487 
v¬ŸbËs
[
i
].
Çme
,

488 
v®ue
 ? value : "(null)");

489 *
q
 = 
v®ue
 ? 
	`¿d_¡rdup
(v®ueè: 
NULL
;

492 
PW_TYPE_IPADDR
:

496 ià(
	`¡rcmp
(
v®ue
, "*") == 0) {

497 *(
ušt32_t
 *è
d©a
 = 0;

500 
addr
 = 
	`_g‘addr
(
v®ue
);

501 ià(
addr
 == 0) {

502 
	`¿dlog
(
L_ERROR
, "[cÚfig…¬£r] Cª'ˆfšd IP‡dd»s fÜ ho¡ %s", 
v®ue
);

505 
	`DEBUG2
("[config…arser] %s: %s = %s IP‡ddress (%s)",

506 
cs
 ? cs->
Çme1
 : "unknown",

507 
v¬ŸbËs
[
i
].
Çme
,

508 
v®ue
, 
	`_Áß
(
bufãr
, 
addr
));

509 *(
ušt32_t
 *è
d©a
 = 
addr
;

513 
	`¿dlog
(
L_ERROR
, "[cÚfig…¬£r] Ty³ %d‚Ù suµÜ‹d y‘", 
v¬ŸbËs
[
i
].
ty³
);

520 
	}
}

525 
CONF_SECTION
 *
	$cf_£ùiÚ_»ad
(cÚ¡ *
cf
, *
lš’o
, 
FILE
 *
å
,

526 cÚ¡ *
Çme1
, cÚ¡ *
Çme2
,

527 
CONF_SECTION
 *
·»Á
)

529 
CONF_SECTION
 *
cs
, *
css
;

530 
CONF_PAIR
 *
ın
;

531 cÚ¡ *
±r
;

532 cÚ¡ *
v®ue
;

533 
buf
[8192];

534 
buf1
[8192];

535 
buf2
[8192];

536 
buf3
[8192];

537 
t1
, 
t2
, 
t3
;

538 *
cbuf
 = 
buf
;

539 
Ën
;

545 ià((
Çme1
 !ğ
NULL
) && (name1[0] == '_')) {

546 
	`¿dlog
(
L_ERROR
, "[config] %s(%d): Illegal configuration section‚ame",

547 
cf
, *
lš’o
);

548  
NULL
;

554 
cs
 = 
	`cf_£ùiÚ_®loc
(
Çme1
, 
Çme2
, 
·»Á
);

555 
cs
->
™em
.
lš’o
 = *lineno;

561 
eof
;

566 
eof
 = (
	`fg‘s
(
cbuf
, (
buf
è- (cbuà- buf), 
å
è=ğ
NULL
);

567 (*
lš’o
)++;

569 
Ën
 = 
	`¡¾’
(
cbuf
);

575 ià((
Ën
 =ğ(
buf
)) &&

576 (
cbuf
[
Ën
 - 1] != '\n')) {

577 
	`¿dlog
(
L_ERROR
, "[config] %s(%d): Lineoo†ong",

578 
cf
, *
lš’o
);

579 
	`cf_£ùiÚ_ä“
(&
cs
);

580  
NULL
;

586 ià(
cbuf
[
Ën
 - 1] == '\n')†en--;

592 ià((
Ën
 > 0è&& (
cbuf
[len - 1] == '\\')) {

593 
cbuf
[
Ën
 - 1] = '\0';

594 
cbuf
 +ğ
Ën
 - 1;

601 ià(
eof
 && (
cbuf
 =ğ
buf
)) {

605 
±r
 = 
cbuf
 = 
buf
;

606 
t1
 = 
	`g‘tok’
(&
±r
, 
buf1
, (buf1));

611 ià((*
buf1
 == '#') || (*buf1 == '\0')) {

621 ià(
	`¡rÿ£cmp
(
buf1
, "$INCLUDE") == 0) {

623 
CONF_SECTION
 *
is
;

625 
t2
 = 
	`g‘wÜd
(&
±r
, 
buf2
, (buf2));

627 
v®ue
 = 
	`cf_ex·nd_v¬ŸbËs
(
cf
, 
lš’o
, 
cs
, 
buf
, 
buf2
);

628 ià(
v®ue
 =ğ
NULL
) {

629 
	`cf_£ùiÚ_ä“
(&
cs
);

630  
NULL
;

633 
	`DEBUG2
Ğ"[cÚfig] %s(%d): Inşudšg fe: %s", 
cf
, *
lš’o
, 
v®ue
 );

635 ià((
is
 = 
	`cÚf_»ad
(
cf
, *
lš’o
, 
v®ue
, 
·»Á
)è=ğ
NULL
) {

636 
	`cf_£ùiÚ_ä“
(&
cs
);

637  
NULL
;

643 ià(
is
 !ğ
NULL
) {

644 ià(
is
->
chd»n
 !ğ
NULL
) {

645 
CONF_ITEM
 *
ci
;

652 
ci
 = 
is
->
chd»n
; ci; c˜ğci->
Ãxt
) {

653 
ci
->
·»Á
 = 
cs
;

660 ià(
is
->
chd»n
) {

661 
	`cf_™em_add
(
cs
, 
is
->
chd»n
);

663 
is
->
chd»n
 = 
NULL
;

669 
	`cf_£ùiÚ_ä“
(&
is
);

678 ià(
	`¡rchr
(
±r
, '='è=ğ
NULL
) {

679 
t2
 = 
	`g‘tok’
(&
±r
, 
buf2
, (buf2));

680 
t3
 = 
	`g‘tok’
(&
±r
, 
buf3
, (buf3));

682 
t2
 = 
	`g‘tok’
(&
±r
, 
buf2
, (buf2));

683 
t3
 = 
	`g‘wÜd
(&
±r
, 
buf3
, (buf3));

689 ià(
t1
 =ğ
T_RCBRACE
) {

690 ià(
Çme1
 =ğ
NULL
 || 
buf2
[0]) {

691 
	`¿dlog
(
L_ERROR
, "[config] %s(%d): Unexpectedƒnd of section",

692 
cf
, *
lš’o
);

693 
	`cf_£ùiÚ_ä“
(&
cs
);

694  
NULL
;

696  
cs
;

702 ià(
t2
 =ğ
T_LCBRACE
 || 
t3
 == T_LCBRACE) {

703 
css
 = 
	`cf_£ùiÚ_»ad
(
cf
, 
lš’o
, 
å
, 
buf1
,

704 
t2
==
T_LCBRACE
 ? 
NULL
 : 
buf2
, 
cs
);

705 ià(
css
 =ğ
NULL
) {

706 
	`cf_£ùiÚ_ä“
(&
cs
);

707  
NULL
;

709 
	`cf_™em_add
(
cs
, 
	`cf_£ùiÚto™em
(
css
));

717 ià(*
buf2
 == ';')

718 *
buf2
 = '\0';

723 ià(
buf1
[0] !ğ0 && 
buf2
[0] =ğ0 && 
buf3
[0] == 0) {

724 
t2
 = 
T_OP_EQ
;

725 } ià(
buf1
[0] =ğ0 || 
buf2
[0] == 0 ||

726 (
t2
 < 
T_EQSTART
 ||2 > 
T_EQEND
)) {

727 
	`¿dlog
(
L_ERROR
, "[config] %s(%d): Line is‚ot in 'attribute = value' format",

728 
cf
, *
lš’o
);

729 
	`cf_£ùiÚ_ä“
(&
cs
);

730  
NULL
;

737 ià(
buf1
[0] == '_') {

738 
	`¿dlog
(
L_ERROR
, "[config] %s(%d): Illegal configuration…air‚ame \"%s\"",

739 
cf
, *
lš’o
, 
buf1
);

740 
	`cf_£ùiÚ_ä“
(&
cs
);

741  
NULL
;

747 
v®ue
 = 
	`cf_ex·nd_v¬ŸbËs
(
cf
, 
lš’o
, 
cs
, 
buf
, 
buf3
);

748 ià(!
v®ue
) {

749 
	`cf_£ùiÚ_ä“
(&
cs
);

750  
NULL
;

757 
ın
 = 
	`cf_·œ_®loc
(
buf1
, 
v®ue
, 
t2
, 
·»Á
);

758 
ın
->
™em
.
lš’o
 = *lineno;

759 
	`cf_™em_add
(
cs
, 
	`cf_·œto™em
(
ın
));

765 ià(
Çme1
 !ğ
NULL
) {

766 
	`¿dlog
(
L_ERROR
, "[cÚfig] %s(%d): UÃx³ùedƒnd oàfe", 
cf
, *
lš’o
);

767 
	`cf_£ùiÚ_ä“
(&
cs
);

768  
NULL
;

771  
cs
;

772 
	}
}

777 
CONF_SECTION
 *
	$cÚf_»ad
(cÚ¡ *
äomfe
, 
äomlše
,

778 cÚ¡ *
cÚffe
, 
CONF_SECTION
 *
·»Á
)

780 
FILE
 *
å
;

781 
lš’o
 = 0;

782 
CONF_SECTION
 *
cs
;

784 ià((
å
 = 
	`fİ’
(
cÚffe
, "r")è=ğ
NULL
) {

785 ià(
äomfe
) {

786 
	`¿dlog
(
L_ERROR
|
L_CONS
, "[config] %s(%d): Unableo open file \"%s\": %s",

787 
äomfe
, 
äomlše
, 
cÚffe
, 
	`¡»¼Ü
(
”ºo
));

789 
	`¿dlog
(
L_ERROR
|
L_CONS
, "[config] Unableo open file \"%s\": %s",

790 
cÚffe
, 
	`¡»¼Ü
(
”ºo
));

792  
NULL
;

795 if(
·»Á
) {

796 
cs
 = 
	`cf_£ùiÚ_»ad
(
cÚffe
, &
lš’o
, 
å
, 
NULL
, NULL, 
·»Á
);

798 
cs
 = 
	`cf_£ùiÚ_»ad
(
cÚffe
, &
lš’o
, 
å
, 
NULL
, NULL, NULL);

801 
	`fşo£
(
å
);

803  
cs
;

804 
	}
}

809 
CONF_PAIR
 *
	$cf_·œ_fšd
(
CONF_SECTION
 *
£ùiÚ
, cÚ¡ *
Çme
)

811 
CONF_ITEM
 *
ci
;

813 ià(
£ùiÚ
 =ğ
NULL
) {

814  
NULL
;

817 
ci
 = 
£ùiÚ
->
chd»n
; ci; c˜ğci->
Ãxt
) {

818 ià(
ci
->
ty³
 !ğ
CONF_ITEM_PAIR
)

820 ià(
Çme
 =ğ
NULL
 || 
	`¡rcmp
(
	`cf_™emtİaœ
(
ci
)->
©Œ
,‚ame) == 0)

824  
	`cf_™emtİaœ
(
ci
);

825 
	}
}

831 *
	$cf_·œ_©Œ
(
CONF_PAIR
 *
·œ
)

833  (
·œ
 ?…aœ->
©Œ
 : 
NULL
);

834 
	}
}

840 *
	$cf_·œ_v®ue
(
CONF_PAIR
 *
·œ
)

842  (
·œ
 ?…aœ->
v®ue
 : 
NULL
);

843 
	}
}

849 *
	$cf_£ùiÚ_Çme1
(
CONF_SECTION
 *
£ùiÚ
)

851  (
£ùiÚ
 ? seùiÚ->
Çme1
 : 
NULL
);

852 
	}
}

858 *
	$cf_£ùiÚ_Çme2
(
CONF_SECTION
 *
£ùiÚ
)

860  (
£ùiÚ
 ? seùiÚ->
Çme2
 : 
NULL
);

861 
	}
}

866 *
	$cf_£ùiÚ_v®ue_fšd
(
CONF_SECTION
 *
£ùiÚ
, cÚ¡ *
©Œ
)

868 
CONF_PAIR
 *
ı
;

870 
ı
 = 
	`cf_·œ_fšd
(
£ùiÚ
, 
©Œ
);

872  (
ı
 ? cp->
v®ue
 : 
NULL
);

873 
	}
}

881 
CONF_PAIR
 *
	$cf_·œ_fšd_Ãxt
(
CONF_SECTION
 *
£ùiÚ
, 
CONF_PAIR
 *
·œ
, cÚ¡ *
©Œ
)

883 
CONF_ITEM
 *
ci
;

890 ià(
·œ
 =ğ
NULL
){

891  
	`cf_·œ_fšd
(
£ùiÚ
, 
©Œ
);

894 
ci
 = 
	`cf_·œto™em
(
·œ
)->
Ãxt
;

896 ; 
ci
; c˜ğci->
Ãxt
) {

897 ià(
ci
->
ty³
 !ğ
CONF_ITEM_PAIR
)

899 ià(
©Œ
 =ğ
NULL
 || 
	`¡rcmp
(
	`cf_™emtİaœ
(
ci
)->attr,‡ttr) == 0)

903  
	`cf_™emtİaœ
(
ci
);

904 
	}
}

910 
CONF_SECTION
 *
	$cf_£ùiÚ_sub_fšd
(
CONF_SECTION
 *
£ùiÚ
, cÚ¡ *
Çme
)

912 
CONF_ITEM
 *
ci
;

914 if(
£ùiÚ
 =ğ
NULL
) {

915  
NULL
;

918 
ci
 = 
£ùiÚ
->
chd»n
; ci; c˜ğci->
Ãxt
) {

919 ià(
ci
->
ty³
 !ğ
CONF_ITEM_SECTION
)

921 ià(
	`¡rcmp
(
	`cf_™emto£ùiÚ
(
ci
)->
Çme1
, 
Çme
) == 0)

925  
	`cf_™emto£ùiÚ
(
ci
);

926 
	}
}

934 
CONF_SECTION
 *
	$cf_sub£ùiÚ_fšd_Ãxt
(
CONF_SECTION
 *
£ùiÚ
,

935 
CONF_SECTION
 *
sub£ùiÚ
,

936 cÚ¡ *
Çme1
)

938 
CONF_ITEM
 *
ci
;

945 ià(
sub£ùiÚ
 =ğ
NULL
){

946 
ci
 = 
£ùiÚ
->
chd»n
;

948 
ci
 = 
	`cf_£ùiÚto™em
(
sub£ùiÚ
)->
Ãxt
;

951 ; 
ci
; c˜ğci->
Ãxt
) {

952 ià(
ci
->
ty³
 !ğ
CONF_ITEM_SECTION
)

954 ià((
Çme1
 =ğ
NULL
) ||

955 (
	`¡rcmp
(
	`cf_™emto£ùiÚ
(
ci
)->
Çme1
,‚ame1) == 0))

959  
	`cf_™emto£ùiÚ
(
ci
);

960 
	}
}

966 
CONF_ITEM
 *
	$cf_™em_fšd_Ãxt
(
CONF_SECTION
 *
£ùiÚ
, 
CONF_ITEM
 *
™em
)

973 ià(
™em
 =ğ
NULL
) {

974  
£ùiÚ
->
chd»n
;

976  
™em
->
Ãxt
;

978 
	}
}

980 
	$cf_£ùiÚ_lš’o
(
CONF_SECTION
 *
£ùiÚ
)

982  
	`cf_£ùiÚto™em
(
£ùiÚ
)->
lš’o
;

983 
	}
}

985 
	$cf_·œ_lš’o
(
CONF_PAIR
 *
·œ
)

987  
	`cf_·œto™em
(
·œ
)->
lš’o
;

988 
	}
}

990 
	$cf_™em_is_£ùiÚ
(
CONF_ITEM
 *
™em
)

992  
™em
->
ty³
 =ğ
CONF_ITEM_SECTION
;

993 
	}
}

999 
	$dump_cÚfig_£ùiÚ
(cÚ¡ 
CONF_SECTION
 *
cs
, 
šd’t
)

1001 
CONF_SECTION
 *
scs
;

1002 
CONF_PAIR
 *
ı
;

1003 
CONF_ITEM
 *
ci
;

1009 
ci
 = 
cs
->
chd»n
; ci; c˜ğci->
Ãxt
) {

1010 ià(
ci
->
ty³
 =ğ
CONF_ITEM_PAIR
) {

1011 
ı
=
	`cf_™emtİaœ
(
ci
);

1012 
	`DEBUG
("[config dump] %.*s%s = %s",

1013 
šd’t
, "\t\t\t\t\t\t\t\t\t\t\t",

1014 
ı
->
©Œ
, cp->
v®ue
);

1016 
scs
=
	`cf_™emto£ùiÚ
(
ci
);

1017 
	`DEBUG
("[config dump] %.*s%s %s%s{",

1018 
šd’t
, "\t\t\t\t\t\t\t\t\t\t\t",

1019 
scs
->
Çme1
,

1020 
scs
->
Çme2
 ? scs->name2 : "",

1021 
scs
->
Çme2
 ? " " : "");

1022 
	`dump_cÚfig_£ùiÚ
(
scs
, 
šd’t
+1);

1023 
	`DEBUG
("[config dump] %.*s}",

1024 
šd’t
, "\t\t\t\t\t\t\t\t\t\t\t");

1029 
	}
}

	@radutil/radconffile.h

10 #iâdeà
__RAD_CONFFILE_H__


11 
	#__RAD_CONFFILE_H__


	)

13 #ifdeà
__ılu¥lus


20 
cÚf_™em
 
	tCONF_ITEM
;

21 
cÚf_·œ
 
	tCONF_PAIR
;

22 
cÚf_·¹
 
	tCONF_SECTION
;

29 
	#PW_TYPE_STRING_PTR
 100

	)

30 
	#PW_TYPE_BOOLEAN
 101

	)

31 
	#PW_TYPE_SUBSECTION
 102

	)

32 
	#PW_TYPE_INTEGER
 103

	)

33 
	#PW_TYPE_IPADDR
 104

	)

35 
	sCONF_PARSER
 {

36 cÚ¡ *
Çme
;

37 
ty³
;

38 
size_t
 
off£t
;

39 *
d©a
;

40 cÚ¡ *
dæt
;

41 } 
	tCONF_PARSER
;

44 
	#XSŒšgify
(
x
è#x

	)

45 
	#SŒšgify
(
x
è
	`XSŒšgify
(x)

	)

51 
CONF_SECTION
 *
cÚf_»ad
(cÚ¡ *
äomfe
, 
äomlše
,

52 cÚ¡ *
cÚffe
, 
CONF_SECTION
 *
·»Á
);

53 
dump_cÚfig_£ùiÚ
(cÚ¡ 
CONF_SECTION
 *
cs
, 
šd’t
);

54 
cf_£ùiÚ_ä“
(
CONF_SECTION
 **
ı
);

56 
cf_£ùiÚ_·r£
(
CONF_SECTION
 *
cs
, *
ba£
, cÚ¡ 
CONF_PARSER
 *
v¬ŸbËs
);

58 
CONF_PAIR
 *
cf_™emtİaœ
(
CONF_ITEM
 *
ci
);

59 
CONF_SECTION
 *
cf_™emto£ùiÚ
(
CONF_ITEM
 *
ci
);

60 
CONF_ITEM
 *
cf_·œto™em
(
CONF_PAIR
 *
ı
);

61 
CONF_ITEM
 *
cf_£ùiÚto™em
(
CONF_SECTION
 *
cs
);

63 
CONF_PAIR
 *
cf_·œ_fšd
(
CONF_SECTION
 *
£ùiÚ
, cÚ¡ *
Çme
);

64 *
cf_·œ_©Œ
(
CONF_PAIR
 *
·œ
);

65 *
cf_·œ_v®ue
(
CONF_PAIR
 *
·œ
);

66 *
cf_£ùiÚ_Çme1
(
CONF_SECTION
 *
£ùiÚ
);

67 *
cf_£ùiÚ_Çme2
(
CONF_SECTION
 *
£ùiÚ
);

68 *
cf_£ùiÚ_v®ue_fšd
(
CONF_SECTION
 *
£ùiÚ
, cÚ¡ *
©Œ
);

69 
CONF_PAIR
 *
cf_·œ_fšd_Ãxt
(
CONF_SECTION
 *
£ùiÚ
, CONF_PAIR *
·œ
, cÚ¡ *
©Œ
);

70 
CONF_SECTION
 *
cf_£ùiÚ_sub_fšd
(CONF_SECTION *
£ùiÚ
, cÚ¡ *
Çme
);

71 
CONF_SECTION
 *
cf_sub£ùiÚ_fšd_Ãxt
(CONF_SECTION *
£ùiÚ
,

72 
CONF_SECTION
 *
sub£ùiÚ
,

73 cÚ¡ *
Çme1
);

74 
CONF_ITEM
 *
cf_™em_fšd_Ãxt
(
CONF_SECTION
 *
£ùiÚ
, CONF_ITEM *
™em
);

75 
cf_£ùiÚ_lš’o
(
CONF_SECTION
 *
£ùiÚ
);

76 
cf_·œ_lš’o
(
CONF_PAIR
 *
·œ
);

77 
cf_™em_is_£ùiÚ
(
CONF_ITEM
 *
™em
);

79 #ifdeà
__ılu¥lus


	@radutil/raddebug.c

1 
	~"¿dut.h
"

2 
	~<¡dlib.h
>

4 
	$¿d_as£¹_ç
(cÚ¡ *
fe
, 
lše
, cÚ¡ * 
ex´
)

6 
	`¿dlog
(
L_FATAL
|
L_CONS
, "ASSERTION FAILED iÀ%s,†š%u: %s", 
fe
, 
lše
, 
ex´
);

7 
	`abÜt
();

8 
	}
}

	@radutil/raddebug.h

8 #iâdeà
__RAD_DEBUG_H__


9 
	#__RAD_DEBUG_H__


	)

11 #ifdeà
__ılu¥lus


16 #ià
defšed
(
NDEBUG
)

17 #ià
defšed
(
_DEBUG
)

18 #”rÜ 
ANSI
' NDEBUG i tuºed on, buˆCRT'
s
 
_DEBUG
 
is
 
®so
 
tuºed
 
Ú
.

20 
	#¿d_as£¹
(
ex´
è(()0)

	)

21 
	#¿d_v”ify
(
ex´
èÓx´)

	)

23 
	#¿d_as£¹
(
ex´
) \

24 ((
ex´
è? ()0 : 
	`¿d_as£¹_ç
(
__FILE__
, 
__LINE__
, #ex´))

	)

25 
	#¿d_v”ify
(
ex´
è
	`¿d_as£¹
Óx´)

	)

28 
¿d_as£¹_ç
(cÚ¡ *
fe
, 
lše
, cÚ¡ * 
ex´
);

30 #ifdeà
__ılu¥lus


	@radutil/radheaptrack.c

1 
	~"¿dut.h
"

2 
	~<¡ršg.h
>

3 
	~<¡ddef.h
>

4 
	~<¡dlib.h
>

5 #ià
defšed
(
RAD_OS_WIN32
)

6 
	~<wšdows.h
>

8 
	~<±h»ad.h
>

13 #iâdeà
CONTAINING_RECORD


14 
	#CONTAINING_RECORD
(
p
, 
»cÜd_ty³
, 
memb”_Çme
) \

15 (
»cÜd_ty³
*)(((*)(
p
)è- 
	`off£tof
ÔecÜd_ty³, 
memb”_Çme
))

	)

18 
	s_¿d_h—p_Œackšg_»cÜd


20 
Ìad_ršg_’Œy
 
	mlšk
;

21 
size_t
 
	msize
;

22 cÚ¡ * 
	mfe
;

23 
	mlše
;

24 } 
	t¿d_h—p_Œackšg_»cÜd
;

27 
Ìad_ršg_’Œy
 
	gŒackšg_»cÜds
 = {
NULL
, NULL};

28 
¿d_lock_t
 
	glock
;

30 
	$¿d_¡¬t_h—p_Œackšg
()

32 
	`¿d_lock_š™
(&
lock
);

33 
	`Ìad_ršg_š™_h—d
(&
Œackšg_»cÜds
);

34 
	}
}

36 
	$¿d_dump_h—p_u§ge
()

38 if(!
	`Ìad_ršg_is_em±y
(&
Œackšg_»cÜds
))

40 
Ìad_ršg_’Œy
* 
p
;

41 
	`¿d_lock_acquœe
(&
lock
);

42 
p
=
Œackšg_»cÜds
.
Ãxt
;…!=&tracking_records;…=p->next)

44 
¿d_h—p_Œackšg_»cÜd
* 
q
 =

45 
	`CONTAINING_RECORD
(
p
, 
¿d_h—p_Œackšg_»cÜd
, 
lšk
);

46 
	`¿dlog
(
L_FATAL
, "Memory†eak: %u bytes‡llocated in %s:%u",

47 
q
->
size
, q->
fe
, q->
lše
);

49 
	`¿d_lock_»Ëa£
(&
lock
);

51 
	}
}

53 
	$¿d_¡İ_h—p_Œackšg
()

55 if(!
	`Ìad_ršg_is_em±y
(&
Œackšg_»cÜds
)) {

56 
	`¿dlog
(
L_FATAL
|
L_CONS
, "MEMORY LEAK DETECTED! Heap usage dumps here:");

57 
	`¿d_dump_h—p_u§ge
();

59 
	`¿d_lock_de¡roy
(&
lock
);

60 
	}
}

62 *
	$¿d_m®loc_Œack
(
size_t
 
size
, cÚ¡ *
fe
, 
lše
)

64 
¿d_h—p_Œackšg_»cÜd
* 
mem
;

66 if(
Œackšg_»cÜds
.
Ãxt
 =ğ
NULL
) {

67 
	`¿dlog
(
L_FATAL
|
L_CONS
, "[rad_malloc_track] call `rad_start_heap_tracking()' first");

68 
	`ex™
(1);

71 
mem
 = 
	`m®loc
((
¿d_h—p_Œackšg_»cÜd
è+ 
size
);

73 if(
mem
) {

74 
mem
->
size
 = size;

75 
mem
->
fe
 = file;

76 
mem
->
lše
 =†ine;

77 
	`¿d_lock_acquœe
(&
lock
);

78 
	`Ìad_ršg_š£¹_
(&
Œackšg_»cÜds
, &
mem
->
lšk
);

79 
	`¿d_lock_»Ëa£
(&
lock
);

80  
mem
+1;

83 
	`¿dlog
(
L_FATAL
|
L_CONS
, "[rad_malloc_track]‚o memory");

84 
	`ex™
(1);

87  
NULL
;

88 
	}
}

90 
	$¿d_ä“_Œack
(* 
mem
)

92 if(
mem
) {

93 
¿d_h—p_Œackšg_»cÜd
* 
p
 =

94 (
¿d_h—p_Œackšg_»cÜd
*)

95 ((*)
mem
-(
¿d_h—p_Œackšg_»cÜd
));

96 
	`¿d_lock_acquœe
(&
lock
);

97 
	`Ìad_ršg_»move_’Œy
(&
p
->
lšk
);

98 
	`¿d_lock_»Ëa£
(&
lock
);

99 
	`ä“
(
p
);

101 
	}
}

103 *
	$¿d_¡rdup_Œack
(cÚ¡ *
¡ršg
,

104 cÚ¡ *
fe
, 
lše
)

106 *
memÜy
;

107 
size_t
 
¡ršgËn
;

109 ià(!
¡ršg
)

110  
NULL
;

112 
¡ršgËn
 = 
	`¡¾’
(
¡ršg
);

113 
memÜy
 = 
	`¿d_m®loc_Œack
(
¡ršgËn
 + 1, 
fe
, 
lše
);

114 if(
memÜy
)

115  
	`memıy
(
memÜy
, 
¡ršg
, 
¡ršgËn
 + 1);

117  
NULL
;

118 
	}
}

120 
	$Ìad_ršg_š™_h—d
(
Ìad_ršg_’Œy
* 
h—d
)

122 
h—d
->
´ev
 = h—d->
Ãxt
 = head;

123 
	}
}

125 
	$Ìad_ršg_is_em±y
(
Ìad_ršg_’Œy
* 
h—d
)

127  
h—d
->
Ãxt
 == head;

128 
	}
}

130 
	$Ìad_ršg_»move_’Œy
(
Ìad_ršg_’Œy
* 
’Œy
)

132 
Ìad_ršg_’Œy
* 
´ev
;

133 
Ìad_ršg_’Œy
* 
Ãxt
;

134 
Ãxt
 = 
’Œy
->next;

135 
´ev
 = 
’Œy
->prev;

136 
´ev
->
Ãxt
 =‚ext;

137 
Ãxt
->
´ev
 =…rev;

138 
	}
}

140 
Ìad_ršg_’Œy
* 
	$Ìad_ršg_»move_h—d
(
Ìad_ršg_’Œy
* 
h—d
)

142 
Ìad_ršg_’Œy
* 
Ãxt
;

143 
Ìad_ršg_’Œy
* 
’Œy
;

144 
’Œy
 = 
h—d
->
Ãxt
;

145 
Ãxt
 = 
’Œy
->next;

146 
h—d
->
Ãxt
 =‚ext;

147 
Ãxt
->
´ev
 = 
h—d
;

148  
’Œy
;

149 
	}
}

151 
Ìad_ršg_’Œy
* 
	$Ìad_ršg_»move_
(
Ìad_ršg_’Œy
* 
h—d
)

153 
Ìad_ršg_’Œy
* 
´ev
;

154 
Ìad_ršg_’Œy
* 
’Œy
;

155 
’Œy
 = 
h—d
->
´ev
;

156 
´ev
 = 
’Œy
->prev;

157 
h—d
->
´ev
 =…rev;

158 
´ev
->
Ãxt
 = 
h—d
;

159  
’Œy
;

160 
	}
}

162 
	$Ìad_ršg_š£¹_
(
Ìad_ršg_’Œy
* 
h—d
,†¿d_ršg_’Œy* 
’Œy
)

164 
Ìad_ršg_’Œy
* 
´ev
;

165 
´ev
 = 
h—d
->prev;

166 
’Œy
->
Ãxt
 = 
h—d
;

167 
’Œy
->
´ev
 =…rev;

168 
´ev
->
Ãxt
 = 
’Œy
;

169 
h—d
->
´ev
 = 
’Œy
;

170 
	}
}

172 
	$Ìad_ršg_š£¹_h—d
(
Ìad_ršg_’Œy
* 
h—d
,†¿d_ršg_’Œy* 
’Œy
)

174 
Ìad_ršg_’Œy
* 
Ãxt
;

175 
Ãxt
 = 
h—d
->next;

176 
’Œy
->
Ãxt
 =‚ext;

177 
’Œy
->
´ev
 = 
h—d
;

178 
Ãxt
->
´ev
 = 
’Œy
;

179 
h—d
->
Ãxt
 = 
’Œy
;

180 
	}
}

	@radutil/radheaptrack.h

10 #iâdeà
__RAD_HEAPTRACK_H__


11 
	#__RAD_HEAPTRACK_H__


	)

13 #ifdeà
__ılu¥lus


18 
_Ìad_ršg_’Œy
 
	tÌad_ršg_’Œy
;

20 
	s_Ìad_ršg_’Œy
 {

21 
Ìad_ršg_’Œy
 *
Ãxt
;

22 
Ìad_ršg_’Œy
 *
´ev
;

25 
Ìad_ršg_š™_h—d
(
Ìad_ršg_’Œy
* 
h—d
);

26 
Ìad_ršg_is_em±y
(
Ìad_ršg_’Œy
* 
h—d
);

27 
Ìad_ršg_»move_’Œy
(
Ìad_ršg_’Œy
* 
’Œy
);

28 
Ìad_ršg_’Œy
* 
Ìad_ršg_»move_h—d
Ö¿d_ršg_’Œy* 
h—d
);

29 
Ìad_ršg_’Œy
* 
Ìad_ršg_»move_
Ö¿d_ršg_’Œy* 
h—d
);

30 
Ìad_ršg_š£¹_
(
Ìad_ršg_’Œy
* 
h—d
,†¿d_ršg_’Œy* 
’Œy
);

31 
Ìad_ršg_š£¹_h—d
(
Ìad_ršg_’Œy
* 
h—d
,†¿d_ršg_’Œy* 
’Œy
);

34 *
¿d_m®loc_Œack
(
size_t
 
size
, cÚ¡ *
fe
, 
lše
);

35 
¿d_ä“_Œack
(* 
mem
);

36 *
¿d_¡rdup_Œack
(cÚ¡ *
s
, cÚ¡ *
fe
, 
lše
);

38 
	#¿d_m®loc
(
size
è
	`¿d_m®loc_Œack
(size, 
__FILE__
, 
__LINE__
)

	)

39 
	#¿d_ä“
(
mem
è
	`¿d_ä“_Œack
(mem)

	)

40 
	#¿d_¡rdup
(
s
è
	`¿d_¡rdup_Œack
(s, 
__FILE__
, 
__LINE__
)

	)

43 
¿d_¡¬t_h—p_Œackšg
();

44 
¿d_dump_h—p_u§ge
();

45 
¿d_¡İ_h—p_Œackšg
();

47 #ifdeà
__ılu¥lus


	@radutil/radipc.c

1 
	~"¿dut.h
"

2 
	~<¡dio.h
>

3 
	~<¡dlib.h
>

4 
	~<¡ršg.h
>

5 
	~<”ºo.h
>

7 #ià
defšed
(
RAD_OS_WIN32
)

8 
	~<wšdows.h
>

10 
	~<sys/c.h
>

11 
	~<sys/£m.h
>

12 
	~<sys/shm.h
>

13 
	~<sys/time.h
>

16 #ià
defšed
(
RAD_OS_WIN32
)

18 
£m_t
 
	$¿d_£mg‘
(
£m_key_t
 
key
, 
š™
, 
æags
)

20 
DWORD
 
”ºum
;

21 
HANDLE
 
h£m
;

22 
key¡r
[9];

23 
buf
[256];

25 
	`¥rštf
(
key¡r
, "%08X", 
key
);

27 if(!(
æags
 & 
RADIPC_CREAT
)) {

28 
h£m
 = 
	`O³nSem­hÜe
(
SYNCHRONIZE
|
SEMAPHORE_MODIFY_STATE
,

29 
FALSE
, 
key¡r
);

30 
”ºum
 = 
	`G‘La¡E¼Ü
();

32 if(
h£m
 =ğ
NULL
) {

33 
	`¡»¼Ü_r
(
”ºum
, 
buf
, (buf));

34 
	`¿dlog
(
L_ERROR
|
L_CONS
, "[rad_semget] OpenSemaphore(%s): "

35 "%d %s", 
key¡r
, 
”ºum
, 
buf
);

36  
NULL_SEM
;

39  (
£m_t
)
h£m
;

42 
h£m
 = 
	`C»©eSem­hÜe
(
NULL
, 
š™
, 0x7FFFFFFF, 
key¡r
);

43 
”ºum
 = 
	`G‘La¡E¼Ü
();

45 if(
h£m
 =ğ
NULL
) {

46 
	`¡»¼Ü_r
(
”ºum
, 
buf
, (buf));

47 
	`¿dlog
(
L_ERROR
|
L_CONS
, "[rad_semget] CreateSemaphore(%s, %d, %d): "

48 "%d %s", 
key¡r
, 
š™
, 
æags
, 
”ºum
, 
buf
);

49  
NULL_SEM
;

52 if(
”ºum
 =ğ
ERROR_ALREADY_EXISTS
 &&

53 (
æags
 & 
RADIPC_EXCL
)) {

54 
	`Clo£HªdË
(
h£m
);

55  
EXIST_SEM
;

58  (
£m_t
)
h£m
;

59 
	}
}

61 
	$¿d_£mİ
 (
£m_t
 
id
, 
İ
, 
m£c
)

63 
DWORD
 
”ºum
, 
»tv®
;

64 
buf
[256];

65 
HANDLE
 
h£m
 = (HANDLE)
id
;

67 
	`¿d_as£¹
(
İ
 != 0);

68 if(
İ
 == 0)

71 if(
İ
 > 0) {

73 if(!
	`R–—£Sem­hÜe
(
h£m
, 
İ
, 
NULL
)) {

74 
”ºum
 = 
	`G‘La¡E¼Ü
();

75 
	`¡»¼Ü_r
(
”ºum
, 
buf
, (buf));

76 
	`¿dlog
(
L_ERROR
|
L_CONS
, "[rad_semop] ReleaseSemaphore(%d): "

77 "%d %s", 
İ
, 
”ºum
, 
buf
);

83 
İ
 = 0 - op;

84 
m£c
 = (m£ø=ğ
RADIPC_WAIT_INFINITE
 ? 
INFINITE
 : msec);

97 
İ
-- > 1) {

98 if(
	`Wa™FÜSšgËObjeù
(
h£m
, 0è!ğ
WAIT_OBJECT_0
) {

99 
	`¿dlog
(
L_ERROR
|
L_CONS
, "[rad_semop] WaitForSingleObject: "

105 
»tv®
 = 
	`Wa™FÜSšgËObjeù
(
h£m
, 
m£c
);

106 
»tv®
) {

107 
WAIT_OBJECT_0
:

109 
WAIT_TIMEOUT
:

112 
”ºum
 = 
	`G‘La¡E¼Ü
();

113 
	`¡»¼Ü_r
(
”ºum
, 
buf
, (buf));

114 
	`¿dlog
(
L_ERROR
|
L_CONS
, "[rad_semop] WaitForSingleObject: "

115 "%d %s", 
”ºum
, 
buf
);

121 
	}
}

123 
	$¿d_£md–
(
£m_t
 
id
, 
rmid
)

125 
DWORD
 
”ºum
;

126 
buf
[256];

127 
HANDLE
 
h£m
 = (HANDLE)
id
;

129 if(!
	`Clo£HªdË
(
h£m
)) {

130 
”ºum
 = 
	`G‘La¡E¼Ü
();

131 
	`¡»¼Ü_r
(
”ºum
, 
buf
, (buf));

132 
	`¿dlog
(
L_ERROR
|
L_CONS
, "[¿d_£md–] Clo£HªdË: %d %s", 
”ºum
, 
buf
);

134 
	}
}

136 
shm_t
 
	$¿d_shmg‘
(
shm_key_t
 
key
, 
size_t
 
size
, 
æags
)

138 
DWORD
 
”ºum
;

139 
HANDLE
 
hshm
;

140 
key¡r
[9];

141 
buf
[256];

143 
	`¥rštf
(
key¡r
, "%08X", 
key
);

145 if(!(
æags
 & 
RADIPC_CREAT
)) {

146 
hshm
 = 
	`O³nFeM­pšg
(
FILE_MAP_WRITE
|
FILE_MAP_READ
,

147 
FALSE
, 
key¡r
);

148 
”ºum
 = 
	`G‘La¡E¼Ü
();

150 if(
hshm
 =ğ
NULL
) {

151 
	`¡»¼Ü_r
(
”ºum
, 
buf
, (buf));

152 
	`¿dlog
(
L_ERROR
|
L_CONS
, "[rad_shmget] OpenFileMapping(%s): "

153 "%d %s", 
key¡r
, 
”ºum
, 
buf
);

154  
NULL_SHM
;

157  (
shm_t
)
hshm
;

160 
hshm
 = 
	`C»©eFeM­pšg
(
INVALID_HANDLE_VALUE
,

161 
NULL
,

162 
PAGE_READWRITE
,

164 
size
,

165 
key¡r
);

166 
”ºum
 = 
	`G‘La¡E¼Ü
();

168 if(
hshm
 =ğ
NULL
) {

169 
	`¡»¼Ü_r
(
”ºum
, 
buf
, (buf));

170 
	`¿dlog
(
L_ERROR
|
L_CONS
, "[rad_shmget] CreateFileMapping(%s, %u, %d): "

171 "%d %s", 
key¡r
, 
size
, 
æags
, 
”ºum
, 
buf
);

172  
NULL_SHM
;

175 if(
”ºum
 =ğ
ERROR_ALREADY_EXISTS
 &&

176 (
æags
 & 
RADIPC_EXCL
)) {

177 
	`Clo£HªdË
(
hshm
);

178  
EXIST_SHM
;

181  (
shm_t
)
hshm
;

182 
	}
}

184 *
	$¿d_shm©
 (
shm_t
 
id
, 
æags
)

186 
DWORD
 
”ºum
;

187 
buf
[256];

188 
HANDLE
 
hshm
 = (HANDLE)
id
;

189 
LPVOID
 
·ddr
;

191 
·ddr
 = 
	`M­V›wOfFe
(
hshm
,

192 
æags
 & 
RADIPC_SHM_RDONLY
 ? 
FILE_MAP_READ
 : 
FILE_MAP_ALL_ACCESS
,

196 if(
·ddr
 =ğ
NULL
) {

197 
”ºum
 = 
	`G‘La¡E¼Ü
();

198 
	`¡»¼Ü_r
(
”ºum
, 
buf
, (buf));

199 
	`¿dlog
(
L_ERROR
|
L_CONS
, "[¿d_shm©] M­V›wOfFe: %d %s", 
”ºum
, 
buf
);

202  
·ddr
;

203 
	}
}

205 
	$¿d_shmdt
 (*
·ddr
)

207 
DWORD
 
”ºum
;

208 
buf
[256];

210 if(!
	`Unm­V›wOfFe
(
·ddr
)) {

211 
”ºum
 = 
	`G‘La¡E¼Ü
();

212 
	`¡»¼Ü_r
(
”ºum
, 
buf
, (buf));

213 
	`¿dlog
(
L_ERROR
|
L_CONS
, "[rad_shmdt] UnmapViewOfFile: "

214 "%d %s", 
”ºum
, 
buf
);

216 
	}
}

218 
	$¿d_shmd–
(
shm_t
 
id
, 
rmid
)

220 
DWORD
 
”ºum
;

221 
buf
[256];

222 
HANDLE
 
hshm
 = (HANDLE)
id
;

224 if(!
	`Clo£HªdË
(
hshm
)) {

225 
”ºum
 = 
	`G‘La¡E¼Ü
();

226 
	`¡»¼Ü_r
(
”ºum
, 
buf
, (buf));

227 
	`¿dlog
(
L_ERROR
|
L_CONS
, "[rad_shmdel] CloseHandle: "

228 "%d %s", 
”ºum
, 
buf
);

230 
	}
}

234 
£m_t
 
	$¿d_£mg‘
(
£m_key_t
 
key
, 
š™
, 
æags
)

236 
”ºum
;

237 
£m
;

238 
äesh
;

239 
	u£mun
 {

240 
v®
;

241 
£mid_ds
 *
buf
;

242 *
¬¿y
;

243 } 
¬g
;

245 if(
æags
 & 
RADIPC_CREAT
) {

246 
æags
 &ğ~
RADIPC_CREAT
;

247 
æags
 |ğ
IPC_CREAT
;

250 if(
æags
 & 
RADIPC_EXCL
) {

251 
æags
 &ğ~
RADIPC_EXCL
;

252 
æags
 |ğ
IPC_EXCL
;

255 if(!(
æags
 & 
IPC_CREAT
)) {

256 
£m
 = 
	`£mg‘
(
key
, 0, 
æags
);

257 if(
£m
 == -1) {

258 
	`¿dlog
(
L_ERROR
|
L_CONS
, "[rad_semget] semget(%08X): "

259 "%d %s", 
key
, 
”ºo
, 
	`¡»¼Ü
(errno));

260  
NULL_SEM
;

262  (
£m_t
)
£m
;

266 
£m
 = 
	`£mg‘
(
key
, 1, 
æags
|
IPC_CREAT
|
IPC_EXCL
);

267 
”ºum
 = 
”ºo
;

268 if(
£m
 =ğ-1 && 
”ºum
 !ğ
EEXIST
) {

269 
	`¿dlog
(
L_ERROR
|
L_CONS
, "[rad_semget] semget(%08X, %d, %d): "

270 "%d %s", 
key
, 
š™
, 
æags
, 
”ºum
, 
	`¡»¼Ü
(errnum));

271  
NULL_SEM
;

274 if(
£m
 =ğ-1 && 
”ºum
 =ğ
EEXIST
) {

275 
äesh
 = 0;

276 
£m
 = 
	`£mg‘
(
key
, 1, 
æags
);

277 
”ºum
 = 
”ºo
;

279 
äesh
 = 1;

280 
£m
 = sem;

281 
”ºum
 = 0;

284 if(
£m
 =ğ-1 && 
”ºum
 !ğ
EEXIST
) {

285 
	`¿dlog
(
L_ERROR
|
L_CONS
, "[rad_semget] semget(%08X, %d, %d): "

286 "%d %s", 
key
, 
š™
, 
æags
, 
”ºum
, 
	`¡»¼Ü
(errnum));

287  
NULL_SEM
;

290 if(
£m
 =ğ-1 && 
”ºum
 =ğ
EEXIST
) {

291  
EXIST_SEM
;

294 if(
äesh
) {

295 
¬g
.
v®
 = 
š™
;

296 if(
	`£mùl
(
£m
, 0, 
SETVAL
, 
¬g
) == -1) {

297 
	`¿dlog
(
L_ERROR
|
L_CONS
, "[rad_semget] semctl(%08X, %d, %d): "

298 "%d %s", 
key
, 
š™
, 
æags
, 
”ºo
, 
	`¡»¼Ü
(errno));

299 
	`¿d_£md–
(
£m
, 
äesh
);

300  
NULL_SEM
;

304  (
£m_t
)
£m
;

305 
	}
}

307 
	$¿d_£mİ
 (
£m_t
 
id
, 
İ
, 
m£c
)

309 
£mbuf
 
£m_b
;

310 
timev®
 
tv
, 
tv0
;

311 
–­£
 = 0;

312 
£m
 = ()
id
;

314 
	`¿d_as£¹
(
İ
 != 0);

315 if(
İ
 == 0)

318 
£m_b
.
£m_num
 = 0;

319 
£m_b
.
£m_İ
 = 
İ
;

320 
£m_b
.
£m_æg
 = 
SEM_UNDO
|
IPC_NOWAIT
;

322 if(
m£c
 =ğ
RADIPC_WAIT_INFINITE
) {

323 
£m_b
.
£m_æg
 &ğ~
IPC_NOWAIT
;

325 if(
	`£mİ
(
£m
, &
£m_b
, 1) == -1) {

326 
	`¿dlog
(
L_ERROR
|
L_CONS
, "[rad_semop] semop(%d): "

327 "%d %s", 
İ
, 
”ºo
, 
	`¡»¼Ü
(errno));

334 if(
m£c
 == 0) {

335 if(
	`£mİ
(
£m
, &
£m_b
, 1) == 0) {

337 } if(
”ºo
 =ğ
EAGAIN
) {

340 
	`¿dlog
(
L_ERROR
|
L_CONS
, "[rad_semop] semop(%d): "

341 "%d %s", 
İ
, 
”ºo
, 
	`¡»¼Ü
(errno));

346 if(
m£c
 > 0xFFFFFFFF/1000 ) {

347 
	`¿dlog
(
L_ERROR
|
L_CONS
, "[rad_semop] msec is overflow");

351 
m£c
 *= 1000;

352 
	`g‘timeofday
(&
tv0
, 
NULL
);

355 if(
	`£mİ
(
£m
, &
£m_b
, 1) == 0) {

359 if(
”ºo
 =ğ
EAGAIN
) {

360 
	`SË•
(1);

361 
	`g‘timeofday
(&
tv
, 
NULL
);

362 
–­£
 = (
tv
.
tv_£c
-
tv0
.tv_sec)*1000*1000 +

363 (
tv
.
tv_u£c
-
tv0
.tv_usec);

365 
	`¿dlog
(
L_ERROR
|
L_CONS
, "[rad_semop] semop(%d): "

366 "%d %s", 
İ
, 
”ºo
, 
	`¡»¼Ü
(errno));

369 } 
–­£
 < 
m£c
);

372 
	}
}

374 
	$¿d_£md–
(
£m_t
 
id
, 
rmid
)

376 
£m
 = ()
id
;

378 if(!
rmid
)

381 if(
	`£mùl
(
£m
, 0, 
IPC_RMID
) == -1) {

382 
	`¿dlog
(
L_ERROR
|
L_CONS
, "[rad_semdel] semctl: %d %s",

383 
”ºo
, 
	`¡»¼Ü
(errno));

385 
	}
}

387 
shm_t
 
	$¿d_shmg‘
(
shm_key_t
 
key
, 
size_t
 
size
, 
æags
)

389 
”ºum
;

390 
shm
;

392 if(
æags
 & 
RADIPC_CREAT
) {

393 
æags
 &ğ~
RADIPC_CREAT
;

394 
æags
 |ğ
IPC_CREAT
;

397 if(
æags
 & 
RADIPC_EXCL
) {

398 
æags
 &ğ~
RADIPC_EXCL
;

399 
æags
 |ğ
IPC_EXCL
;

402 if(!(
æags
 & 
IPC_CREAT
)) {

403 
shm
 = 
	`shmg‘
(
key
, 0, 
æags
);

404 if(
shm
 == -1) {

405 
	`¿dlog
(
L_ERROR
|
L_CONS
, "[rad_shmget] shmget(%08X): "

406 "%d %s", 
key
, 
”ºo
, 
	`¡»¼Ü
(errno));

407  
NULL_SHM
;

409  (
shm_t
)
shm
;

412 
shm
 = 
	`shmg‘
(
key
, 
size
, 
æags
);

413 
”ºum
 = 
”ºo
;

414 if(
shm
 =ğ-1 && 
”ºum
 !ğ
EEXIST
) {

415 
	`¿dlog
(
L_ERROR
|
L_CONS
, "[rad_shmget] shmget(%08X, %u, %d): "

416 "%d %s", 
key
, 
size
, 
æags
, 
”ºum
, 
	`¡»¼Ü
(errnum));

417  
NULL_SHM
;

420 if(
shm
 =ğ-1 && 
”ºum
 =ğ
EEXIST
) {

421  
EXIST_SHM
;

424  (
shm_t
)
shm
;

425 
	}
}

427 *
	$¿d_shm©
 (
shm_t
 
id
, 
æags
)

429 *
·ddr
;

430 
shm
 = ()
id
;

432 
·ddr
 = 
	`shm©
(
shm
, 
NULL
,

433 
æags
 & 
RADIPC_SHM_RDONLY
 ? 
SHM_RDONLY
 : 0);

434 if(()
·ddr
 == -1) {

435 
	`¿dlog
(
L_ERROR
|
L_CONS
, "[rad_shmat] shmat: %d %s",

436 
”ºo
, 
	`¡»¼Ü
(errno));

437 
·ddr
 = 
NULL
;

440  
·ddr
;

441 
	}
}

443 
	$¿d_shmdt
 (*
·ddr
)

445 if(
	`shmdt
(
·ddr
) == -1) {

446 
	`¿dlog
(
L_ERROR
|
L_CONS
, "[rad_shmdt] shmdt: %d %s",

447 
”ºo
, 
	`¡»¼Ü
(errno));

449 
	}
}

451 
	$¿d_shmd–
(
shm_t
 
id
, 
rmid
)

453 
shm
 = ()
id
;

455 if(!
rmid
)

458 if(
	`shmùl
(
shm
, 
IPC_RMID
, 
NULL
) == -1) {

459 
	`¿dlog
(
L_ERROR
|
L_CONS
, "[rad_shmdel] shmctl: %d %s",

460 
”ºo
, 
	`¡»¼Ü
(errno));

462 
	}
}

466 
	#QUEUE_DATABUF_SIZE
 8192

	)

468 
	s_QUEUE_DATA
 {

469 
size_t
 
	md©®’
;

470 
	md©abuf
[
QUEUE_DATABUF_SIZE
];

471 } 
	tQUEUE_DATA
;

473 
	s_QUEUE
 {

474 
Ìad_shiá_’Œy
 
	m’Œy
;

475 
QUEUE_DATA
 
	md©a
[0];

476 } 
	tQUEUE
;

478 
	s_QUEUE_NODE
 {

479 
	mty³
;

480 } 
	tQUEUE_NODE
;

482 
	s_QUEUE_MAP
 {

483 
size_t
 
	mq_maxsz
;

484 
size_t
 
	mqm_maxsz
;

485 
QUEUE_NODE
 
	mqs
[0];

486 } 
	tQUEUE_MAP
;

488 
	#QUEUE_MAP_MAXSIZE
 5

	)

489 
	#QUEUE_MAXSIZE
 100

	)

491 
	#QUEUE
(
qm
, 
i
, 
qm_maxsz
, 
q_maxsz
) \

492 ((
QUEUE
*)(((*)
qm
è+ 
	`vsizeof
(
QUEUE_MAP
, 
qs
, 
qm_maxsz
) + \

493 
i
 * 
	`vsizeof
(
QUEUE
, 
d©a
, 
q_maxsz
)))

	)

495 
msq_t
* 
	$¿d_msgg‘
(cÚ¡ 
msq_key_t
* 
key
, 
æags
)

497 
qm_maxsz
 = 0, 
q_maxsz
 = 0;

498 
size_t
 
shmsz
 = 0;

499 * 
p
;

500 
msq_t
* 
msq
;

501 
QUEUE_MAP
* 
qm
;

502 
£m_t
 
£m
;

503 
äesh
;

505 if(!(
æags
 & 
RADIPC_CREAT
)) {

506 
msq
 = (
msq_t
*)
	`¿d_m®loc
((msq_t));

507 
msq
->
£m
 = 
	`¿d_£mg‘
(
key
->
£mkey
, 0, 
æags
);

508 if(
msq
->
£m
 =ğ
NULL_SEM
) {

509 
	`¿d_ä“
(
msq
);

510  
NULL
;

512 
msq
->
shm
 = 
	`¿d_shmg‘
(
key
->
shmkey
, 0, 
æags
);

513 if(
msq
->
shm
 =ğ
NULL_SHM
) {

514 
	`¿d_£md–
(
msq
->
£m
, 0);

515 
	`¿d_ä“
(
msq
);

516  
NULL
;

518 
msq
->
±r
 = 
	`¿d_shm©
(msq->
shm
, 0);

519 if(!
msq
->
±r
) {

520 
	`¿d_shmd–
(
msq
->
shm
, 0);

521 
	`¿d_£md–
(
msq
->
£m
, 0);

522 
	`¿d_ä“
(
msq
);

523  
NULL
;

525  
msq
;

529 
£m
 = 
	`¿d_£mg‘
(
key
->
£mkey
, 1, 
æags
|
RADIPC_CREAT
|
RADIPC_EXCL
);

530 if(
£m
 =ğ
NULL_SEM
) {

531  
NULL
;

535 
msq
 = (
msq_t
*)
	`¿d_m®loc
((msq_t));

536 if(
£m
 =ğ
EXIST_SEM
) {

537 
äesh
 = 0;

538 
msq
->
£m
 = 
	`¿d_£mg‘
(
key
->
£mkey
, 1, 
æags
);

540 
äesh
 = 1;

541 
msq
->
£m
 = sem;

543 if(
msq
->
£m
 =ğ
NULL_SEM
 || msq->£m =ğ
EXIST_SEM
) {

544 
	`¿d_ä“
(
msq
);

545  
msq
->
£m
 =ğ
NULL_SEM
 ? 
NULL
 : 
EXIST_MSQ
;

548 if(
äesh
) {

550 
p
 = 
	`g‘’v
("QUEUE_MAP_MAXSIZE");

551 if(
p
)

552 
qm_maxsz
 = 
	`©oi
(
p
);

553 
p
 = 
	`g‘’v
("QUEUE_MAXSIZE");

554 if(
p
)

555 
q_maxsz
 = 
	`©oi
(
p
);

558 if(
qm_maxsz
 <= 0)

559 
qm_maxsz
 = 
QUEUE_MAP_MAXSIZE
;

560 if(
q_maxsz
 <= 0)

561 
q_maxsz
 = 
QUEUE_MAXSIZE
;

563 
	`DEBUG
("[¿d_msgg‘] queue_m­_maxsize(=%d)", 
qm_maxsz
);

564 
	`DEBUG
("[¿d_msgg‘] queue_maxsize(=%d)", 
q_maxsz
);

567 
shmsz
 = 
	`vsizeof
(
QUEUE_MAP
, 
qs
, 
qm_maxsz
) +

568 
qm_maxsz
 * 
	`vsizeof
(
QUEUE
, 
d©a
, 
q_maxsz
);

570 
	`DEBUG
("[rad_msgget]otal_shm_size(=%u) == vsizeof(QUEUE_MAP)(=%u) "

572 
shmsz
, 
	`vsizeof
(
QUEUE_MAP
, 
qs
, 
qm_maxsz
),

573 
qm_maxsz
, 
	`vsizeof
(
QUEUE
, 
d©a
, 
q_maxsz
));

575 
shmsz
 = 1;

578 
msq
->
shm
 = 
	`¿d_shmg‘
(
key
->
shmkey
, 
shmsz
, 
æags
);

579 if(
msq
->
shm
 =ğ
NULL_SHM
 || msq->shm =ğ
EXIST_SHM
) {

580 
	`¿d_£md–
(
msq
->
£m
, 
äesh
);

581 
	`¿d_ä“
(
msq
);

582  
NULL
;

584 
msq
->
±r
 = 
	`¿d_shm©
(msq->
shm
, 0);

585 if(!
msq
->
±r
) {

586 
	`¿d_shmd–
(
msq
->
shm
, 
äesh
);

587 
	`¿d_£md–
(
msq
->
£m
, 
äesh
);

588 
	`¿d_ä“
(
msq
);

589  
NULL
;

593 if(
äesh
) {

594 
qm
 = (
QUEUE_MAP
*)
msq
->
±r
;

595 
	`mem£t
(
qm
, 0, 
shmsz
);

596 
qm
->
qm_maxsz
 = qm_maxsz;

597 
qm
->
q_maxsz
 = q_maxsz;

600  
msq
;

601 
	}
}

603 
	$¿d_msg¢d
(cÚ¡ 
msq_t
* 
msqid
,

604 cÚ¡ *
msg_±r
, 
size_t
 
msg_size
, 
msg_ty³
)

606 
QUEUE
* 
q
;

607 
QUEUE_MAP
* 
qm
;

608 
size_t
 
i
, 
Ën
, 
n
;

610 
	`¿d_as£¹
(
msg_ty³
 > 0);

611 
	`¿d_as£¹
(
msg_size
 !ğ0 && msg_siz<ğ
QUEUE_DATABUF_SIZE
);

612 if(
msg_ty³
 <= 0 ) {

613 
	`¿dlog
(
L_ERROR
|
L_CONS
, "[¿d_msg¢d] msg_ty³(=%ldè< 0", 
msg_ty³
);

616 if(
msg_size
 =ğ0 || msg_siz> 
QUEUE_DATABUF_SIZE
) {

617 
	`¿dlog
(
L_ERROR
|
L_CONS
, "[rad_msgsnd] msg_size(=%u) > %u or == 0",

618 
msg_size
, 
QUEUE_DATABUF_SIZE
);

622 
qm
 = (
QUEUE_MAP
*)
msqid
->
±r
;

623 if(
	`¿d_£mİ
(
msqid
->
£m
, -1, 
RADIPC_WAIT_INFINITE
) != 0)

626 
i
=0; i<
qm
->
qm_maxsz
; ++i)

627 if(
qm
->
qs
[
i
].
ty³
 =ğ
msg_ty³
)

630 if(
i
 =ğ
qm
->
qm_maxsz
)

631 
i
=0; i<
qm
->
qm_maxsz
; ++i)

632 if(
qm
->
qs
[
i
].
ty³
 == 0) {

633 
qm
->
qs
[
i
].
ty³
 = 
msg_ty³
;

637 if(
i
 =ğ
qm
->
qm_maxsz
) {

638 
	`¿dlog
(
L_ERROR
|
L_CONS
, "[rad_msgsnd] queue_map full, "

639 "msg_ty³(=%ldèÿÀnÙ b£Á", 
msg_ty³
);

640 
	`¿d_v”ify
(
	`¿d_£mİ
(
msqid
->
£m
, 1, 
RADIPC_WAIT_INFINITE
) == 0);

644 
q
 = 
	`QUEUE
(
qm
, 
i
, qm->
qm_maxsz
, qm->
q_maxsz
);

645 
Ën
 = 
	`LRAD_SHIFT_LENGTH
(
q
->
’Œy
.
ä
, q->’Œy.
to
, 
qm
->
q_maxsz
);

646 if(
Ën
 =ğ
qm
->
q_maxsz
) {

647 
	`¿dlog
(
L_ERROR
|
L_CONS
, "[¿d_msg¢d] queueÑy³=%ldèfuÎ", 
msg_ty³
);

648 
	`¿d_v”ify
(
	`¿d_£mİ
(
msqid
->
£m
, 1, 
RADIPC_WAIT_INFINITE
) == 0);

652 
n
 = 
	`Ìad_shiá_g‘_push_back_šdex
(&
q
->
’Œy
.
ä
, &q->’Œy.
to
, 
qm
->
q_maxsz
);

653 
q
->
d©a
[
n
].
d©®’
 = 
msg_size
;

654 
	`memıy
(
q
->
d©a
[
n
].
d©abuf
, 
msg_±r
, 
msg_size
);

656 
	`¿d_v”ify
(
	`¿d_£mİ
(
msqid
->
£m
, 1, 
RADIPC_WAIT_INFINITE
) == 0);

658 
	}
}

660 
	$¿d_msgrcv
(cÚ¡ 
msq_t
* 
msqid
,

661 *
msg_±r
, 
size_t
 
msg_size
, 
msg_ty³
)

663 
QUEUE
* 
q
;

664 
QUEUE_MAP
* 
qm
;

665 
size_t
 
i
, 
n
, 
Ën
;

666 
ä
, 
to
;

668 
qm
 = (
QUEUE_MAP
*)
msqid
->
±r
;

669 if(
	`¿d_£mİ
(
msqid
->
£m
, -1, 
RADIPC_WAIT_INFINITE
) != 0)

672 if(
msg_ty³
 > 0) {

673 
i
=0; i<
qm
->
qm_maxsz
; ++i)

674 if(
qm
->
qs
[
i
].
ty³
 =ğ
msg_ty³
)

676 } if(
msg_ty³
 < 0) {

677 
i
=0; i<
qm
->
qm_maxsz
; ++i)

678 if(
qm
->
qs
[
i
].
ty³
 > 0 && qm->qs[i].ty³ <ğ0-
msg_ty³
)

681 
i
=0; i<
qm
->
qm_maxsz
; ++i)

682 if(
qm
->
qs
[
i
].
ty³
 != 0)

686 if(
i
 =ğ
qm
->
qm_maxsz
) {

687 
	`¿d_v”ify
(
	`¿d_£mİ
(
msqid
->
£m
, 1, 
RADIPC_WAIT_INFINITE
) == 0);

691 
q
 = 
	`QUEUE
(
qm
, 
i
, qm->
qm_maxsz
, qm->
q_maxsz
);

692 
ä
 = 
q
->
’Œy
.ä, 
to
 = q->entry.to;

693 
n
 = 
	`Ìad_shiá_g‘_pİ_äÚt_šdex
(&
q
->
’Œy
.
ä
, &q->’Œy.
to
, 
qm
->
q_maxsz
);

694 
	`¿d_as£¹
(
n
 !ğ
LRAD_SHIFT_TOINFI
);

695 if(
n
 =ğ
LRAD_SHIFT_TOINFI
) {

696 
	`¿d_v”ify
(
	`¿d_£mİ
(
msqid
->
£m
, 1, 
RADIPC_WAIT_INFINITE
) == 0);

700 if(
msg_size
 < 
q
->
d©a
[
n
].
d©®’
) {

701 
	`¿dlog
(
L_ERROR
|
L_CONS
, "[rad_msgrcv] msg_size(=%u) < %u",

702 
msg_size
, 
q
->
d©a
[
n
].
d©®’
);

703 
q
->
’Œy
.
ä
 = fr, q->’Œy.
to
 =o;

704 
	`¿d_v”ify
(
	`¿d_£mİ
(
msqid
->
£m
, 1, 
RADIPC_WAIT_INFINITE
) == 0);

707 
	`memıy
(
msg_±r
, 
q
->
d©a
[
n
].
d©abuf
, q->d©a[n].
d©®’
);

709 
Ën
 = 
	`LRAD_SHIFT_LENGTH
(
q
->
’Œy
.
ä
, q->’Œy.
to
, 
qm
->
q_maxsz
);

710 if(
Ën
 == 0)

711 
qm
->
qs
[
i
].
ty³
 = 0;

713 
	`¿d_v”ify
(
	`¿d_£mİ
(
msqid
->
£m
, 1, 
RADIPC_WAIT_INFINITE
) == 0);

714  
q
->
d©a
[
n
].
d©®’
;

715 
	}
}

717 
	$¿d_msgd–
(
msq_t
** 
pmsqid
, 
rmid
)

719 
msq_t
* 
msq
 = *
pmsqid
;

721 if(!
msq
)

724 
	`¿d_shmdt
(
msq
->
±r
);

725 
	`¿d_shmd–
(
msq
->
shm
, 
rmid
);

726 
	`¿d_£md–
(
msq
->
£m
, 
rmid
);

727 
	`¿d_ä“
(
msq
);

729 *
pmsqid
 = 
NULL
;

730 
	}
}

732 
	$¿d_msgdmp
(cÚ¡ 
msq_t
* 
msqid
)

734 
QUEUE
* 
q
;

735 
QUEUE_MAP
* 
qm
;

736 
size_t
 
i
, 
Ën
;

738 
qm
 = (
QUEUE_MAP
*)
msqid
->
±r
;

739 if(
	`¿d_£mİ
(
msqid
->
£m
, -1, 
RADIPC_WAIT_INFINITE
) != 0)

742 
i
=0; i<
qm
->
qm_maxsz
; ++i) {

743 
q
 = 
	`QUEUE
(
qm
, 
i
, qm->
qm_maxsz
, qm->
q_maxsz
);

744 
Ën
 = 
	`LRAD_SHIFT_LENGTH
(
q
->
’Œy
.
ä
, q->’Œy.
to
, 
qm
->
q_maxsz
);

745 
	`´štf
("QUEUE[%u]ype=%ld cnt/max=%u/%u\n",

746 
i
, 
qm
->
qs
[i].
ty³
, 
Ën
, qm->
q_maxsz
);

749 
	`¿d_v”ify
(
	`¿d_£mİ
(
msqid
->
£m
, 1, 
RADIPC_WAIT_INFINITE
) == 0);

750 
	}
}

	@radutil/radipc.h

10 #iâdeà
__RAD_IPC_H__


11 
	#__RAD_IPC_H__


	)

13 #ifdeà
__ılu¥lus


17 
	#RADIPC_CREAT
 01000

	)

18 
	#RADIPC_EXCL
 02000

	)

20 
	t£m_key_t
;

21 
	t£m_t
;

22 
	#NULL_SEM
 ((
£m_t
)-1)

	)

23 
	#EXIST_SEM
 ((
£m_t
)-2)

	)

24 
	#RADIPC_WAIT_INFINITE
 0xFFFFFFFF

	)

26 
£m_t
 
¿d_£mg‘
(
£m_key_t
 
key
, 
š™
, 
æags
);

27 
¿d_£mİ
 (
£m_t
 
id
, 
İ
, 
m£c
);

28 
¿d_£md–
(
£m_t
 
id
, 
rmid
);

30 
	tshm_key_t
;

31 
	tshm_t
;

32 
	#NULL_SHM
 ((
shm_t
)-1)

	)

33 
	#EXIST_SHM
 ((
shm_t
)-2)

	)

34 
	#RADIPC_SHM_RDONLY
 010000

	)

36 
shm_t
 
¿d_shmg‘
(
shm_key_t
 
key
, 
size_t
 
size
, 
æags
);

37 *
¿d_shm©
 (
shm_t
 
id
, 
æags
);

38 
¿d_shmdt
 (*
·ddr
);

39 
¿d_shmd–
(
shm_t
 
id
, 
rmid
);

41 
	s_msq_key_t
 {

42 
£m_key_t
 
£mkey
;

43 
shm_key_t
 
shmkey
;

44 } 
	tmsq_key_t
;

46 
	s_msq_t
 {

47 
£m_t
 
£m
;

48 
shm_t
 
shm
;

49 *
±r
;

50 } 
	tmsq_t
;

52 
	#EXIST_MSQ
 ((
msq_t
*)0xFFFFFFFF)

	)

54 
msq_t
* 
¿d_msgg‘
(cÚ¡ 
msq_key_t
* 
key
, 
æags
);

55 
¿d_msg¢d
(cÚ¡ 
msq_t
* 
msqid
,

56 cÚ¡ *
msg_±r
, 
size_t
 
msg_size
, 
msg_ty³
);

57 
¿d_msgrcv
(cÚ¡ 
msq_t
* 
msqid
,

58 *
msg_±r
, 
size_t
 
msg_size
, 
msg_ty³
);

59 
¿d_msgd–
(
msq_t
** 
pmsqid
, 
rmid
);

61 
¿d_msgdmp
(cÚ¡ 
msq_t
* 
msqid
);

63 #ifdeà
__ılu¥lus


	@radutil/radlog.c

1 
	~"¿dut.h
"

2 
	~<sys/¡©.h
>

3 
	~<time.h
>

4 
	~<¡ršg.h
>

5 
	~<¡dio.h
>

6 
	~<¡d¬g.h
>

7 
	~<”ºo.h
>

8 #ià
defšed
(
RAD_OS_UNIX
è|| defšed(
RAD_OS_LINUX
)

9 
	~<sy¦og.h
>

10 
	#HAVE_SYSLOG_H


	)

12 #ià
defšed
(
RAD_VC
)

13 
	~<wšsock2.h
>

15 
	~<sys/time.h
>

17 
	#HAVE_VSNPRINTF


	)

19 
	g¿dlog_debug_æag
 = 1;

20 
¿dlog_de¡_t
 
	g¿dlog_de¡
 = 
RADLOG_STDOUT
;

21 
	g¿dlog_dœ
 [1024] = "";

22 
	g¿dlog_fe
 [1024] = "rad.log";

23 
	g¿dlog_´ogÇme
 [256] = "radlog";

24 
	g¿dlog_Ëv–_hŞd
 = 0;

25 
	g¿dlog_´št_mli£c
 = 0;

30 
LRAD_NAME_NUMBER
 
	gËv–s
[] = {

31 { " TRACE ", 
L_TRACE
 },

32 { " DEBUG ", 
L_DEBUG
 },

33 { " INFO ", 
L_INFO
 },

34 { " WARN ", 
L_WARN
 },

35 { " ERROR ", 
L_ERROR
 },

36 { " FATAL ", 
L_FATAL
 },

37 { 
NULL
, 0 }

43 
	$¿dlog_£t_logfe
(cÚ¡ * 
f’ame
)

45 
Çmebuf
[1024];

46 * 
dœ£p
;

47 * 
dœ
 = 
Çmebuf
;

49 if(
f’ame
 =ğ
NULL
)

53 
	`¡ºıy
(
Çmebuf
, 
f’ame
, (namebuf));

54 
Çmebuf
[(namebuf) - 1] = '\0';

56 (
dœ£p
 = 
	`¡rchr
(
dœ
, '/')è!ğ
NULL
) {

57 *
dœ£p
 = '\0';

58 
	`mkdœ
(
Çmebuf
, 
S_IRWXU
|
S_IRGRP
|
S_IXGRP
|
S_IROTH
|
S_IXOTH
);

59 *
dœ£p
 = '/';

60 
dœ
 = 
dœ£p
 + 1;

63 
dœ£p
 = 
	`¡¼chr
(
Çmebuf
, '/');

64 if(
dœ£p
 !ğ
NULL
) {

65 *
dœ£p
 = '\0';

66 
	`¡ºıy
(
¿dlog_dœ
, 
Çmebuf
, (radlog_dir));

67 
¿dlog_dœ
[(radlog_dir) - 1] = '\0';

68 *
dœ£p
 = '/';

72 
	`¡ºıy
(
¿dlog_fe
, 
f’ame
, (radlog_file));

73 
¿dlog_fe
[(radlog_file) - 1] = '\0';

74 
	}
}

76 
	$cÚv”t_logf’ame
(cÚ¡ * 
Üigš
, * 
cÚv”‹d
, 
size_t
 
Çm–’
)

78 * 
p
;

79 
Ën
;

80 
tm
 
m
;

81 
time_t
 
now
;

83 
Ën
 = 
	`¡¾’
(
Üigš
);

84 if(
Çm–’
 < (
size_t
)
Ën
+10)

85 
ÿÂÙ_cÚv”t
;

87 
now
 = 
	`time
(
NULL
);

88 if(
now
 =ğ(
time_t
)-1)

89 
ÿÂÙ_cÚv”t
;

91 
	`loÿÉime_r
(&
now
, &
m
);

93 
p
 = 
	`¡¼chr
(
Üigš
, '.');

94 if(
p
 =ğ
NULL
) {

95 
	`¥rštf
(
cÚv”‹d
, "%s.%04d%02d%02d",

96 
Üigš
, 
m
.
tm_y—r
+1900, m.
tm_mÚ
+1, m.
tm_mday
);

98 
Ën
 = 
p
 - 
Üigš
;

99 
	`memıy
(
cÚv”‹d
, 
Üigš
, 
Ën
);

100 
	`¥rštf
(
cÚv”‹d
+
Ën
, ".%04d%02d%02d",

101 
m
.
tm_y—r
+1900, m.
tm_mÚ
+1, m.
tm_mday
);

102 
	`¡rÿt
(
cÚv”‹d
, 
p
);

107 
ÿÂÙ_cÚv”t
:

108 
	`¡ºıy
(
cÚv”‹d
, 
Üigš
, 
Çm–’
);

109 
cÚv”‹d
[
Çm–’
-1] = '\0';

110 
	}
}

116 
	$v¿dlog
(
lvl
, cÚ¡ *
fmt
, 
va_li¡
 
­
)

118 
FILE
 *
msgfd
 = 
NULL
;

119 *
p
;

120 
bufãr
[8192];

121 
Çmebuf
[1024];

122 
Ën
, 
Ën0
;

127 if(
¿dlog_Ëv–_hŞd
 > (
lvl
 & ~
L_CONS
)) {

136 ià((
¿dlog_debug_æag
 =ğ0è&& ((
lvl
 & ~
L_CONS
è<ğ
L_DEBUG
)) {

144 ià(
¿dlog_de¡
 =ğ
RADLOG_NULL
) {

148 ià(
¿dlog_de¡
 =ğ
RADLOG_STDOUT
) {

149 
msgfd
 = 
¡dout
;

151 } ià(
¿dlog_de¡
 =ğ
RADLOG_STDERR
) {

152 
msgfd
 = 
¡d”r
;

154 } ià(
¿dlog_de¡
 !ğ
RADLOG_SYSLOG
) {

158 ià(
¿dlog_fe
[0] == '\0') {

159 
msgfd
 = 
¡dout
;

165 
	`cÚv”t_logf’ame
(
¿dlog_fe
, 
Çmebuf
, (namebuf));

167 ià((
msgfd
 = 
	`fİ’
(
Çmebuf
, "a+")è=ğ
NULL
) {

168 
	`årštf
(
¡d”r
, "%s: Couldn't open %s for†ogging: %s\n",

169 
¿dlog_´ogÇme
, 
Çmebuf
, 
	`¡»¼Ü
(
”ºo
));

171 
	`årštf
(
¡d”r
, " (");

172 
	`vårštf
(
¡d”r
, 
fmt
, 
­
);

173 
	`årštf
(
¡d”r
, ")\n");

179 #ifdeà
HAVE_SYSLOG_H


180 ià(
¿dlog_de¡
 =ğ
RADLOG_SYSLOG
) {

181 *
bufãr
 = '\0';

182 
Ën0
 = 0;

183 
Ën
 = 0;

187 if(
¿dlog_´št_mli£c
)

189 cÚ¡ * 
s
;

190 
timev®
 
tv
;

191 
tm
 
loÿl
;

192 
deævl
[8];

194 
	`g‘timeofday
(&
tv
, 
NULL
);

195 
	`loÿÉime_r
(&
tv
.
tv_£c
, &
loÿl
);

197 
	`¥rštf
(
bufãr
, "%04d/%02d/%02d %02d:%02d:%02d,%03ld",

198 
loÿl
.
tm_y—r
+1900,†oÿl.
tm_mÚ
+1,†oÿl.
tm_mday
,

199 
loÿl
.
tm_hour
,†oÿl.
tm_mš
,†oÿl.
tm_£c
,

200 
tv
.
tv_u£c
/1000);

202 
	`¥rštf
(
deævl
, " L%04X ", (
lvl
 & ~
L_CONS
));

203 
s
 = 
	`Ìad_št2¡r
(
Ëv–s
, (
lvl
 & ~
L_CONS
), 
deævl
);

205 
Ën0
 = 
	`¡¾’
(
bufãr
);

206 
	`¡rÿt
(
bufãr
, 
s
);

207 
Ën
 = 
	`¡¾’
(
bufãr
);

211 cÚ¡ *
s
;

212 
time_t
 
tv
;

213 
tm
 
loÿl
;

214 
deævl
[8];

216 
tv
 = 
	`time
(
NULL
);

217 
	`loÿÉime_r
(&
tv
, &
loÿl
);

218 
	`¥rštf
(
bufãr
, "%04d/%02d/%02d %02d:%02d:%02d",

219 
loÿl
.
tm_y—r
+1900,†oÿl.
tm_mÚ
+1,†oÿl.
tm_mday
,

220 
loÿl
.
tm_hour
,†oÿl.
tm_mš
,†oÿl.
tm_£c
);

222 
	`¥rštf
(
deævl
, " L%04X ", (
lvl
 & ~
L_CONS
));

223 
s
 = 
	`Ìad_št2¡r
(
Ëv–s
, (
lvl
 & ~
L_CONS
), 
deævl
);

225 
Ën0
 = 
	`¡¾’
(
bufãr
);

226 
	`¡rÿt
(
bufãr
, 
s
);

227 
Ën
 = 
	`¡¾’
(
bufãr
);

230 #ifdeà
HAVE_VSNPRINTF


231 
	`v¢´štf
(
bufãr
 + 
Ën
, (bufãrè-†’ - 1, 
fmt
, 
­
);

232 
bufãr
[(buffer) - 2] = '\0';

234 
	`v¥rštf
(
bufãr
 + 
Ën
, 
fmt
, 
­
);

235 ià(
	`¡¾’
(
bufãr
) >= (buffer) - 1) {

236 
	`årštf
(
¡d”r
, "%s: Too†ong is†og message of %d\n",

237 
¿dlog_´ogÇme
, (
bufãr
));

240 
	`abÜt
();

247 
p
 = (*)
bufãr
; *p != '\0';…++) {

248 ià(*
p
 == '\r' || *p == '\n')

249 *
p
 = ' ';

250 ià(*
p
 < 32 || (*p >= 128 && *p <= 160))

251 *
p
 = '?';

253 
	`¡rÿt
(
bufãr
, "\n");

259 ià(
¿dlog_debug_æag
 == 1) {

260 
p
 = 
bufãr
 + 
Ën0
;

267 
p
 = 
bufãr
;

270 #ifdeà
HAVE_SYSLOG_H


271 ià(
¿dlog_de¡
 !ğ
RADLOG_SYSLOG
)

274 
	`åuts
(
p
, 
msgfd
);

275 ià(
msgfd
 =ğ
¡dout
) {

276 
	`fæush
(
¡dout
);

277 } ià(
msgfd
 =ğ
¡d”r
) {

278 
	`fæush
(
¡d”r
);

280 
	`fşo£
(
msgfd
);

282 if(
lvl
 & 
L_CONS
) {

283 if((
lvl
 & ~
L_CONS
è< 
L_WARN
) {

284 
	`åuts
(
p
, 
¡dout
);

285 
	`fæush
(
¡dout
);

287 
	`åuts
(
p
, 
¡d”r
);

288 
	`fæush
(
¡d”r
);

294 } if(
¿dlog_debug_æag
) {

295 if((
lvl
 & ~
L_CONS
è< 
L_WARN
) {

296 
	`åuts
(
p
, 
¡dout
);

298 
	`åuts
(
p
, 
¡d”r
);

303 #ifdeà
HAVE_SYSLOG_H


305 
lvl
 = (lvÈ& ~
L_CONS
);

307 if(
lvl
 > 0 &&†vÈ<ğ
L_DEBUG
) {

308 
lvl
 = 
LOG_DEBUG
;

310 } if(
lvl
 > 
L_DEBUG
 &&†vÈ<ğ
L_INFO
) {

311 
lvl
 = 
LOG_NOTICE
;

313 } if(
lvl
 > 
L_INFO
 &&†vÈ<ğ
L_WARN
) {

314 
lvl
 = 
LOG_WARNING
;

316 } if(
lvl
 > 
L_WARN
 &&†vÈ<ğ
L_ERROR
) {

317 
lvl
 = 
LOG_ERR
;

319 } if(
lvl
 > 
L_ERROR
 &&†vÈ<ğ
L_FATAL
) {

320 
lvl
 = 
LOG_CRIT
;

322 } if(
lvl
 > 
L_FATAL
) {

323 
lvl
 = 
LOG_ALERT
;

326 
lvl
 = 
LOG_EMERG
;

330 
	`sy¦og
(
lvl
, "%s", 
bufãr
 + 
Ën0
);

335 
	}
}

337 
	$¿dlog_debug
(cÚ¡ *
msg
, ...)

339 
va_li¡
 
­
;

340 
r
;

342 
	`va_¡¬t
(
­
, 
msg
);

343 
r
 = 
	`v¿dlog
(
L_DEBUG
, 
msg
, 
­
);

344 
	`va_’d
(
­
);

346  
r
;

347 
	}
}

349 
	$¿dlog_Œaû
(cÚ¡ *
msg
, ...)

351 
va_li¡
 
­
;

352 
r
;

354 
	`va_¡¬t
(
­
, 
msg
);

355 
r
 = 
	`v¿dlog
(
L_TRACE
, 
msg
, 
­
);

356 
	`va_’d
(
­
);

358  
r
;

359 
	}
}

361 
	$¿dlog
(
lvl
, cÚ¡ *
msg
, ...)

363 
va_li¡
 
­
;

364 
r
;

366 
	`va_¡¬t
(
­
, 
msg
);

367 
r
 = 
	`v¿dlog
(
lvl
, 
msg
, 
­
);

368 
	`va_’d
(
­
);

370  
r
;

371 
	}
}

	@radutil/radlog.h

10 #iâdeà
__RAD_LOG_H__


11 
	#__RAD_LOG_H__


	)

13 
	~<¿dut/¿dmaüos.h
>

15 #ifdeà
__ılu¥lus


19 
	#L_TRACE
 512

	)

20 
	#L_DEBUG
 1024

	)

21 
	#L_INFO
 2048

	)

22 
	#L_WARN
 4096

	)

23 
	#L_ERROR
 8192

	)

24 
	#L_FATAL
 16384

	)

25 
	#L_CONS
 32768

	)

27 
	e_¿dlog_de¡_t
 {

28 
RADLOG_FILES
 = 0,

29 
RADLOG_SYSLOG
,

30 
RADLOG_STDOUT
,

31 
RADLOG_STDERR
,

32 
RADLOG_NULL


33 } 
	t¿dlog_de¡_t
;

39 
¿dlog
(
lvl
, cÚ¡ *
msg
, ...);

40 
¿dlog_debug
(cÚ¡ *
msg
, ...);

41 
¿dlog_Œaû
(cÚ¡ *
msg
, ...);

43 
¿dlog_£t_logfe
(cÚ¡ * 
f’ame
);

58 
	#DEBUG
 (
¿dlog_debug_æag
 == 0) ? \

59 ()0 : 
¿dlog_debug


	)

60 
	#DEBUG2
 (
¿dlog_debug_æag
 >= 0 &&„adlog_debug_flag <= 1) ? \

61 ()0 : 
¿dlog_debug


	)

62 
	#DEBUG3
 (
¿dlog_debug_æag
 >= 0 &&„adlog_debug_flag <= 2) ? \

63 ()0 : 
¿dlog_debug


	)

64 
	#DEBUG4
 (
¿dlog_debug_æag
 >= 0 &&„adlog_debug_flag <= 3) ? \

65 ()0 : 
¿dlog_debug


	)

66 
	#DEBUG5
 (
¿dlog_debug_æag
 >= 0 &&„adlog_debug_flag <= 4) ? \

67 ()0 : 
¿dlog_debug


	)

69 
	#TRACE
 (
¿dlog_debug_æag
 >= -1) ? \

70 ()0 : 
¿dlog_Œaû


	)

71 
	#TRACE2
 (
¿dlog_debug_æag
 >= -2) ? \

72 ()0 : 
¿dlog_Œaû


	)

73 
	#TRACE3
 (
¿dlog_debug_æag
 >= -3) ? \

74 ()0 : 
¿dlog_Œaû


	)

75 
	#TRACE4
 (
¿dlog_debug_æag
 >= -4) ? \

76 ()0 : 
¿dlog_Œaû


	)

77 
	#TRACE5
 (
¿dlog_debug_æag
 >= -5) ? \

78 ()0 : 
¿dlog_Œaû


	)

80 #ifdeà
__ılu¥lus


87 
RAD_EXTERN_C
 
¿dlog_debug_æag
;

88 
RAD_EXTERN_C
 
¿dlog_de¡_t
 
	g¿dlog_de¡
;

89 
RAD_EXTERN_C
 
	g¿dlog_dœ
 [1024];

90 
RAD_EXTERN_C
 
	g¿dlog_fe
 [1024];

91 
RAD_EXTERN_C
 
	g¿dlog_´ogÇme
 [256];

92 
RAD_EXTERN_C
 
	g¿dlog_Ëv–_hŞd
;

93 
RAD_EXTERN_C
 
	g¿dlog_´št_mli£c
;

	@radutil/radmacros.h

8 #iâdeà
__RAD_MACROS_H__


9 
	#__RAD_MACROS_H__


	)

11 #ifdeà
__ılu¥lus


20 #iâdeà
NULL


21 #ifdeà
__ılu¥lus


22 
	#NULL
 (0L)

	)

24 
	#NULL
 ((*è0)

	)

38 #ià
defšed
(
RAD_NO_THREAD
)

39 
	#¿d_lock_t
 

	)

40 
	#¿d_lock_š™
(
¶ock
è(()0)

	)

41 
	#¿d_lock_acquœe
(
¶ock
è(()0)

	)

42 
	#¿d_lock_»Ëa£
(
¶ock
è(()0)

	)

43 
	#¿d_lock_de¡roy
(
¶ock
è(()0)

	)

44 #–ià
defšed
(
RAD_OS_WIN32
)

45 
	#¿d_lock_t
 
CRITICAL_SECTION


	)

46 
	#¿d_lock_š™
(
¶ock
è
	`In™ŸlizeCr™iÿlSeùiÚ
Õlock)

	)

47 
	#¿d_lock_acquœe
(
¶ock
è
	`EÁ”Cr™iÿlSeùiÚ
Õlock)

	)

48 
	#¿d_lock_»Ëa£
(
¶ock
è
	`L—veCr™iÿlSeùiÚ
Õlock)

	)

49 
	#¿d_lock_de¡roy
(
¶ock
è
	`D–‘eCr™iÿlSeùiÚ
Õlock)

	)

51 
	#¿d_lock_t
 
±h»ad_mu‹x_t


	)

52 
	#¿d_lock_š™
(
¶ock
è
	`¿d_v”ify
(
	`±h»ad_mu‹x_š™
Õlock, 
NULL
è=ğ0)

	)

53 
	#¿d_lock_acquœe
(
¶ock
è
	`¿d_v”ify
(
	`±h»ad_mu‹x_lock
Õlockè=ğ0)

	)

54 
	#¿d_lock_»Ëa£
(
¶ock
è
	`¿d_v”ify
(
	`±h»ad_mu‹x_uÆock
Õlockè=ğ0)

	)

55 
	#¿d_lock_de¡roy
(
¶ock
è
	`¿d_v”ify
(
	`±h»ad_mu‹x_de¡roy
Õlockè=ğ0)

	)

58 #ià
defšed
(
RAD_OS_WIN32
)

59 #ià
defšed
(
RAD_COMPILER_VC
)

66 #ià
defšed
 (
RAD_DLL
è&& defšed(
RAD_STATIC
)

68 #–ià
defšed
(
RAD_DLL
)

69 
	#RAD_SYMBOL
 
	`__deş¥ec
(
dÎexpÜt
)

	)

70 #–ià!
defšed
(
RAD_STATIC
)

71 
	#RAD_SYMBOL
 
	`__deş¥ec
(
dÎimpÜt
)

	)

72 #–ià
defšed
(
RAD_STATIC
)

73 
	#RAD_SYMBOL


	)

79 #´agm¨
w¬nšg
Ğ
di§bË
 : 4275 )

81 
	#RAD_SYMBOL


	)

84 
	#RAD_SYMBOL


	)

88 #ià
defšed
(
__ılu¥lus
è&& defšed(
RAD_COMPILER_VC6
)

89 if(0); 

	)

90 #´agm¨
w¬nšg
Ğ
di§bË
 : 4786 )

91 #´agm¨
w¬nšg
Ğ
di§bË
 : 4503 )

95 
	#¡rsıy
(
x
,
y
èdØ{ 
	`¡ºıy
(x,y,(x)); x[(x)-1]=0; } 0)

	)

99 
	#ba£±rof
(
p
, 
»cÜd_ty³
, 
memb”_Çme
) \

100 ((
»cÜd_ty³
*)(((*)(
p
)è- 
	`off£tof
ÔecÜd_ty³, 
memb”_Çme
)))

	)

103 
	#dimof
(
a
è(×)/×[0]))

	)

106 
	#vsizeof
(
»cÜd_ty³
, 
memb”_Çme
, 
maxsize
) \

107 ((
»cÜd_ty³
è+ ((ÔecÜd_ty³*)0)->
memb”_Çme
[0]è* 
maxsize
)

	)

109 #ifdeà
__ılu¥lus


113 #ifdeà
__ılu¥lus


114 
	#RAD_EXTERN_C
 "C"

	)

116 
	#RAD_EXTERN_C
 

	)

	@radutil/radplatform.h

8 #iâdeà
__RAD_PLATFORM_H__


9 
	#__RAD_PLATFORM_H__


	)

11 #ifdeà
__ılu¥lus


16 #ià
defšed
(
_WIN32
è|| defšed(
__WIN32__
è|| defšed(
WIN32
)

17 
	#RAD_OS_WIN32


	)

18 
	#RAD_OS
 0

	)

19 #–ià
defšed
(
lšux
è|| defšed(
__lšux
è|| defšed(
__lšux__
)

20 
	#RAD_OS_LINUX


	)

21 
	#RAD_OS
 -1

	)

23 
	#RAD_OS_UNIX


	)

24 
	#RAD_OS
 1

	)

29 
	#_REENTRANT


	)

32 #ià
defšed
(
_MSC_VER
)

33 
	#RAD_COMPILER_VC


	)

34 
	#RAD_COMPILER
 0

	)

35 #ià 
_MSC_VER
 == 1200

36 
	#RAD_COMPILER_VC6


	)

37 #–ià
_MSC_VER
 == 1300

38 
	#RAD_COMPILER_VC7


	)

39 #–ià
_MSC_VER
 == 1310

40 
	#RAD_COMPILER_VC71


	)

42 #–ià
defšed
(
__GNUC__
)

43 
	#RAD_COMPILER_GCC


	)

44 
	#RAD_COMPILER
 1

	)

45 #ià 
__GNUC__
 == 2

46 
	#RAD_COMPILER_GCC2


	)

47 #–ià
__GNUC__
 == 3

48 
	#RAD_COMPILER_GCC3


	)

49 #–ià
__GNUC__
 == 4

50 
	#RAD_COMPILER_GCC4


	)

53 
	#RAD_COMPILER_UNKNOWN


	)

54 
	#RAD_COMPILER
 -1

	)

58 #ià
defšed
(
RAD_OS_WIN32
è&& defšed(
_MSC_VER
)

59 
	#RAD_VC


	)

60 #–ià
defšed
(
RAD_OS_WIN32
è&& defšed(
__GNUC__
)

61 
	#RAD_MINGW


	)

62 #–ià
defšed
(
RAD_OS_LINUX
è&& defšed(
__GNUC__
)

63 
	#RAD_POSIX


	)

66 #ifdeà
__ılu¥lus


	@radutil/radposix.c

1 
	~"¿dut.h
"

2 
	~<time.h
>

3 
	~<¡ršg.h
>

4 
	~<¡dio.h
>

6 #ià
defšed
(
RAD_OS_WIN32
)

7 
	~<sys/timeb.h
>

8 
	~<wšsock2.h
>

9 
	~<wšdows.h
>

10 
	~<´oûss.h
>

12 
	~<sys/time.h
>

13 
	~<sys/£Ëù.h
>

14 
	~<sys/sock‘.h
>

15 
	~<Ãtš‘/š.h
>

16 
	~<¬·/š‘.h
>

19 #ià
defšed
(
RAD_OS_WIN32
)

31 
tm
 *
	$loÿÉime_r
(cÚ¡ 
time_t
 *
l_şock
, 
tm
 *
»suÉ
)

33 
	`memıy
(
»suÉ
, 
	`loÿÉime
(
l_şock
), (*result));

34  
»suÉ
;

35 
	}
}

37 
	$g‘timeofday
(
timev®
 *
tv
, *
tz
)

39 
_timeb
 
tb
;

40 
	`_áime
(&
tb
);

41 
tv
->
tv_£c
 = 
tb
.
time
;

42 
tv
->
tv_u£c
 = 
tb
.
ml™m
 * 1000;

44 
	}
}

46 
	$¡»¼Ü_r
(
”ºum
, *
buf
, 
size_t
 
n
)

48 * 
pMsgBuf
;

49 
DWORD
 
dwSize
;

51 
dwSize
 =

52 
	`FÜm©Mes§ge
(

53 
FORMAT_MESSAGE_ALLOCATE_BUFFER
 |

54 
FORMAT_MESSAGE_FROM_SYSTEM
 |

55 
FORMAT_MESSAGE_IGNORE_INSERTS
 ,

56 
NULL
,

57 (
DWORD
è
”ºum
,

58 
	`MAKELANGID
(
LANG_NEUTRAL
, 
SUBLANG_DEFAULT
),

59 (
LPTSTR
è&
pMsgBuf
,

61 
NULL
);

62 if(
dwSize
 == 0)

65 
	`¡ºıy
(
buf
, (cÚ¡ *)
pMsgBuf
, 
n
);

66 
buf
[
n
-1] = '\0';

67 
	`LoÿlF»e
(
pMsgBuf
);

70 
	}
}

72 *
	$¡¹ok_r
(*
¡ršg
, cÚ¡ *
d–im
, **
±½Œ
)

74 *
¡r
;

75 cÚ¡ *
ù¾
 = 
d–im
;

77 
m­
[32];

78 
couÁ
;

81 
couÁ
 = 0; count < 32; count++)

82 
m­
[
couÁ
] = 0;

86 
m­
[*
ù¾
 >> 3] |= (1 << (*ctrl & 7));

87 } *
ù¾
++);

92 ià(
¡ršg
)

93 
¡r
 = 
¡ršg
;

95 
¡r
 = *
±½Œ
;

100  (
m­
[*
¡r
 >> 3] & (1 << (*str & 7))) && *str )

101 
¡r
++;

103 
¡ršg
 = 
¡r
;

107  ; *
¡r
 ; str++ )

108 iàĞ
m­
[*
¡r
 >> 3] & (1 << (*str & 7)) ) {

109 *
¡r
++ = '\0';

115 *
±½Œ
 = 
¡r
;

118 iàĞ(*)
¡ršg
 =ğ
¡r
 )

119  
NULL
;

121  
¡ršg
;

122 
	}
}

124 *
	$dlİ’
 (cÚ¡ *
f’ame
, 
æag
)

126  (*)
	`LßdLib¿ry
(
f’ame
);

127 
	}
}

129 cÚ¡ *
	$dË¼Ü
()

131 
dË¼
[256];

132 
	`¡»¼Ü_r
(
	`G‘La¡E¼Ü
(), 
dË¼
, (dlerr));

133  
dË¼
;

134 
	}
}

136 *
	$dlsym
(*
hªdË
, *
symbŞ
)

138  (*)
	`G‘ProcAdd»ss
((
HMODULE
)
hªdË
, 
symbŞ
);

139 
	}
}

141 
	$dlşo£
 (*
hªdË
)

143  
	`F»eLib¿ry
((
HMODULE
)
hªdË
) ? 0 : -1;

144 
	}
}

146 
±h»ad_ü—‹
(
±h»ad_t
 *
th»ad
, 
±h»ad_©Œ_t
 *
©Œ
,

147 (
__¡dÿÎ
 *
¡¬t_routše
)(*), *
¬g
)

149 
ušŒ_t
 
hªdË
 =

150 
	`_begšth»adex
(
NULL
,

152 
¡¬t_routše
,

153 
¬g
,

156 &
th»ad
->
id
);

158 if(
hªdË
 == 0) {

159  
”ºo
;

162 
th»ad
->
hªdË
 = handle;

164 
	}
}

173 
	$±h»ad_još
(
±h»ad_t
 
th
, **
th»ad_»tuº
)

175 
buf
[256];

176 
”ºum
;

177 
DWORD
 
dwEx™Code
;

179 if(
	`Wa™FÜSšgËObjeù
((
HANDLE
)
th
.
hªdË
, 
INFINITE
è!ğ
WAIT_OBJECT_0
) {

180 
”ºum
 = 
	`G‘La¡E¼Ü
();

181 
	`¡»¼Ü_r
(
”ºum
, 
buf
, (buf));

182 
	`¿dlog
(
L_ERROR
|
L_CONS
, "[±h»ad_još] Wa™FÜSšgËObjeù: %d %s", 
”ºum
, 
buf
);

183  
”ºum
;

186 if(
th»ad_»tuº
) {

187 if(!
	`G‘Ex™CodeTh»ad
((
HANDLE
)
th
.
hªdË
, &
dwEx™Code
)) {

188 
”ºum
 = 
	`G‘La¡E¼Ü
();

189 
	`¡»¼Ü_r
(
”ºum
, 
buf
, (buf));

190 
	`¿dlog
(
L_ERROR
|
L_CONS
, "[±h»ad_još] G‘Ex™CodeTh»ad: %d %s", 
”ºum
, 
buf
);

191  
”ºum
;

193 *
th»ad_»tuº
 = (*)
dwEx™Code
;

196 if(!
	`Clo£HªdË
((
HANDLE
)
th
.
hªdË
)) {

197 
”ºum
 = 
	`G‘La¡E¼Ü
();

198 
	`¡»¼Ü_r
(
”ºum
, 
buf
, (buf));

199 
	`¿dlog
(
L_ERROR
|
L_CONS
, "[±h»ad_još] Clo£HªdË: %d %s", 
”ºum
, 
buf
);

200  
”ºum
;

204 
	}
}

208 
	$SË•
(
m£c
)

210 
timev®
 
tv
;

211 
tv
.
tv_£c
 = 
m£c
/1000;

212 
tv
.
tv_u£c
 = (
m£c
%1000)*1000;

213 
	`£Ëù
(0, 
NULL
, NULL, NULL, &
tv
);

214 
	}
}

218 #ià
defšed
(
RAD_OS_UNIX
è|| defšed(
RAD_OS_WIN32
)

220 
	$š‘_©Ú
(cÚ¡ *
ı
, 
š_addr
 *
šp
)

222 
a1
, 
a2
, 
a3
, 
a4
;

224 ià(
	`ssÿnf
(
ı
, "%d.%d.%d.%d", &
a1
, &
a2
, &
a3
, &
a4
) != 4)

227 
šp
->
s_addr
 = 
	`htÚl
((
a1
 << 24è+ (
a2
 << 16è+ (
a3
 << 8è+ 
a4
);

229 
	}
}

243 *
	$¡r£p
(**
¡ršgp
, cÚ¡ *
d–im
)

245 *
s
;

246 cÚ¡ *
¥ªp
;

247 
c
, 
sc
;

248 *
tok
;

250 ià((
s
 = *
¡ršgp
è=ğ
NULL
)

251  (
NULL
);

253 
tok
 = 
s
;;) {

254 
c
 = *
s
++;

255 
¥ªp
 = 
d–im
;

257 ià((
sc
 = *
¥ªp
++è=ğ
c
) {

258 ià(
c
 == 0)

259 
s
 = 
NULL
;

261 
s
[-1] = 0;

262 *
¡ršgp
 = 
s
;

263  (
tok
);

265 } 
sc
 != 0);

268  
NULL
;

269 
	}
}

273 #ià
defšed
(
RAD_OS_UNIX
)

274 
	$¡»¼Ü_r
(
”ºum
, *
buf
, 
size_t
 
n
)

276 
	`¡ºıy
(
buf
, 
	`¡»¼Ü
(
”ºum
), 
n
);

277 
buf
[
n
-1] = '\0';

279 
	}
}

	@radutil/radposix.h

10 #iâdeà
__RAD_POSIX_H__


11 
	#__RAD_POSIX_H__


	)

13 
	~<¿dut/¿dty³s.h
>

15 #ifdeà
__ılu¥lus


19 #ià
defšed
(
RAD_VC
)

20 
	#¡rÿ£cmp
(
x
, 
y
è
	`¡ricmp
(x, y)

	)

21 
	#¡ºÿ£cmp
(
x
, 
y
, 
n
è
	`¡ºicmp
(x, y,‚)

	)

22 
	#¢´štf
 
_¢´štf


	)

23 
	#v¢´štf
 
_v¢´štf


	)

24 
	~<dœeù.h
>

25 
	#mkdœ
(
x
, 
y
è
	`mkdœ
(x)

	)

28 #ià
defšed
(
RAD_MINGW
)

29 
	~<io.h
>

30 
	#mkdœ
(
x
, 
y
è
	`mkdœ
(x)

	)

33 #ià
defšed
(
RAD_OS_WIN32
)

34 
tm
 *
loÿÉime_r
(cÚ¡ 
time_t
 *
l_şock
, tm *
»suÉ
);

35 
	gtimev®
;

36 
g‘timeofday
(
timev®
 *
tv
, *
tz
);

37 
¡»¼Ü_r
(
”ºum
, *
buf
, 
size_t
 
n
);

38 *
¡¹ok_r
(*
¡ršg
, cÚ¡ *
d–im
, **
±½Œ
);

39 *
¡r£p
(**
¡ršgp
, cÚ¡ *
d–im
);

40 
	#RTLD_NOW
 0

	)

41 
	#RTLD_GLOBAL
 0

	)

42 *
dlİ’
 (cÚ¡ *
f’ame
, 
æag
);

43 cÚ¡ *
dË¼Ü
();

44 *
dlsym
(*
hªdË
, *
symbŞ
);

45 
dlşo£
 (*
hªdË
);

46 
	gš_addr
;

47 
š‘_©Ú
(cÚ¡ *
ı
, 
š_addr
 *
šp
);

48 
	s_±h»ad_t
 {

49 
	mid
;

50 
ušŒ_t
 
	mhªdË
;

51 } 
	t±h»ad_t
;

52 
_±h»ad_©Œ_t
 
	t±h»ad_©Œ_t
;

53 
±h»ad_ü—‹
(
±h»ad_t
 *
th»ad
, 
±h»ad_©Œ_t
 *
©Œ
,

54 (
__¡dÿÎ
 *
¡¬t_routše
)(*), *
¬g
);

55 
	`±h»ad_još
(
±h»ad_t
 
th
, **
th»ad_»tuº
);

56 
	#THREAD_CALLBACK
 
__¡dÿÎ


	)

57 
	#THREAD_ID
(
th
è(Ñh)->
id
)

	)

58 
	#THREAD_SELFID
(è(
	`G‘Cu¼’tTh»adId
())

	)

59 
	#PROCESS_SELFID
(è(
	`G‘Cu¼’tProûssId
())

	)

60 
	#¦“p
(
s
è
	`SË•
((s)*1000)

	)

62 
	#THREAD_CALLBACK
 *

	)

63 
	#THREAD_ID
(
th
èÑh)

	)

64 
	#THREAD_SELFID
(è(
	`±h»ad_£lf
())

	)

65 
	#PROCESS_SELFID
(è(
	`g‘pid
())

	)

66 
	`SË•
(
m£c
);

69 #ià
	`defšed
(
RAD_OS_UNIX
)

70 
	`¡»¼Ü_r
(
”ºum
, *
buf
, 
size_t
 
n
);

71 *
	`¡r£p
(**
¡ršgp
, cÚ¡ *
d–im
);

72 
š_addr
;

73 
	`š‘_©Ú
(cÚ¡ *
ı
, 
š_addr
 *
šp
);

74 
	~<¡ršgs.h
>

77 #ifdeà
__ılu¥lus


78 
	}
}

	@radutil/radslist.c

1 
	~"¿dut.h
"

3 
Ìad_¦i¡
 *
	$Ìad_¦i¡_add
(
Ìad_¦i¡
 *
node
,†¿d_¦i¡ *
h—d
)

5 
node
->
Ãxt
 = 
h—d
;

6  
node
;

7 
	}
}

	@radutil/radslist.h

10 #iâdeà
__RAD_SLIST_H__


11 
	#__RAD_SLIST_H__


	)

13 #ifdeà
__ılu¥lus


17 
_Ìad_¦i¡
 
	tÌad_¦i¡
;

19 
	s_Ìad_¦i¡


21 *
d©a
;

22 
Ìad_¦i¡
 *
Ãxt
;

25 
Ìad_¦i¡
 *
Ìad_¦i¡_add
Ö¿d_¦i¡ *
node
,†¿d_¦i¡ *
h—d
);

27 #ifdeà
__ılu¥lus


	@radutil/radtoken.c

1 
	~"¿dut.h
"

2 
	~<ùy³.h
>

3 
	~<¡ršg.h
>

4 
	~<¡dio.h
>

6 cÚ¡ 
LRAD_NAME_NUMBER
 
	gtok’s
[] = {

7 { "=~", 
T_OP_REG_EQ
, },

8 { "!~", 
T_OP_REG_NE
, },

9 { "{", 
T_LCBRACE
, },

10 { "}", 
T_RCBRACE
, },

11 { "(", 
T_LBRACE
, },

12 { ")", 
T_RBRACE
, },

13 { ",", 
T_COMMA
, },

14 { "+=", 
T_OP_ADD
, },

15 { "-=", 
T_OP_SUB
, },

16 { ":=", 
T_OP_SET
, },

17 { "=*", 
T_OP_CMP_TRUE
, },

18 { "!*", 
T_OP_CMP_FALSE
, },

19 { "==", 
T_OP_CMP_EQ
, },

20 { "=", 
T_OP_EQ
, },

21 { "!=", 
T_OP_NE
, },

22 { ">=", 
T_OP_GE
, },

23 { ">", 
T_OP_GT
, },

24 { "<=", 
T_OP_LE
, },

25 { "<", 
T_OP_LT
, },

26 { "#", 
T_HASH
, },

27 { ";", 
T_SEMICOLON
, },

28 { 
NULL
, 0, },

35 
	#TOKEN_MATCH
(
b±r
, 
Œ
) \

36 Ğ(
Œ
)[0] =ğ(
b±r
)[0] && \

37 ((
Œ
)[1] =ğ(
b±r
)[1] || (Œ)[1] =ğ0è)

	)

46 
LRAD_TOKEN
 
	$g‘tok
(cÚ¡ **
±r
, *
buf
, 
size_t
 
buæ’
,

47 cÚ¡ 
LRAD_NAME_NUMBER
 *
tok’li¡
)

49 *
s
;

50 cÚ¡ *
p
;

51 
quÙe
;

52 
esÿ³
;

53 
x
;

54 cÚ¡ 
LRAD_NAME_NUMBER
*
t
;

55 
LRAD_TOKEN
 
rcode
;

57 
buf
[0] = 0;

60 
p
 = *
±r
;

61 *
p
 && 
	`is¥aû
(() *p))

62 
p
++;

64 ià(*
p
 == 0) {

65 *
±r
 = 
p
;

66  
T_EOL
;

72 ià(
tok’li¡
è
t
 =ok’li¡;->
Çme
;++) {

73 ià(
	`TOKEN_MATCH
(
p
, 
t
->
Çme
)) {

74 
	`¡ºıy
(
buf
, 
t
->
Çme
, 
buæ’
);

75 
buf
[
buæ’
-1] = '\0';

76 
p
 +ğ
	`¡¾’
(
t
->
Çme
);

77 
	`is¥aû
((è*
p
))

78 
p
++;

79 *
±r
 = 
p
;

80  (
LRAD_TOKEN
è
t
->
numb”
;

85 
quÙe
 = 0;

86 ià((*
p
 == '"') ||

87 (*
p
 == '\'') ||

88 (*
p
 == '`')) {

89 
quÙe
 = *
p
;

90 
p
++;

92 
s
 = 
buf
;

93 
esÿ³
 = 0;

95 *
p
 && 
buæ’
-- > 1) {

97 ià(
esÿ³
) {

98 
esÿ³
 = 0;

99 *
p
) {

101 *
s
++ = '\r';

104 *
s
++ = '\n';

107 *
s
++ = '\t';

110 *
s
++ = '"';

113 *
s
++ = '\'';

116 *
s
++ = '`';

119 ià(*
p
 >= '0' && *p <= '9' &&

120 
	`ssÿnf
(
p
, "%3o", &
x
) == 1) {

121 *
s
++ = 
x
;

122 
p
 += 2;

124 *
s
++ = *
p
;

127 
p
++;

130 ià(*
p
 == '\\') {

131 
p
++;

132 
esÿ³
 = 1;

133 
buæ’
++;

138 ià(
quÙe
 && (*
p
 == quote)) {

139 
p
++;

142 ià(!
quÙe
) {

143 ià(
	`is¥aû
((è*
p
))

145 ià(
tok’li¡
) {

146 
t
 = 
tok’li¡
;->
Çme
;++)

147 ià(
	`TOKEN_MATCH
(
p
, 
t
->
Çme
))

149 ià(
t
->
Çme
 !ğ
NULL
)

153 *
s
++ = *
p
++;

155 *
s
++ = 0;

158 *
p
 && 
	`is¥aû
(() *p))

159 
p
++;

160 *
±r
 = 
p
;

163 
quÙe
) {

165 
rcode
 = 
T_BARE_WORD
;

169 
rcode
 = 
T_SINGLE_QUOTED_STRING
;

173 
rcode
 = 
T_DOUBLE_QUOTED_STRING
;

177 
rcode
 = 
T_BACK_QUOTED_STRING
;

181  
rcode
;

182 
	}
}

188 
	$g‘wÜd
(cÚ¡ **
±r
, *
buf
, 
size_t
 
buæ’
)

190  
	`g‘tok
(
±r
, 
buf
, 
buæ’
, 
NULL
è=ğ
T_EOL
 ? 0 : 1;

191 
	}
}

197 
	$g‘b¬ewÜd
(cÚ¡ **
±r
, *
buf
, 
size_t
 
buæ’
)

199 
LRAD_TOKEN
 
tok’
;

201 
tok’
 = 
	`g‘tok
(
±r
, 
buf
, 
buæ’
, 
NULL
);

202 ià(
tok’
 !ğ
T_BARE_WORD
) {

207 
	}
}

212 
LRAD_TOKEN
 
	$g‘tok’
(cÚ¡ **
±r
, *
buf
, 
size_t
 
buæ’
)

214  
	`g‘tok
(
±r
, 
buf
, 
buæ’
, 
tok’s
);

215 
	}
}

	@radutil/radtoken.h

10 #iâdeà
__RAD_TOKEN_H__


11 
	#__RAD_TOKEN_H__


	)

13 
	~<¿dut/¿dcommÚ.h
>

15 #ifdeà
__ılu¥lus


19 
	eÌad_tok’_t
 {

20 
T_INVALID
 = 0,

21 
T_EOL
,

22 
T_LCBRACE
,

23 
T_RCBRACE
,

24 
T_LBRACE
,

25 
T_RBRACE
,

26 
T_LABRACE
,

27 
T_RABRACE
,

28 
T_LSBRACE
,

29 
T_RSBRACE
,

30 
T_COMMA
,

31 
T_SEMICOLON
,

32 
T_COLON
,

34 
T_OP_ADD
,

35 
T_OP_SUB
,

36 
T_OP_SET
,

37 
T_OP_EQ
,

38 
T_OP_NE
,

39 
T_OP_GE
,

40 
T_OP_GT
,

41 
T_OP_LE
,

42 
T_OP_LT
,

43 
T_OP_REG_EQ
,

44 
T_OP_REG_NE
,

45 
T_OP_CMP_TRUE
,

46 
T_OP_CMP_FALSE
,

47 
T_OP_CMP_EQ
,

48 
T_OP_AND
,

49 
T_OP_OR
,

50 
T_HASH
,

51 
T_BRVBAR
,

52 
T_AMP
,

53 
T_BARE_WORD
,

54 
T_DOUBLE_QUOTED_STRING
,

55 
T_SINGLE_QUOTED_STRING
,

56 
T_BACK_QUOTED_STRING
,

57 
T_TOKEN_LAST


58 } 
	tLRAD_TOKEN
;

60 
	#T_EQSTART
 
T_OP_ADD


	)

61 
	#T_EQEND
 (
T_OP_CMP_EQ
 + 1)

	)

62 
	#T_WORD
(
t
èÑ =ğ
T_BARE_WORD
 || \

63 
t
 =ğ
T_DOUBLE_QUOTED_STRING
 || \

64 
t
 =ğ
T_SINGLE_QUOTED_STRING
 || \

65 
t
 =ğ
T_BACK_QUOTED_STRING
)

	)

67 
g‘wÜd
 (cÚ¡ **
±r
, *
buf
, 
size_t
 
buæ’
);

68 
g‘b¬ewÜd
 (cÚ¡ **
±r
, *
buf
, 
size_t
 
buæ’
);

69 
LRAD_TOKEN
 
g‘tok’
 (cÚ¡ **
±r
, *
buf
, 
size_t
 
buæ’
);

71 
LRAD_TOKEN
 
g‘tok
(cÚ¡ **
±r
, *
buf
, 
size_t
 
buæ’
,

72 cÚ¡ 
LRAD_NAME_NUMBER
 *
tok’li¡
);

74 #ifdeà
__ılu¥lus


	@radutil/radtypes.h

8 #iâdeà
__RAD_TYPES_H__


9 
	#__RAD_TYPES_H__


	)

11 
	~<¿dut/¿d¶©fÜm.h
>

13 
	~<sys/ty³s.h
>

15 #ià
defšed
(
RAD_OS_LINUX
è|| defšed(
RAD_MINGW
)

16 
	~<¡dšt.h
>

19 #ifdeà
__ılu¥lus


23 #ià
defšed
(
RAD_VC
)

28 sigÃd 
	tšt8_t
;

29 
	tušt8_t
;

30 
	tšt16_t
;

31 
	tušt16_t
;

32 
	tšt32_t
;

33 
	tušt32_t
;

36 
	tušŒ_t
;

40 #ifdeà
__ılu¥lus


	@radutil/radutil.c

1 
	~"¿dut.h
"

2 
	~<¡ršg.h
>

3 
	~<¡dio.h
>

4 #ià
defšed
(
RAD_OS_WIN32
)

5 
	~<wšsock2.h
>

7 
	~<Ãtdb.h
>

8 
	~<sys/sock‘.h
>

9 
	~<Ãtš‘/š.h
>

10 
	~<¬·/š‘.h
>

11 #iâdeà
INADDR_NONE


12 
	#INADDR_NONE
 0xffffffff

	)

16 * 
	$¡rNıy
(* 
d¡
, cÚ¡ * 
¤c
, 
size_t
 
Ën
)

18 * 
r
;

19 
r
 = 
	`¡ºıy
(
d¡
, 
¤c
, 
Ën
);

20 #ifdeà
RAD_BOUND_CHECK


21 
	`¿d_as£¹
(
d¡
[
Ën
-1] == '\0');

23 
d¡
[
Ën
-1] = '\0';

24  
r
;

25 
	}
}

27 * 
	$¡rNÿt
(* 
d¡
, cÚ¡ * 
¤c
, 
size_t
 
Ën
)

29 
size_t
 
dËn
 = 
	`¡¾’
(
d¡
);

31 
	`¡rNıy
(
d¡
+
dËn
, 
¤c
, 
Ën
-dlen);

32  
d¡
;

33 
	}
}

35 
	$sN´štf
(* 
¡r
, 
size_t
 
Ën
, cÚ¡ * 
fmt
, ...)

37 
r
;

38 
va_li¡
 
¬gs
;

40 
	`¿d_as£¹
(
Ën
 > 0);

42 
	`va_¡¬t
(
¬gs
, 
fmt
);

44 
r
 = 
	`v¢´štf
(
¡r
, 
Ën
, 
fmt
, 
¬gs
);

46 
	`va_’d
(
¬gs
);

48 #ifdeà
RAD_BOUND_CHECK


49 
	`¿d_as£¹
(
r
 >= 0);

50 
	`¿d_as£¹
(
¡r
[
r
] == '\0');

52 
¡r
[
Ën
-1] = '\0';

54  
r
;

55 
	}
}

57 
	$vsN´štf
(* 
¡r
, 
size_t
 
Ën
, cÚ¡ * 
fmt
, 
va_li¡
 
¬gs
)

59 
r
;

61 
	`¿d_as£¹
(
Ën
 > 0);

63 
r
 = 
	`v¢´štf
(
¡r
, 
Ën
, 
fmt
, 
¬gs
);

65 #ifdeà
RAD_BOUND_CHECK


66 
	`¿d_as£¹
(
r
 >= 0);

67 
	`¿d_as£¹
(
¡r
[
r
] == '\0');

69 
¡r
[
Ën
-1] = '\0';

71  
r
;

72 
	}
}

74 
	$Œim_adju¡
(** 
pc¡r
, cÚ¡ * 
d–ims
)

76 * 
begš
 = 0, * 
’d
 = 0;

77 
Ën
 = 0;

79 
begš
 = *
pc¡r
;

80  
	`¡rchr
(
d–ims
, *
begš
è!ğ
NULL
 && *begin != '\0' ) begin ++;

82 
’d
 = 
begš
 + 
	`¡¾’
(begin) - 1;

83  
	`¡rchr
(
d–ims
, *
’d
è!ğ
NULL
 &&ƒnd >ğ
begš
 )ƒnd --;

85 *
pc¡r
 = 
begš
;

86 
Ën
 = 
’d
-
begš
+1;

87 (*
pc¡r
)[
Ën
] = '\0';

89  
Ën
;

90 
	}
}

95 *
	$_Áß
(*
bufãr
, 
ušt32_t
 
addr
)

97 
addr
 = 
	`Áohl
(ipaddr);

99 
	`¥rštf
(
bufãr
, "%d.%d.%d.%d",

100 (
addr
 >> 24) & 0xff,

101 (
addr
 >> 16) & 0xff,

102 (
addr
 >> 8) & 0xff,

103 (
addr
 ) & 0xff);

104  
bufãr
;

105 
	}
}

111 
ušt32_t
 
	$_g‘addr
(cÚ¡ *
ho¡
)

113 
ho¡’t
 *
hp
;

114 
ušt32_t
 
a
;

115 #ifdeà
GETHOSTBYNAMERSTYLE


116 #ià(
GETHOSTBYNAMERSTYLE
 =ğ
SYSVSTYLE
è|| (GETHOSTBYNAMERSTYLE =ğ
GNUSTYLE
)

117 
ho¡’t
 
»suÉ
;

118 
”rÜ
;

119 
bufãr
[2048];

123 ià((
a
 = 
	`_addr
(
ho¡
)è!ğ
	`htÚl
(
INADDR_NONE
))

124  
a
;

126 #ifdeà
GETHOSTBYNAMERSTYLE


127 #ià
GETHOSTBYNAMERSTYLE
 =ğ
SYSVSTYLE


128 
hp
 = 
	`g‘ho¡byÇme_r
(
ho¡
, &
»suÉ
, 
bufãr
, (bufãr), &
”rÜ
);

129 #–ià
GETHOSTBYNAMERSTYLE
 =ğ
GNUSTYLE


130 ià(
	`g‘ho¡byÇme_r
(
ho¡
, &
»suÉ
, 
bufãr
, (buffer),

131 &
hp
, &
”rÜ
) != 0) {

132 
	`¿dlog
(
L_ERROR
|
L_CONS
, "[ip_getaddr] can‚ot gethostbyname '%s': h_errno(%d)",

133 
ho¡
, 
”ºo
);

134  
	`htÚl
(
INADDR_NONE
);

137 
hp
 = 
	`g‘ho¡byÇme
(
ho¡
);

140 
hp
 = 
	`g‘ho¡byÇme
(
ho¡
);

142 ià(
hp
 =ğ
NULL
) {

143 
	`¿dlog
(
L_ERROR
|
L_CONS
, "[ip_getaddr] can‚ot gethostbyname '%s': h_errno(%d)",

144 
ho¡
, 
h_”ºo
);

145  
	`htÚl
(
INADDR_NONE
);

153 ià(
hp
->
h_Ëngth
 != 4) {

154 
	`¿dlog
(
L_ERROR
|
L_CONS
, "[ip_getaddr] gethostbyname„eturns hostent->h_length is NOT 4",

155 
ho¡
);

156  
	`htÚl
(
INADDR_NONE
);

159 
	`memıy
(&
a
, 
hp
->
h_addr
, (
ušt32_t
));

160  
a
;

161 
	}
}

167 
ušt32_t
 
	$_addr
(cÚ¡ *
_¡r
)

169 
š_addr
 
š
;

171 ià(
	`š‘_©Ú
(
_¡r
, &
š
) == 0)

172  
	`htÚl
(
INADDR_NONE
);

173  
š
.
s_addr
;

174 
	}
}

181 
	glib¿d_dodns
 = 0;

183 * 
	$_ho¡Çme
(*
buf
, 
size_t
 
buæ’
, 
ušt32_t
 
addr
)

185 
ho¡’t
 *
hp
;

186 #ifdeà
GETHOSTBYADDRRSTYLE


187 #ià(
GETHOSTBYADDRRSTYLE
 =ğ
SYSVSTYLE
è|| (GETHOSTBYADDRRSTYLE =ğ
GNUSTYLE
)

188 
bufãr
[2048];

189 
ho¡’t
 
»suÉ
;

190 
”rÜ
;

197 ià(
lib¿d_dodns
 == 0) {

198 
	`_Áß
(
buf
, 
addr
);

199  
buf
;

202 #ifdeà
GETHOSTBYADDRRSTYLE


203 #ià
GETHOSTBYADDRRSTYLE
 =ğ
SYSVSTYLE


204 
hp
 = 
	`g‘ho¡byaddr_r
((*)&
addr
, (
š_addr
), 
AF_INET
, &
»suÉ
, 
bufãr
, (bufãr), &
”rÜ
);

205 #–ià
GETHOSTBYADDRRSTYLE
 =ğ
GNUSTYLE


206 ià(
	`g‘ho¡byaddr_r
((*)&
addr
, (
š_addr
),

207 
AF_INET
, &
»suÉ
, 
bufãr
, (buffer),

208 &
hp
, &
”rÜ
) != 0) {

209 
hp
 = 
NULL
;

212 
hp
 = 
	`g‘ho¡byaddr
((*)&
addr
, (
š_addr
), 
AF_INET
);

215 
hp
 = 
	`g‘ho¡byaddr
((*)&
addr
, (
š_addr
), 
AF_INET
);

217 ià((
hp
 =ğ
NULL
) ||

218 (
	`¡¾’
((*)
hp
->
h_Çme
è>ğ
buæ’
)) {

219 
	`_Áß
(
buf
, 
addr
);

220  
buf
;

223 
	`¡rNıy
(
buf
, (*)
hp
->
h_Çme
, 
buæ’
);

224  
buf
;

225 
	}
}

227 
	$´št_fe
(cÚ¡ * 
f’ame
, cÚ¡ * 
fÜm©
, ...)

229 
va_li¡
 
¬gs
;

230 
FILE
* 
fe
 = 
	`fİ’
(
f’ame
, "a+");

232 if(
fe
 =ğ
NULL
) {

233 
	`¿dlog
(
L_ERROR
|
L_CONS
, "[´št_fe] cª‚Ù o³Àf'%s'", 
f’ame
);

237 
	`va_¡¬t
(
¬gs
, 
fÜm©
);

238 
	`vårštf
(
fe
, 
fÜm©
, 
¬gs
);

239 
	`va_’d
(
¬gs
);

241 
	`fşo£
(
fe
);

243 
	}
}

245 * 
	$¡rR•l
(* 
d¡
, 
size_t
 
n
,

246 cÚ¡ * 
¤c
, cÚ¡ 
LRAD_NAME_MAP
* 
bË
)

248 cÚ¡ 
LRAD_NAME_MAP
 *
this
;

249 *
p
, *
p¤c
, *
pd¡
;

250 *
p0
, *
p¤c0
, *
pd¡0
;

251 
	#BUFSIZE
 4096

	)

252 
d¡buf
[
BUFSIZE
];

253 
¤cbuf
[
BUFSIZE
];

254 
size_t
 
ncİ›d
, 
Ën
, 
Æeá
, 
‹mp
;

256 
	`¡rsıy
(
¤cbuf
, 
¤c
);

257 
p0
 = 
¤cbuf
;

258 
p¤c0
 = 
p¤c
 = 
¤cbuf
;

259 
pd¡0
 = 
pd¡
 = 
d¡buf
;

262 
this
 = 
bË
;his->
Çme1
 !ğ
NULL
;his++) {

264 if(
this
->
Çme1
[0] == '\0')

267 
ncİ›d
 = 0;

268 
Æeá
 = 
BUFSIZE
-1;

269 
p¤c
 = 
p¤c0
;

270 
pd¡
 = 
pd¡0
;

271 #undeà
BUFSIZE


273 (
p
 = 
	`¡r¡r
(
p¤c
, 
this
->
Çme1
))) {

276 if(
Æeá
 == 0) ;

277 
‹mp
 = 
p
-
p¤c
;

278 
Ën
 = 
‹mp
 < 
Æeá
 ?emp :‚left;

279 
	`memıy
(
pd¡
, 
p¤c
, 
Ën
);

280 
ncİ›d
 +ğ
Ën
;

281 
Æeá
 -ğ
Ën
;

282 
p¤c
 = 
p
+
	`¡¾’
(
this
->
Çme1
);

283 
pd¡
 +ğ
Ën
;

286 if(
Æeá
 == 0) ;

287 
‹mp
 = 
	`¡¾’
(
this
->
Çme2
);

288 
Ën
 = 
‹mp
 < 
Æeá
 ?emp :‚left;

289 
	`memıy
(
pd¡
, 
this
->
Çme2
, 
Ën
);

290 
ncİ›d
 +ğ
Ën
;

291 
Æeá
 -ğ
Ën
;

292 
pd¡
 +ğ
Ën
;

296 if(
p
 =ğ
NULL
 && 
Æeá
 != 0) {

297 
‹mp
 = 
	`¡¾’
(
p¤c
);

298 
Ën
 = 
‹mp
 < 
Æeá
 ?emp :‚left;

299 
	`memıy
(
pd¡
, 
p¤c
, 
Ën
);

300 
ncİ›d
 +ğ
Ën
;

301 
pd¡
 +ğ
Ën
;

303 
pd¡
[0] = '\0';

307 
p0
 = 
pd¡0
;

308 
pd¡0
 = 
p¤c0
;

309 
p¤c0
 = 
p0
;

313 
	`¡rNıy
(
d¡
, 
p0
, 
n
);

314  
d¡
;

315 
	}
}

	@radutil/radutil.h

10 #iâdeà
__RAD_UTIL_H__


11 
	#__RAD_UTIL_H__


	)

13 
	~<¡d¬g.h
>

15 
	~<¿dut/¿d¶©fÜm.h
>

16 
	~<¿dut/¿dty³s.h
>

17 
	~<¿dut/¿ddebug.h
>

18 
	~<¿dut/¿dposix.h
>

19 
	~<¿dut/¿dmaüos.h
>

20 
	~<¿dut/¿dcommÚ.h
>

21 
	~<¿dut/¿dlog.h
>

22 
	~<¿dut/¿d¦i¡.h
>

23 
	~<¿dut/¿dh—±¿ck.h
>

24 
	~<¿dut/¿d¬¿y.h
>

25 
	~<¿dut/¿dtok’.h
>

26 
	~<¿dut/¿dcÚffe.h
>

27 
	~<¿dut/¿dc.h
>

29 #ifdeà
__ılu¥lus


34 * 
¡rNıy
(* 
d¡
, cÚ¡ * 
¤c
, 
size_t
 
Ën
);

35 * 
¡rNÿt
(* 
d¡
, cÚ¡ * 
¤c
, 
size_t
 
Ën
);

37 
sN´štf
(* 
¡r
, 
size_t
 
Ën
, cÚ¡ * 
fmt
, ...);

38 
vsN´štf
(* 
¡r
, 
size_t
 
Ën
, cÚ¡ * 
fmt
, 
va_li¡
 
¬gs
);

39 
Œim_adju¡
(** 
pc¡r
, cÚ¡ * 
d–ims
);

40 
ušt32_t
 
_g‘addr
(cÚ¡ *
ho¡
);

41 *
_Áß
(*
bufãr
, 
ušt32_t
 
addr
);

42 
ušt32_t
 
_addr
(cÚ¡ *
_¡r
);

43 *
_ho¡Çme
(*
buf
, 
size_t
 
buæ’
, 
ušt32_t
 
addr
);

44 
´št_fe
(cÚ¡ * 
f’ame
, cÚ¡ * 
fÜm©
, ...);

45 * 
¡rR•l
(* 
d¡
, 
size_t
 
n
,

46 cÚ¡ * 
¤c
, cÚ¡ 
LRAD_NAME_MAP
* 
bË
);

48 #ifdeà
__ılu¥lus


52 
RAD_EXTERN_C
 
lib¿d_dodns
;

	@test/dso/dynlib.c

1 
	~<¿dut/¿dut.h
>

3 
RAD_SYMBOL


4 
	gv¬
 = 0;

6 
RAD_SYMBOL


7 
	$fun
()

9 
v¬
 += 1;

10  
v¬
;

11 
	}
}

	@test/dso/dynmain.c

1 
	~<¿dut/¿dut.h
>

2 
	~<¡dio.h
>

3 
	~<as£¹.h
>

4 #ià
defšed
(
RAD_OS_UNIX
è|| defšed(
RAD_OS_LINUX
)

5 
	~<dlfú.h
>

8 (* 
	gfun_t
)();

10 
	$dlÿÎ
(cÚ¡ * 
dÎÇme
)

12 *
v¬
;

13 
fun_t
 
fun
;

14 * 
hªdË
;

15 
hªdË
 = 
	`dlİ’
(
dÎÇme
, 
RTLD_NOW
|
RTLD_GLOBAL
);

16 if(
hªdË
 =ğ
NULL
) {

17 
	`årštf
(
¡d”r
, "dlİ’: %s\n", 
	`dË¼Ü
());

20 
v¬
 = (*)
	`dlsym
(
hªdË
, "var");

21 if(
v¬
 =ğ
NULL
) {

22 
	`årštf
(
¡d”r
, "dlsym(v¬): %s\n", 
	`dË¼Ü
());

23 
şo£
;

25 
fun
 = (
fun_t
)
	`dlsym
(
hªdË
, "fun");

26 if(
fun
 =ğ
NULL
) {

27 
	`årštf
(
¡d”r
, "dlsym(fun): %s\n", 
	`dË¼Ü
());

28 
şo£
;

30 *
v¬
 = 20;

31 
	`as£¹
(
	`fun
() == 21);

32 
şo£
:

33 
	`as£¹
(
	`dlşo£
(
hªdË
) == 0);

34 
	}
}

36 
	$maš
()

38 #ià
	`defšed
(
RAD_OS_UNIX
è|| defšed(
RAD_OS_LINUX
)

39 
	`dlÿÎ
("libdyn.so");

41 
	`dlÿÎ
("dynlib_vc.dll");

42 
	`dlÿÎ
("dynlib_mingw.dll");

45 
	}
}

	@test/dso/main.c

1 
	~<¿dut/¿dut.h
>

2 
	~<as£¹.h
>

4 
RAD_SYMBOL


5 
RAD_EXTERN_C
 
	gv¬
;

7 
RAD_SYMBOL


8 
RAD_EXTERN_C
 
fun
();

10 
	$maš
()

12 
v¬
 = 10;

13 
	`as£¹
(
	`fun
() == 11);

15 
	}
}

	@test/radtest.cpp

1 
	~"¿dut.h
"

2 
	~"¿d‹¡.h
"

3 
	~<¡dio.h
>

5 
Ìad_boÙlšk
* 
	gÌad_boÙlšk
::
fœ¡
 = 
NULL
;

7 
	$¿d_run_‹¡
()

9 
	`¿dlog
(
L_INFO
, "[rad_run_test] Begin");

10 
Ìad_boÙlšk
* 
Ãxt
 =†¿d_boÙlšk::
fœ¡
;

11 
Ãxt
) {

12 
Ìad_‹¡_func
 
func
 = (Ìad_‹¡_func)
Ãxt
->
d©a
;

13 
	`´štf
("Te¡ ca£ [%s] ... ", 
Ãxt
->
Çme
);

14 
	`func
();

15 
	`´štf
("ok\n");

16 
Ãxt
 = 
¡©ic_ÿ¡
<
Ìad_boÙlšk
*>(next->next);

18 
	`¿dlog
(
L_INFO
, "[rad_run_test] End");

19 
	}
}

	@test/radtest.h

10 #iâdeà
__RAD_TEST_H__


11 
	#__RAD_TEST_H__


	)

13 (* 
	gÌad_‹¡_func
)();

15 
	gÌad_boÙlšk
 : 
public
 
Ìad_¦i¡
 {

16 
Ìad_boÙlšk
(
Ìad_‹¡_func
 
func
, cÚ¡ * 
func_Çme
) {

17 
	gd©a
 = (*)
func
;

18 
	gÃxt
 = 
NULL
;

19 
	gÇme
 = 
func_Çme
;

21 cÚ¡ * 
	gÇme
;

22 
Ìad_boÙlšk
* 
	gfœ¡
;

25 
	sÌad_boÙlšk_š™
 {

26 
Ìad_boÙlšk_š™
(
Ìad_boÙlšk
* 
node
) {

27 
	mÌad_boÙlšk
::
fœ¡


28 ğ
¡©ic_ÿ¡
<
Ìad_boÙlšk
*>(
Ìad_¦i¡_add
(
node
,†¿d_boÙlšk::
fœ¡
));

32 
	#RAD_TEST
(
func
) \

33 
	`func
(); \

34 
Ìad_boÙlšk
 
func
##
	`_node
(func, #func); \

35 
Ìad_boÙlšk_š™
 
func
##
	`_š™
(&func##
_node
); \

36 
	`func
()

	)

38 
¿d_run_‹¡
();

	@test/test_array.cpp

1 
	~"¿dut.h
"

2 
	~"¿d‹¡.h
"

3 
	~<¡ršg.h
>

4 
	~<¡dio.h
>

6 
	s_SHIFT_ARRAY
 {

7 
	#SHIFT_ARRAY_MAXCNT
 8

	)

8 
Ìad_shiá_’Œy
 
	m’Œy
;

9 
	md©a
[
SHIFT_ARRAY_MAXCNT
];

10 } 
	tSHIFT_ARRAY
;

12 
	$shiá_¬¿y_š™
(
SHIFT_ARRAY
* 
§
)

14 
	`mem£t
(
§
, 0, (
SHIFT_ARRAY
));

15 
	}
}

17 
	$shiá_¬¿y_push_back
(
SHIFT_ARRAY
* 
§
, 
d
)

19 
§
->
d©a
[

20 
	`Ìad_shiá_g‘_push_back_šdex
(&
§
->
’Œy
.
ä
,

21 &
§
->
’Œy
.
to
,

22 
SHIFT_ARRAY_MAXCNT
)

23 ] = 
d
;

24 
	}
}

26 
	$shiá_¬¿y_push_äÚt
(
SHIFT_ARRAY
* 
§
, 
d
)

28 
§
->
d©a
[

29 
	`Ìad_shiá_g‘_push_äÚt_šdex
(&
§
->
’Œy
.
ä
,

30 &
§
->
’Œy
.
to
,

31 
SHIFT_ARRAY_MAXCNT
)

32 ] = 
d
;

33 
	}
}

35 
	$shiá_¬¿y_pİ_back
(
SHIFT_ARRAY
* 
§
)

37 
n
 = 
	`Ìad_shiá_g‘_pİ_back_šdex
(&
§
->
’Œy
.
ä
,

38 &
§
->
’Œy
.
to
,

39 
SHIFT_ARRAY_MAXCNT
);

40 if(
n
 =ğ
LRAD_SHIFT_TOINFI
)

43  
§
->
d©a
[
n
];

44 
	}
}

46 
	$shiá_¬¿y_pİ_äÚt
(
SHIFT_ARRAY
* 
§
)

48 
n
 = 
	`Ìad_shiá_g‘_pİ_äÚt_šdex
(&
§
->
’Œy
.
ä
,

49 &
§
->
’Œy
.
to
,

50 
SHIFT_ARRAY_MAXCNT
);

51 if(
n
 =ğ
LRAD_SHIFT_TOINFI
)

54  
§
->
d©a
[
n
];

55 
	}
}

57 
	$shiá_¬¿y_dump
(* 
buf
, 
size_t
 
Ën
, cÚ¡ 
SHIFT_ARRAY
* 
§
)

59 
wb
;

61 
wb
 = 
	`sN´štf
(
buf
, 
Ën
, "[");

62 
buf
 +ğ
wb
;

63 
Ën
 -ğ
wb
;

65 
size_t
 
út
 = 
	`LRAD_SHIFT_LENGTH
(
§
->
’Œy
.
ä
,

66 
§
->
’Œy
.
to
,

67 
SHIFT_ARRAY_MAXCNT
);

68 
size_t
 
n
=0, 
i
=
§
->
’Œy
.
ä
;‚<
út
;

69 ++
n
, 
	`LRAD_SHIFT_INCIDX
(
i
, 
SHIFT_ARRAY_MAXCNT
)) {

70 
wb
 = 
	`sN´štf
(
buf
, 
Ën
, "%d, ", 
§
->
d©a
[
i
]);

71 
buf
 +ğ
wb
;

72 
Ën
 -ğ
wb
;

75 
	`sN´štf
(
buf
, 
Ën
, "]");

76 
	}
}

78 
	$RAD_TEST
(
shiá_¬¿y_pİ_äÚt
)

80 
SHIFT_ARRAY
 
¬¿y
;

81 
buf
[256];

83 
	`shiá_¬¿y_š™
(&
¬¿y
);

84 
	`¿d_as£¹
(
¬¿y
.
’Œy
.
ä
 == 0);

85 
	`¿d_as£¹
(
¬¿y
.
’Œy
.
to
 == 0);

86 
	`shiá_¬¿y_dump
(
buf
, (buf), &
¬¿y
);

87 
	`¿d_as£¹
(
	`¡rcmp
(
buf
, "[]") == 0);

89 
i
=1;

91 ; 
i
<=8; ++i)

92 
	`shiá_¬¿y_push_back
(&
¬¿y
, 
i
);

93 
	`shiá_¬¿y_dump
(
buf
, (buf), &
¬¿y
);

94 
	`¿d_as£¹
(
	`¡rcmp
(
buf
, "[1, 2, 3, 4, 5, 6, 7, 8, ]") == 0);

96 
	`¿d_as£¹
(
	`shiá_¬¿y_pİ_äÚt
(&
¬¿y
) == 1);

97 
	`¿d_as£¹
(
	`shiá_¬¿y_pİ_äÚt
(&
¬¿y
) == 2);

98 
	`¿d_as£¹
(
	`shiá_¬¿y_pİ_äÚt
(&
¬¿y
) == 3);

99 
	`¿d_as£¹
(
	`shiá_¬¿y_pİ_äÚt
(&
¬¿y
) == 4);

100 
	`¿d_as£¹
(
	`shiá_¬¿y_pİ_äÚt
(&
¬¿y
) == 5);

101 
	`¿d_as£¹
(
	`shiá_¬¿y_pİ_äÚt
(&
¬¿y
) == 6);

102 
	`¿d_as£¹
(
	`shiá_¬¿y_pİ_äÚt
(&
¬¿y
) == 7);

103 
	`¿d_as£¹
(
	`shiá_¬¿y_pİ_äÚt
(&
¬¿y
) == 8);

104 
	`¿d_as£¹
(
	`shiá_¬¿y_pİ_äÚt
(&
¬¿y
) == -1);

105 
	`¿d_as£¹
(
	`shiá_¬¿y_pİ_äÚt
(&
¬¿y
) == -1);

107 ; 
i
<=28; ++i)

108 
	`shiá_¬¿y_push_back
(&
¬¿y
, 
i
);

109 
	`shiá_¬¿y_dump
(
buf
, (buf), &
¬¿y
);

110 
	`¿d_as£¹
(
	`¡rcmp
(
buf
, "[21, 22, 23, 24, 25, 26, 27, 28, ]") == 0);

112 
	`¿d_as£¹
(
	`shiá_¬¿y_pİ_äÚt
(&
¬¿y
) == 21);

113 
	`¿d_as£¹
(
	`shiá_¬¿y_pİ_äÚt
(&
¬¿y
) == 22);

114 
	`¿d_as£¹
(
	`shiá_¬¿y_pİ_äÚt
(&
¬¿y
) == 23);

115 
	`¿d_as£¹
(
	`shiá_¬¿y_pİ_äÚt
(&
¬¿y
) == 24);

116 
	`¿d_as£¹
(
	`shiá_¬¿y_pİ_äÚt
(&
¬¿y
) == 25);

117 
	`¿d_as£¹
(
	`shiá_¬¿y_pİ_äÚt
(&
¬¿y
) == 26);

118 
	`¿d_as£¹
(
	`shiá_¬¿y_pİ_äÚt
(&
¬¿y
) == 27);

119 
	`¿d_as£¹
(
	`shiá_¬¿y_pİ_äÚt
(&
¬¿y
) == 28);

120 
	`¿d_as£¹
(
	`shiá_¬¿y_pİ_äÚt
(&
¬¿y
) == -1);

121 
	`¿d_as£¹
(
	`shiá_¬¿y_pİ_äÚt
(&
¬¿y
) == -1);

123 
i
=1; i<=13; ++i)

124 
	`shiá_¬¿y_push_back
(&
¬¿y
, 
i
);

125 
	`shiá_¬¿y_dump
(
buf
, (buf), &
¬¿y
);

126 
	`¿d_as£¹
(
	`¡rcmp
(
buf
, "[6, 7, 8, 9, 10, 11, 12, 13, ]") == 0);

128 
	`¿d_as£¹
(
	`shiá_¬¿y_pİ_äÚt
(&
¬¿y
) == 6);

129 
	`¿d_as£¹
(
	`shiá_¬¿y_pİ_back
(&
¬¿y
) == 13);

130 
	`¿d_as£¹
(
	`shiá_¬¿y_pİ_äÚt
(&
¬¿y
) == 7);

131 
	`¿d_as£¹
(
	`shiá_¬¿y_pİ_back
(&
¬¿y
) == 12);

132 
	}
}

134 
	$RAD_TEST
(
shiá_¬¿y_pİ_back
)

136 
SHIFT_ARRAY
 
¬¿y
;

137 
buf
[256];

139 
	`shiá_¬¿y_š™
(&
¬¿y
);

140 
	`¿d_as£¹
(
¬¿y
.
’Œy
.
ä
 == 0);

141 
	`¿d_as£¹
(
¬¿y
.
’Œy
.
to
 == 0);

142 
	`shiá_¬¿y_dump
(
buf
, (buf), &
¬¿y
);

143 
	`¿d_as£¹
(
	`¡rcmp
(
buf
, "[]") == 0);

145 
i
=1;

147 ; 
i
<=8; ++i)

148 
	`shiá_¬¿y_push_äÚt
(&
¬¿y
, 
i
);

149 
	`shiá_¬¿y_dump
(
buf
, (buf), &
¬¿y
);

150 
	`¿d_as£¹
(
	`¡rcmp
(
buf
, "[8, 7, 6, 5, 4, 3, 2, 1, ]") == 0);

152 
	`¿d_as£¹
(
	`shiá_¬¿y_pİ_back
(&
¬¿y
) == 1);

153 
	`¿d_as£¹
(
	`shiá_¬¿y_pİ_back
(&
¬¿y
) == 2);

154 
	`¿d_as£¹
(
	`shiá_¬¿y_pİ_back
(&
¬¿y
) == 3);

155 
	`¿d_as£¹
(
	`shiá_¬¿y_pİ_back
(&
¬¿y
) == 4);

156 
	`¿d_as£¹
(
	`shiá_¬¿y_pİ_back
(&
¬¿y
) == 5);

157 
	`¿d_as£¹
(
	`shiá_¬¿y_pİ_back
(&
¬¿y
) == 6);

158 
	`¿d_as£¹
(
	`shiá_¬¿y_pİ_back
(&
¬¿y
) == 7);

159 
	`¿d_as£¹
(
	`shiá_¬¿y_pİ_back
(&
¬¿y
) == 8);

160 
	`¿d_as£¹
(
	`shiá_¬¿y_pİ_back
(&
¬¿y
) == -1);

161 
	`¿d_as£¹
(
	`shiá_¬¿y_pİ_back
(&
¬¿y
) == -1);

163 ; 
i
<=28; ++i)

164 
	`shiá_¬¿y_push_äÚt
(&
¬¿y
, 
i
);

165 
	`shiá_¬¿y_dump
(
buf
, (buf), &
¬¿y
);

166 
	`¿d_as£¹
(
	`¡rcmp
(
buf
, "[28, 27, 26, 25, 24, 23, 22, 21, ]") == 0);

168 
	`¿d_as£¹
(
	`shiá_¬¿y_pİ_back
(&
¬¿y
) == 21);

169 
	`¿d_as£¹
(
	`shiá_¬¿y_pİ_back
(&
¬¿y
) == 22);

170 
	`¿d_as£¹
(
	`shiá_¬¿y_pİ_back
(&
¬¿y
) == 23);

171 
	`¿d_as£¹
(
	`shiá_¬¿y_pİ_back
(&
¬¿y
) == 24);

172 
	`¿d_as£¹
(
	`shiá_¬¿y_pİ_back
(&
¬¿y
) == 25);

173 
	`¿d_as£¹
(
	`shiá_¬¿y_pİ_back
(&
¬¿y
) == 26);

174 
	`¿d_as£¹
(
	`shiá_¬¿y_pİ_back
(&
¬¿y
) == 27);

175 
	`¿d_as£¹
(
	`shiá_¬¿y_pİ_back
(&
¬¿y
) == 28);

176 
	`¿d_as£¹
(
	`shiá_¬¿y_pİ_back
(&
¬¿y
) == -1);

177 
	`¿d_as£¹
(
	`shiá_¬¿y_pİ_back
(&
¬¿y
) == -1);

178 
	}
}

180 
	$RAD_TEST
(
shiá_¬¿y_push_äÚt
)

182 
SHIFT_ARRAY
 
¬¿y
;

183 
buf
[256];

185 
	`shiá_¬¿y_š™
(&
¬¿y
);

186 
	`¿d_as£¹
(
¬¿y
.
’Œy
.
ä
 == 0);

187 
	`¿d_as£¹
(
¬¿y
.
’Œy
.
to
 == 0);

188 
	`shiá_¬¿y_dump
(
buf
, (buf), &
¬¿y
);

189 
	`¿d_as£¹
(
	`¡rcmp
(
buf
, "[]") == 0);

191 
i
=1;

193 ; 
i
<=5; ++i)

194 
	`shiá_¬¿y_push_äÚt
(&
¬¿y
, 
i
);

195 
	`shiá_¬¿y_dump
(
buf
, (buf), &
¬¿y
);

196 
	`¿d_as£¹
(
	`¡rcmp
(
buf
, "[5, 4, 3, 2, 1, ]") == 0);

198 ; 
i
<=8; ++i)

199 
	`shiá_¬¿y_push_äÚt
(&
¬¿y
, 
i
);

200 
	`shiá_¬¿y_dump
(
buf
, (buf), &
¬¿y
);

201 
	`¿d_as£¹
(
	`¡rcmp
(
buf
, "[8, 7, 6, 5, 4, 3, 2, 1, ]") == 0);

203 ; 
i
<=12; ++i)

204 
	`shiá_¬¿y_push_äÚt
(&
¬¿y
, 
i
);

205 
	`shiá_¬¿y_dump
(
buf
, (buf), &
¬¿y
);

206 
	`¿d_as£¹
(
	`¡rcmp
(
buf
, "[12, 11, 10, 9, 8, 7, 6, 5, ]") == 0);

208 ; 
i
<=15; ++i)

209 
	`shiá_¬¿y_push_äÚt
(&
¬¿y
, 
i
);

210 
	`shiá_¬¿y_dump
(
buf
, (buf), &
¬¿y
);

211 
	`¿d_as£¹
(
	`¡rcmp
(
buf
, "[15, 14, 13, 12, 11, 10, 9, 8, ]") == 0);

213 ; 
i
<=75; ++i)

214 
	`shiá_¬¿y_push_äÚt
(&
¬¿y
, 
i
);

215 
	`shiá_¬¿y_dump
(
buf
, (buf), &
¬¿y
);

216 
	`¿d_as£¹
(
	`¡rcmp
(
buf
, "[75, 74, 73, 72, 71, 70, 69, 68, ]") == 0);

218 
i
=1; i<=2; ++i)

219 
	`shiá_¬¿y_push_back
(&
¬¿y
, 
i
);

220 
	`shiá_¬¿y_dump
(
buf
, (buf), &
¬¿y
);

221 
	`¿d_as£¹
(
	`¡rcmp
(
buf
, "[73, 72, 71, 70, 69, 68, 1, 2, ]") == 0);

223 ; 
i
<=7; ++i)

224 
	`shiá_¬¿y_push_back
(&
¬¿y
, 
i
);

225 
	`shiá_¬¿y_dump
(
buf
, (buf), &
¬¿y
);

226 
	`¿d_as£¹
(
	`¡rcmp
(
buf
, "[68, 1, 2, 3, 4, 5, 6, 7, ]") == 0);

227 
	}
}

229 
	$RAD_TEST
(
shiá_¬¿y_push_back
)

231 
SHIFT_ARRAY
 
¬¿y
;

232 
buf
[256];

234 
	`shiá_¬¿y_š™
(&
¬¿y
);

235 
	`¿d_as£¹
(
¬¿y
.
’Œy
.
ä
 == 0);

236 
	`¿d_as£¹
(
¬¿y
.
’Œy
.
to
 == 0);

237 
	`shiá_¬¿y_dump
(
buf
, (buf), &
¬¿y
);

238 
	`¿d_as£¹
(
	`¡rcmp
(
buf
, "[]") == 0);

240 
i
=1;

242 ; 
i
<=5; ++i)

243 
	`shiá_¬¿y_push_back
(&
¬¿y
, 
i
);

244 
	`shiá_¬¿y_dump
(
buf
, (buf), &
¬¿y
);

245 
	`¿d_as£¹
(
	`¡rcmp
(
buf
, "[1, 2, 3, 4, 5, ]") == 0);

247 ; 
i
<=8; ++i)

248 
	`shiá_¬¿y_push_back
(&
¬¿y
, 
i
);

249 
	`shiá_¬¿y_dump
(
buf
, (buf), &
¬¿y
);

250 
	`¿d_as£¹
(
	`¡rcmp
(
buf
, "[1, 2, 3, 4, 5, 6, 7, 8, ]") == 0);

252 ; 
i
<=12; ++i)

253 
	`shiá_¬¿y_push_back
(&
¬¿y
, 
i
);

254 
	`shiá_¬¿y_dump
(
buf
, (buf), &
¬¿y
);

255 
	`¿d_as£¹
(
	`¡rcmp
(
buf
, "[5, 6, 7, 8, 9, 10, 11, 12, ]") == 0);

257 ; 
i
<=15; ++i)

258 
	`shiá_¬¿y_push_back
(&
¬¿y
, 
i
);

259 
	`shiá_¬¿y_dump
(
buf
, (buf), &
¬¿y
);

260 
	`¿d_as£¹
(
	`¡rcmp
(
buf
, "[8, 9, 10, 11, 12, 13, 14, 15, ]") == 0);

262 ; 
i
<=75; ++i)

263 
	`shiá_¬¿y_push_back
(&
¬¿y
, 
i
);

264 
	`shiá_¬¿y_dump
(
buf
, (buf), &
¬¿y
);

265 
	`¿d_as£¹
(
	`¡rcmp
(
buf
, "[68, 69, 70, 71, 72, 73, 74, 75, ]") == 0);

266 
	}
}

268 
	$RAD_TEST
(
_dimof
)

270 
	s_USER_INFO
 {

271 
Çme
[15];

272 
age
;

273 
addr
[64];

274 } 
	tUSER_INFO
;

276 
USER_INFO
 
u£r_šfo
[10];

277 
	`mem£t
(
u£r_šfo
, 0, (user_info));

279 
	`¿d_as£¹
(
	`dimof
(
u£r_šfo
) == 10);

280 
	}
}

	@test/test_common.cpp

1 
	~"¿dut.h
"

2 
	~"¿d‹¡.h
"

4 
	~<¡dio.h
>

5 
	~<¡ršg.h
>

6 
	~<¡dlib.h
>

8 cÚ¡ 
LRAD_NAME_MAP
 
	gÇmes
[] = {

16 { 
NULL
 , NULL,},

19 
	$RAD_TEST
(
Ìad_¡¿2b
)

21 
	`¿d_as£¹
(
	`¡rcmp
(
	`Ìad_¡¿2b
(
Çmes
, "__d__", 
NULL
), "4") == 0);

22 
	`¿d_as£¹
(
	`Ìad_¡¿2b
(
Çmes
, "__h__", 
NULL
) == NULL);

23 
	}
}

25 
	$RAD_TEST
(
Ìad_¡rb2a
)

27 
	`¿d_as£¹
(
	`¡rcmp
(
	`Ìad_¡rb2a
(
Çmes
, "7", "__a__"), "__g__") == 0);

28 
	`¿d_as£¹
(
	`¡rcmp
(
	`Ìad_¡rb2a
(
Çmes
, "8", "__?__"), "__?__") == 0);

29 
	}
}

31 cÚ¡ 
LRAD_NAME_NUMBER
 
	gtok’s
[] = {

39 { 
NULL
 , 0, },

42 
	$RAD_TEST
(
Ìad_¡r2št
)

44 
	`¿d_as£¹
(
	`Ìad_¡r2št
(
tok’s
, "__d__", 0) == 4);

45 
	`¿d_as£¹
(
	`Ìad_¡r2št
(
tok’s
, "__h__", -1) == -1);

46 
	}
}

48 
	$RAD_TEST
(
Ìad_št2¡r
)

50 
	`¿d_as£¹
(
	`¡rcmp
(
	`Ìad_št2¡r
(
tok’s
, 7, "__a__"), "__g__") == 0);

51 
	`¿d_as£¹
(
	`¡rcmp
(
	`Ìad_št2¡r
(
tok’s
, 8, "__?__"), "__?__") == 0);

52 
	}
}

	@test/test_heaptrack.cpp

1 
	~"¿dut.h
"

2 
	~"¿d‹¡.h
"

4 * 
	gmem0
 = 
NULL
;

5 * 
	gmem1
 = 
NULL
;

6 * 
	gmem2
 = 
NULL
;

7 * 
	gmem3
 = 
NULL
;

11 
	$RAD_TEST
(
Ëak3
)

13 
	`¿d_ä“
(
mem3
);

14 
	`¿d_ä“
(
mem1
);

15 
	}
}

17 
	$RAD_TEST
(
Ëak2
)

19 
	`¿d_ä“
(
mem2
);

20 
	`¿d_ä“
(
mem0
);

21 
	}
}

23 
	$RAD_TEST
(
Ëak1
)

25 * 
mem
 = 
NULL
;

26 
	`¿d_v”ify
(
mem
 = 
	`¿d_m®loc
(4));

28 
	`¿d_v”ify
(
mem0
 = 
	`¿d_m®loc
(0));

29 
	`¿d_v”ify
(
mem1
 = 
	`¿d_m®loc
(1));

30 
	`¿d_v”ify
(
mem2
 = 
	`¿d_m®loc
(2));

31 
	`¿d_v”ify
(
mem3
 = 
	`¿d_m®loc
(3));

33 
	`¿d_ä“
(
mem
);

34 
	}
}

	@test/test_main.cpp

1 
	~"¿dut.h
"

2 
	~"¿d‹¡.h
"

3 #ià
defšed
(
RAD_OS_WIN32
)

4 
	~<wšsock2.h
>

6 
	$sock‘_š™
()

12 
WORD
 
wV”siÚReque¡ed
;

13 
WSADATA
 
w§D©a
;

14 
”r
;

16 
wV”siÚReque¡ed
 = 
	`MAKEWORD
(2, 2);

17 ià((
”r
 = 
	`WSAS¹up
(
wV”siÚReque¡ed
, &
w§D©a
)) != 0)

19 
	`¿dlog
(
L_FATAL
|
L_CONS
, "WSAS¹u°occur ”rÜ(%d)", 
”r
);

28 iàĞ
	`LOBYTE
Ğ
w§D©a
.
wV”siÚ
 ) != 2 ||

29 
	`HIBYTE
Ğ
w§D©a
.
wV”siÚ
 ) != 2 ) {

32 
	`WSACËªup
();

33 
	`¿dlog
(
L_FATAL
|
L_CONS
, "Can‚ot‡cquire winsock 2.2");

37 
	}
}

39 
	$sock‘_ş—n
()

41 if(
	`WSACËªup
(è=ğ
SOCKET_ERROR
) {

42 
	`¿dlog
(
L_WARN
|
L_CONS
, "WSACËªu°occur ”rÜ(%d)", 
	`WSAG‘La¡E¼Ü
());

44 
	}
}

47 
	$sock‘_š™
(è{
	}
}

48 
	$sock‘_ş—n
(è{
	}
}

52 
	$maš
(
¬gc
, * 
¬gv
[])

54 
	`sock‘_š™
();

55 
	`¿d_¡¬t_h—p_Œackšg
();

56 
	`¿d_run_‹¡
();

57 
	`¿d_¡İ_h—p_Œackšg
();

58 
	`sock‘_ş—n
();

60 
	}
}

	@test/test_token.cpp

1 
	~"¿dut.h
"

2 
	~"¿d‹¡.h
"

4 
	~<¡dio.h
>

5 
	~<¡ršg.h
>

6 
	~<¡dlib.h
>

8 
	$RAD_TEST
(
g‘tok2
)

10 
	s_ex´_t
 {

11 
İ
[8];

12 
lhs
[64];

13 
rhs
[64];

14 } 
	tex´_t
;

16 cÚ¡ * 
p
 = "add:5,4";

17 
buf
[256];

18 cÚ¡ 
LRAD_NAME_NUMBER
 
tok’s
[] = {

19 { ":", 
T_COLON
 },

20 { ",", 
T_COMMA
 },

21 { 
NULL
, 0, },

23 
LRAD_TOKEN
 
t
;

24 
ex´_t
 
ex´
;

26 
t
 = 
	`g‘tok
(&
p
, 
buf
, (buf), 
tok’s
);

27 
	`¿d_as£¹
(
	`T_WORD
(
t
));

28 
	`¡rsıy
(
ex´
.
İ
, 
buf
);

30 
t
 = 
	`g‘tok
(&
p
, 
buf
, (buf), 
tok’s
);

31 
	`¿d_as£¹
(
t
 =ğ
T_COLON
);

33 
t
 = 
	`g‘tok
(&
p
, 
buf
, (buf), 
tok’s
);

34 
	`¿d_as£¹
(
	`T_WORD
(
t
));

35 
	`¡rsıy
(
ex´
.
lhs
, 
buf
);

37 
t
 = 
	`g‘tok
(&
p
, 
buf
, (buf), 
tok’s
);

38 
	`¿d_as£¹
(
t
 =ğ
T_COMMA
);

40 
t
 = 
	`g‘tok
(&
p
, 
buf
, (buf), 
tok’s
);

41 
	`¿d_as£¹
(
	`T_WORD
(
t
));

42 
	`¡rsıy
(
ex´
.
rhs
, 
buf
);

43 
	}
}

45 
	$RAD_TEST
(
g‘tok
)

47 
buf
[256];

50 cÚ¡ 
LRAD_NAME_NUMBER
 
tok’s
[] = {

51 { ":=", 
T_OP_SET
, },

52 { ":", 
T_COLON
, },

53 { "=", 
T_OP_EQ
, },

54 { 
NULL
, 0, },

56 cÚ¡ * 
p
 = "‡:='b' ";

57 
	`¿d_v”ify
(
	`g‘tok
(&
p
, 
buf
, (buf), 
tok’s
è=ğ
T_BARE_WORD
);

58 
	`¿d_as£¹
(
	`¡rcmp
("a", 
buf
) == 0);

59 
	`¿d_v”ify
(
	`g‘tok
(&
p
, 
buf
, (buf), 
tok’s
è=ğ
T_OP_SET
);

60 
	`¿d_as£¹
(
	`¡rcmp
(":=", 
buf
) == 0);

61 
	`¿d_v”ify
(
	`g‘tok
(&
p
, 
buf
, (buf), 
tok’s
è=ğ
T_SINGLE_QUOTED_STRING
);

62 
	`¿d_as£¹
(
	`¡rcmp
("b", 
buf
) == 0);

63 
	`¿d_v”ify
(
	`g‘tok
(&
p
, 
buf
, (buf), 
tok’s
è=ğ
T_EOL
);

66 cÚ¡ 
LRAD_NAME_NUMBER
 
tok’s
[] = {

67 { ":", 
T_COLON
, },

68 { ":=", 
T_OP_SET
, },

69 { "=", 
T_OP_EQ
, },

70 { 
NULL
, 0, },

72 cÚ¡ * 
p
 = "a := 'b'";

73 
	`¿d_v”ify
(
	`g‘tok
(&
p
, 
buf
, (buf), 
tok’s
è=ğ
T_BARE_WORD
);

74 
	`¿d_as£¹
(
	`¡rcmp
("a", 
buf
) == 0);

75 
	`¿d_v”ify
(
	`g‘tok
(&
p
, 
buf
, (buf), 
tok’s
è=ğ
T_COLON
);

76 
	`¿d_as£¹
(
	`¡rcmp
(":", 
buf
) == 0);

77 
	`¿d_v”ify
(
	`g‘tok
(&
p
, 
buf
, (buf), 
tok’s
è=ğ
T_OP_EQ
);

78 
	`¿d_as£¹
(
	`¡rcmp
("=", 
buf
) == 0);

79 
	`¿d_v”ify
(
	`g‘tok
(&
p
, 
buf
, (buf), 
tok’s
è=ğ
T_SINGLE_QUOTED_STRING
);

80 
	`¿d_as£¹
(
	`¡rcmp
("b", 
buf
) == 0);

81 
	`¿d_v”ify
(
	`g‘tok
(&
p
, 
buf
, (buf), 
tok’s
è=ğ
T_EOL
);

83 
	}
}

85 
	$RAD_TEST
(
g‘b¬ewÜd
)

95 cÚ¡ * 
p
 = "‡bcd ";

96 
buf
[256];

97 
»tv®
;

99 
»tv®
 = 
	`g‘b¬ewÜd
(&
p
, 
buf
, (buf));

100 
	`¿d_as£¹
(
»tv®
 == 1);

101 
	`¿d_as£¹
(
	`¡rcmp
("abcd", 
buf
) == 0);

103 
»tv®
 = 
	`g‘b¬ewÜd
(&
p
, 
buf
, (buf));

104 
	`¿d_as£¹
(
»tv®
 == 0);

106 
p
 = " 'abcd' ";

108 
»tv®
 = 
	`g‘b¬ewÜd
(&
p
, 
buf
, (buf));

109 
	`¿d_as£¹
(
»tv®
 == 0);

110 
	}
}

112 
	$RAD_TEST
(
g‘wÜd
)

114 
	#GETWORD_INPUT
 \

118 "'h–\\l\\'''ja\\tck\\\"''ov”' \r\t\n"

	)

121 
¡r
[] = 
GETWORD_INPUT
;

130 cÚ¡ * 
p
 = 
¡r
;

131 
buf
[256];

133 
i
=1; 
	`g‘wÜd
(&
p
, 
buf
, (buf)); ++i) {

134 
i
) {

135 1: 
	`¿d_as£¹
(
	`¡rcmp
("fœ¡", 
buf
) == 0); ;

136 2: 
	`¿d_as£¹
(
	`¡rcmp
("£cÚd'abc'def", 
buf
) == 0); ;

137 3: 
	`¿d_as£¹
(
	`¡rcmp
("thœd", 
buf
) == 0); ;

138 4: 
	`¿d_as£¹
(
	`¡rcmp
("fou¹h,", 
buf
) == 0); ;

139 5: 
	`¿d_as£¹
(
	`¡rcmp
("fiáh", 
buf
) == 0); ;

140 6: 
	`¿d_as£¹
(
	`¡rcmp
(", sixth", 
buf
) == 0); ;

141 7: 
	`¿d_as£¹
(
	`¡rcmp
("£v’th:", 
buf
) == 0); ;

142 8: 
	`¿d_as£¹
(
	`¡rcmp
("\‹ighth \n", 
buf
) == 0); ;

143 9: 
	`¿d_as£¹
(
	`¡rcmp
("nšth'", 
buf
) == 0); ;

144 10: 
	`¿d_as£¹
(
	`¡rcmp
("h–l'", 
buf
) == 0); ;

145 11: 
	`¿d_as£¹
(
	`¡rcmp
("ja\tck\"", 
buf
) == 0); ;

146 12: 
	`¿d_as£¹
(
	`¡rcmp
("ov”", 
buf
) == 0); ;

147 : 
	`¿d_as£¹
(
çl£
); ;

152 
	`¿d_as£¹
(
	`¡rcmp
(
¡r
, 
GETWORD_INPUT
) == 0);

155 
p
 = 
¡r
;

156 
sbuf
[10];

158 
i
=1; 
	`g‘wÜd
(&
p
, 
sbuf
, (sbuf)); ++i) {

159 
i
) {

160 1: 
	`¿d_as£¹
(
	`¡rcmp
("fœ¡", 
sbuf
) == 0); ;

161 2: 
	`¿d_as£¹
(
	`¡rcmp
("£cÚd'ab", 
sbuf
) == 0); ;

162 3: 
	`¿d_as£¹
(
	`¡rcmp
("c'def", 
sbuf
) == 0); ;

163 4: 
	`¿d_as£¹
(
	`¡rcmp
("thœd", 
sbuf
) == 0); ;

164 5: 
	`¿d_as£¹
(
	`¡rcmp
("fou¹h,", 
sbuf
) == 0); ;

165 6: 
	`¿d_as£¹
(
	`¡rcmp
("fiáh", 
sbuf
) == 0); ;

166 7: 
	`¿d_as£¹
(
	`¡rcmp
(", sixth", 
sbuf
) == 0); ;

167 8: 
	`¿d_as£¹
(
	`¡rcmp
("£v’th:", 
sbuf
) == 0); ;

168 9: 
	`¿d_as£¹
(
	`¡rcmp
("\‹ighth \n", 
sbuf
) == 0); ;

169 10: 
	`¿d_as£¹
(
	`¡rcmp
("‚šth'\r'", 
sbuf
) == 0); ;

170 11: 
	`¿d_as£¹
(
	`¡rcmp
("h–l'''ja", 
sbuf
) == 0); ;

171 12: 
	`¿d_as£¹
(
	`¡rcmp
("\tck\"''ove", 
sbuf
) == 0); ;

172 13: 
	`¿d_as£¹
(
	`¡rcmp
("r'", 
sbuf
) == 0); ;

173 : 
	`¿d_as£¹
(
çl£
); ;

179 #undeà
GETWORD_INPUT


180 
	}
}

	@test/test_util.cpp

1 
	~"¿dut.h
"

2 
	~"¿d‹¡.h
"

3 
	~<¡ršg.h
>

4 #ià
defšed
(
RAD_OS_WIN32
)

5 
	~<wšsock2.h
>

7 
	~<sys/sock‘.h
>

8 
	~<Ãtš‘/š.h
>

9 
	~<¬·/š‘.h
>

12 
	$RAD_TEST
(
¡rR•l2
)

14 
sql
[256];

16 cÚ¡ * 
sqlcÚf
 = "SELECT * FROM‡ccts "

20 cÚ¡ * 
sqlšs
 = "INSERT INTO‡ccts VALUES (${CUR_DATE}) "

23 
¡¬t_d©e
[16] = "'20050714'";

24 
’d_d©e
[16] = "'20050919'";

25 
u£r
[8] = "'Alice'";

26 
rownum
[8] = "100";

28 cÚ¡ 
LRAD_NAME_MAP
 
»¶s
[] = {

29 { "${START_DATE}", 
¡¬t_d©e
 },

30 { "${END_DATE}", 
’d_d©e
 },

32 { "${ROWNUM}", 
rownum
 },

33 { "${USER}", 
u£r
 },

34 { 
NULL
, NULL }

37 
	`¿d_as£¹
(
	`¡rcmp
(
	`¡rR•l
(
sql
, (sql), 
sqlcÚf
, 
»¶s
),

42 
	`¡rsıy
(
u£r
, "'Jack'");

43 
	`¡rsıy
(
’d_d©e
, "'20050920'");

44 
	`sN´štf
(
rownum
, (rownum), "%d", 36);

46 
	`¿d_as£¹
(
	`¡rcmp
(
	`¡rR•l
(
sql
, (sql), 
sqlcÚf
, 
»¶s
),

51 
	`¡rsıy
(
u£r
, "Neo");

53 
	`¿d_as£¹
(
	`¡rcmp
(
	`¡rR•l
(
sql
, (sql), 
sqlšs
, 
»¶s
),

55 
	}
}

57 
	$RAD_TEST
(
¡rR•l
)

59 
buf
[256];

61 cÚ¡ 
LRAD_NAME_MAP
 
»¶s
[] = {

69 { 
NULL
, NULL },

72 
	`¿d_as£¹
(
	`¡rcmp
(
	`¡rR•l
(
buf
, (buf),

74 
»¶s
),

77 
	`¿d_as£¹
(
	`¡rcmp
(
	`¡rR•l
(
buf
, (buf),

79 
»¶s
),

82 
	`¿d_as£¹
(
	`¡rcmp
(
	`¡rR•l
(
buf
, (buf),

84 
»¶s
),

87 
	`¿d_as£¹
(
	`¡rcmp
(
	`¡rR•l
(
buf
, (buf),

89 
»¶s
),

92 
	`¿d_as£¹
(
	`¡rcmp
(
	`¡rR•l
(
buf
, (buf),

94 
»¶s
),

98 cÚ¡ 
LRAD_NAME_MAP
 
»¶s_nuÎ
[] = {

99 { 
NULL
, NULL }

102 
	`¿d_as£¹
(
	`¡rcmp
(
	`¡rR•l
(
buf
, (buf), "abc${DATE}de${TIME}fg", 
»¶s_nuÎ
),

105 
	`¿d_as£¹
(
	`¡rcmp
(
	`¡rR•l
(
buf
, 16,

107 
»¶s
),

111 
	`¿d_as£¹
(
	`¡rcmp
(
	`¡rR•l
(
buf
, (buf),

113 
»¶s
),

116 
	}
}

120 
	$RAD_TEST
(
_ho¡Çme
)

122 
buf
[256];

124 
	`¿d_as£¹
(
	`¡rcmp
(
	`_ho¡Çme
(
buf
, (buf),

125 
	`š‘_addr
("61.182.213.238")),

127 
	`¿d_as£¹
(
	`¡rcmp
(
	`_ho¡Çme
(
buf
, (buf),

128 
	`š‘_addr
("127.0.0.1")),

130 
	`¿d_as£¹
(
	`¡rcmp
(
	`_ho¡Çme
(
buf
, (buf),

131 
	`š‘_addr
("192.168.7.25")),

133 
lib¿d_dodns
 = 1;

134 
	`¿d_as£¹
(
	`¡rcmp
(
	`_ho¡Çme
(
buf
, (buf),

135 
	`š‘_addr
("192.168.7.25")),

137 
	`¿d_as£¹
(
	`¡rcmp
(
	`_ho¡Çme
(
buf
, (buf),

138 
	`š‘_addr
("127.0.0.1")),

140 
	`¿d_as£¹
(
	`¡rcmp
(
	`_ho¡Çme
(
buf
, (buf),

141 
	`š‘_addr
("61.182.213.238")),

143 
lib¿d_dodns
 = 0;

144 
	}
}

146 
	$RAD_TEST
(
_g‘addr
)

148 
	`¿d_as£¹
(
	`_g‘addr
("192.168.7.25")

149 =ğ
	`š‘_addr
("192.168.7.25"));

150 
	`¿d_as£¹
(
	`_g‘addr
("127.0.0.1")

151 =ğ
	`š‘_addr
("127.0.0.1"));

152 
	`¿d_as£¹
(
	`_g‘addr
("localhost")

153 =ğ
	`š‘_addr
("127.0.0.1"));

154 
	`¿d_as£¹
(
	`_g‘addr
("newsmth.org")

155 =ğ
	`š‘_addr
("61.182.213.238"));

156 
	}
}

160 
	$RAD_TEST
(
Œim_adju¡2
)

162 
buf
[] = "";

163 * 
p
 = 
buf
;

164 
Ën
 = 
	`Œim_adju¡
(&
p
, " ");

165 
	`¿d_as£¹
(
p
[0] == '\0');

166 
	`¿d_as£¹
(
Ën
 == 0);

167 
	}
}

169 
	$RAD_TEST
(
Œim_adju¡
)

171 
buf
[] = " \t \n Za ku \t \r\n ";

173 * 
p
 = 
buf
;

174 
Ën
 = 
	`Œim_adju¡
(&
p
, " \t\r\n");

175 
	`¿d_as£¹
(
	`¡rcmp
(
p
, "Za ku") == 0);

176 
	`¿d_as£¹
(
Ën
 == 5);

178 
Ën
 = 
	`Œim_adju¡
(&
p
, " \t\r\n");

179 
	`¿d_as£¹
(
	`¡rcmp
(
p
, "Za ku") == 0);

180 
	`¿d_as£¹
(
Ën
 == 5);

181 
	}
}

	@
1
.
0
59
1134
radfwk/ConfMap.cpp
radfwk/ConfMap.h
radfwk/Config.cpp
radfwk/Config.h
radfwk/ListMap.hpp
radfwk/functors.hpp
radfwk/noncopyable.hpp
radsock/log_error.c
radsock/radsock.h
radsock/readline.c
radsock/recvn.c
radsock/send_email.c
radsock/sendn.c
radsock/sock_peer_name.c
radsock/socket_init.c
radsock/tcp_connect.c
radsock/tcp_listen.c
radsock/udp_bind.c
radsock/udp_connect.c
radsql/dbutil.cpp
radsql/dbutil.hpp
radsql/radsql.c
radsql/radsql.h
radutil/radarray.c
radutil/radarray.h
radutil/radcommon.c
radutil/radcommon.h
radutil/radconffile.c
radutil/radconffile.h
radutil/raddebug.c
radutil/raddebug.h
radutil/radheaptrack.c
radutil/radheaptrack.h
radutil/radipc.c
radutil/radipc.h
radutil/radlog.c
radutil/radlog.h
radutil/radmacros.h
radutil/radplatform.h
radutil/radposix.c
radutil/radposix.h
radutil/radslist.c
radutil/radslist.h
radutil/radtoken.c
radutil/radtoken.h
radutil/radtypes.h
radutil/radutil.c
radutil/radutil.h
test/dso/dynlib.c
test/dso/dynmain.c
test/dso/main.c
test/radtest.cpp
test/radtest.h
test/test_array.cpp
test/test_common.cpp
test/test_heaptrack.cpp
test/test_main.cpp
test/test_token.cpp
test/test_util.cpp
